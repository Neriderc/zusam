function recordUsage(e){$.ajax({url:"Ajax/post.php",type:"post",data:{action:"recordUsage",usage:e},success:function(e){},error:function(){}})}function toggleButterfly(e){var t=$(e).closest(".post").attr("data-id"),a=$("#info").attr("data-uid"),n=$("#info").attr("data-fid");recordUsage("butterfly"),$.ajax({url:"Ajax/post.php",type:"POST",data:{action:"toggleButterfly",uid:a,fid:n,pid:t},success:function(t){$(e).parent()[0].childNodes[3].textContent;$(e).parent()[0].childNodes[3].textContent=t.count,e.style.fill=t.color},error:function(){}})}function getMoreComments(e){var t=$("#info").attr("data-uid"),a=$("#info").attr("data-fid");$.ajax({url:"Ajax/get.php",type:"GET",data:{action:"getMoreComments",uid:t,fid:a,pid:e},success:function(e){$("#post-viewer .more_comments").after(e.html),$("#post-viewer .more_comments").remove(),lazyload($(".nano-content")[0])},error:function(){}})}function updatePostStats(e){var t=$("#info").attr("data-uid"),a=$("#info").attr("data-fid");$.ajax({url:"Ajax/get.php",type:"GET",data:{action:"getPostStats",uid:t,fid:a,pid:e},success:function(t){"undefined"!=typeof t&&"undefined"!=typeof t.coms&&(0!=t.coms?($('#container .post-mini[data-id="'+e+'"]').find(".stats").remove(),$('#container .post-mini[data-id="'+e+'"]').append('<div class="stats"><div class="comments-indicator"><div>'+t.coms+' <i class="fa fa-comment"></i></div></div></div>'),1==t.unread&&$('.post-mini[data-id="'+e+'"] .comments-indicator div').addClass("newcom")):$('#container .post-mini[data-id="'+e+'"]').find(".stats").remove())}})}function changeSecretLink(){var e=$("#info").attr("data-uid"),t=$("#info").attr("data-fid");$.ajax({url:"Ajax/post.php",type:"POST",data:{action:"changeSecretLink",uid:e,fid:t},success:function(e){window.location.reload()}})}function removeUserFromForum(){var e=$("#info").attr("data-uid"),t=$("#info").attr("data-fid");$.ajax({url:"Ajax/post.php",type:"POST",data:{action:"removeUserFromForum",uid:e,fid:t},success:function(e){window.location=location.protocol+"//"+location.host+location.pathname},error:function(){}})}function loadRetoucheBox(e,t,a){r=$("#retoucheBox"),r.attr("data-w",e),r.attr("data-h",t),r.attr("data-action",a),showimageeditor("#retoucheBox")}function destroyAccount(e){var t=$(e).val();if(null==t||t.match(/^\s*$/))return!1;var a=$("#info").attr("data-uid");$.ajax({url:"Ajax/post.php",type:"POST",data:{action:"destroyAccount",uid:a,password:t},success:function(e){disconnect()}})}function changeforumname(e){if(name=$(e).val(),null==name||name.match(/^\s*$/))return!1;var t=$("#info").attr("data-uid"),a=$("#info").attr("data-fid");$.ajax({url:"Ajax/post.php",type:"POST",data:{action:"changeForum",uid:t,fid:a,name:name},success:function(e){location.reload()}})}function changename(e){if(name=$(e).val(),null==name||name.match(/^\s*$/))return!1;var t=$("#info").attr("data-uid");$.ajax({url:"Ajax/post.php",type:"POST",data:{action:"changeProfile",uid:t,name:name},success:function(e){location.reload()}})}function inviteUser(e){return e.match(/.+@.+/)?mail=e:mail=$(e).val(),""==mail||"undefined"==typeof mail?!1:(uid=$("#info").attr("data-uid"),fid=$("#info").attr("data-fid"),void $.ajax({url:"Ajax/post.php",type:"POST",data:{action:"inviteUser",uid:uid,mail:mail,fid:fid},success:function(e){window.location.reload(!0)},error:function(){}}))}function changepassword(e,t){if(old_password=$(e).val(),new_password=$(t).val(),null==old_password||old_password.match(/^\s*$/))return!1;if(null==new_password||new_password.match(/^\s*$/))return!1;var a=$("#info").attr("data-uid");$.ajax({url:"Ajax/post.php",type:"POST",data:{action:"changeProfile",uid:a,old_password:old_password,new_password:new_password},success:function(e){location.reload()}})}function sendIt(e){if(msg="","#commentBox"==e||"#editBox"==e)var a=$("#post-viewer").attr("data-id");else var a=0;if("#editBox"==e)var n=$(e).parent().attr("data-id");else var n=0;for(t=$(e),i=0;i<t.children().length;i++)c=$(t.children()[i]),c.hasClass("deletable")?msg+=" "+c.attr("data-src"):msg+=" "+decode(c.html());uid=$("#info").eq(0).attr("data-uid"),forum=$("#info").eq(0).attr("data-fid");var o=createId();if($.ajax({url:"Ajax/save_msg.php",type:"POST",data:{text:msg,forum:forum,uid:uid,parent:a,pid:n},success:function(e){if(0==e.parent||null==e.parent){var t=$('#container div[data-balise="'+o+'"]');null!=e.miniature?t.after('<div class="material-shadow post-mini" data-id="'+e.id+'"><div class="post-preview"><img src="'+e.miniature+'"/></div></div>'):t.after('<div class="material-shadow post-mini" data-id="'+e.id+'"><div class="post-preview">'+e.html_preview+"</div></div>"),t.remove(),hidepostviewer()}else if(0==e.pid||null==e.pid){var t=$('.child-post[data-balise="'+o+'"]');t.after(e.html),t.remove(),typebox.view();var a=$("#container .post-mini[data-id="+e.parent+"]");a.remove(),$("#container").prepend(a),updatePostStats(e.parent)}else if(e.parent==e.pid){var n=$(".parent-post");n.after(e.html),n.remove(),typebox.view();var a=$("#container .post-mini[data-id="+e.pid+"]");null!=e.miniature?a.after('<div class="material-shadow post-mini" data-id="'+e.pid+'"><img src="'+e.miniature+'"/></div>'):a.after('<div class="material-shadow post-mini" data-id="'+e.pid+'">'+e.html_preview+"</div>"),a.remove()}else{var t=$(".child-post[data-id="+e.pid+"]");t.after(e.html),t.remove()}setpostsviewable()},error:function(e,t,a){}}),0==a||null==a){if(0==n||null==n){var s=$('<div data-balise="'+o+'" class="post-mini"><div class="spinner"><div class="bg-orange bounce1"></div><div class="bg-orange bounce2"></div><div class="bg-orange bounce3"></div></div></div>');$("#container").prepend(s),push_hidenewpost(!0)}}else if(0==n||null==n){hidenewcommentsection($(".new-comment-section"));var r=$('<div class="post child-post" data-balise="'+o+'"><div class="spinner"><div class="bg-white bounce1"></div><div class="bg-white bounce2"></div><div class="bg-white bounce3"></div></div></div>');$(".new-comment-section").before(r)}}function setpostsviewable(){$(".post-mini").off(),$(".post-mini").on("click",function(e){var t=$(e.currentTarget).attr("data-id");push_showpost(t)})}function deletePost(e){if(confirm("Voulez-vous vraiment supprimer ce message ?")){var t=$(e).closest(".post"),a=t.attr("data-id"),n=$("#info").attr("data-fid");$.ajax({url:"Ajax/post.php",type:"POST",data:{action:"deletePost",id:a,forum:n},success:function(e){t.hasClass("parent-post")?(hidepostviewer(),$('#container .post-mini[data-id="'+a+'"]').remove()):$('.post[data-id="'+a+'"]').remove();var n=$("#post-viewer").attr("data-id");updatePostStats(n)}})}}function editPost(e){recordUsage("edit");var t=$(e).closest(".post"),a=t.attr("data-id");$.ajax({url:"Ajax/get.php",type:"get",data:{action:"getRaw",pid:a},success:function(e){box='<div id="editBox" class="dynamicBox">',box+='<div contenteditable="true" data-placeholder="Ecrivez quelque chose...">'+e.raw+"</div>",box+="</div>",box+='<div class="menu">',box+='<div class="menu-cell">',box+='<button id="cancelit" onclick="hidepostviewer()">Annuler</button>',box+="</div>",box+='<div class="menu-cell">',box+='<button id="sendit" onclick="sendIt(\'#editBox\')">Envoyer</button>',box+="</div>",box+="</div>",t.html(box),typebox.start("#editBox"),typebox.evaluate("#editBox")}})}function loadMorePosts(){if(!window.loading_posts){recordUsage("morePosts"),window.loading_posts=!0;var e=$("#container .post-mini").map(function(){var e=this.dataset.id;return e}).get();e=JSON.stringify(e);var t=$("#info").attr("data-fid"),a=window.innerWidth;a>680&&(a-=200);var n=window.innerHeight,i=10,o=parseInt(a/(320+i)),s=parseInt(n/(180+i)),r=o*(s+1);$.ajax({url:"Ajax/post.php",type:"POST",data:{action:"morePost",fid:t,list:e,number:r},success:function(e){"undefined"!=typeof e&&""!=e&&(e.count>0&&$("#container").append(e.html),1==e.end&&$(document).unbind("scroll"),setpostsviewable(),window.loading_posts=!1)},error:function(){window.loading_posts=!1}})}}function disconnect(){recordUsage("disconnect"),$.ajax({url:"Ajax/connect.php",type:"POST",data:{mail:"",password:""},success:function(e){document.cookie="auth_token=; expires=Thu, 01 Jan 1970 00:00:01 GMT;",window.location=location.protocol+"//"+location.host+location.pathname}})}function cancelAsk(){$("#ask").remove(),removeMask("askMask")}function answerAsk(e,t){var a=$("#ask input").val();cancelAsk(),e(a,t)}function ask(e,t,a,n){var i=$('<div id="ask"></div>'),o=$("<span>"+e+"</span>"),s=$('<input type="text" maxlength="'+t+'"></input>'),r=$("<button>Ok</button>");r.on("click",function(){answerAsk(a,n)});var d=$('<button onclick="cancelAsk()">Annuler</button>');i.append(o).append(s).append(r).append(d),$("body").append(i),addMask("cancelAsk()",.4,9e3,"askMask")}function addForum(e){return null==e||e.match(/^\s*$/)?!1:(uid=$("#info").attr("data-uid"),void $.ajax({url:"Ajax/post.php",type:"POST",data:{action:"addForum",uid:uid,name:e},success:function(e){"undefined"!=typeof e?window.location.href=e.link:window.location.reload(!0)},error:function(){}}))}function addUserToForum(e){nid=$(e).parent().attr("data-id"),uid=$("#info").attr("data-uid"),$.ajax({url:"Ajax/post.php",type:"POST",data:{action:"addUserToForum",uid:uid,nid:nid},success:function(e){"undefined"!=typeof e?window.location.href=e.link:window.location.reload(!0)},error:function(){}}),$(e).parent().remove()}function removeNotification(e){nid=$(e).parent().attr("data-id"),uid=$("#info").attr("data-uid"),$.ajax({url:"Ajax/post.php",type:"POST",data:{action:"removeNotification",uid:uid,nid:nid},success:function(e){},error:function(){}}),$('*[data-id="'+nid+'"]').remove()}function inputFile(e){input=$('<input class="hidden" data-id="'+e+'" type="file" multiple></input>'),input.on("change",handleFileSelect),$("body").append(input),input.click()}function handleFileSelect(e){var t=e.target.files,a=e.target.dataset.id;if(file=t[0],t.length>20)return alert("Le nombre maximum de fichier que vous pouvez envoyer en mÃªme temps est 20"),!1;for(var n=0;n<t.length;n++)handleFile(t[n],a);e.target.value=null}function handleFile(e,t){var a=!1;e.type.match(/image/)&&(a=!0,e.size>31457280?alert("fichier image trop lourd (max 30Mo)"):PF.loadImage(e,t)),e.type.match(/video/)&&(a=!0,e.size>314572800?alert("fichier vidÃ©o trop lourd (max 300Mo)"):PF.loadVideo(e,t)),a||alert("Le format du fichier n'est pas supportÃ©")}function loadImage(e){e=$(e).closest(".launcher"),e.on("click",function(){return!1});var t=e.attr("data-src"),a=$('<img class="inlineImage" onerror="error_im(this)" src="'+t+'"/>');a.on("load",function(){e.after(a),a.off(),e.remove()}),e.addClass("launcher-loading")}function loadVideo(e){e=$(e).closest(".launcher"),e.on("click",function(){return!1});var t=e.attr("data-src"),a=$('<video class="inlineImage" controls loop autoplay src="'+t+'"></video>');a.on("canplay",function(){e.after(a),a.off(),e.remove()}),e.addClass("launcher-loading")}function loadIframe(e){e=$(e).closest(".launcher");var t=e.attr("data-src"),a=$('<iframe class="embed-responsive-item" seamless allowfullscreen frameborder="0" scrollable="no" allowTransparency="true" src="'+t+'"/><iframe>');e.after(a),e.remove(),$("iframe:not([src])").remove()}function evaluateURL(){if(window.location.href.match(/\#[a-zA-Z0-9]+$/)){var e=window.location.href.replace(/.*\#([a-zA-Z0-9]+)/,"$1");if(24==e.length){var t=e;active_post!=t&&showpostviewer(t)}else"newpost"==e&&shownewpost()}else hideAll()}function hideAll(){hideslidefromleft("#mainmenu"),hideimageeditor(),hidepostviewer(),hidenewpost(),lightbox.darken()}function blockBody(){var e=parseInt($("body").attr("data-locks"));e||(e=0);var e=e+1;$("body").attr("data-locks",e),$("body").css({overflow:"hidden","max-height":"100%"})}function unblockBody(){var e=parseInt($("body").attr("data-locks"));e||(e=0);var e=e-1;1>e?($("body").attr("data-locks",0),$("body").css({overflow:"auto","max-height":"none"})):$("body").attr("data-locks",e)}function toggleoptionsmenu(e){g=$(e).find(".options-menu"),g.hasClass("active")?(g.css("display","none"),g.removeClass("active"),$(e).find("i").removeClass("fa-caret-up"),$(e).find("i").addClass("fa-caret-down")):(g.css("display","block"),g.addClass("active"),$(e).find("i").removeClass("fa-caret-down"),$(e).find("i").addClass("fa-caret-up"))}function toggleslidefromleft(e){g=$(e),g.hasClass("active")?hideslidefromleft(e):showslidefromleft(e)}function showslidefromleft(e){hideAll(),g=$(e),g.css({transform:"translateX(0)"}),g.addClass("active"),addMask("hideslidefromleft('"+e+"')",.75,20)}function hideslidefromleft(e){g=$(e),g.css({transform:"translateX(-100%)"}),g.removeClass("active"),removeMask()}function toggleslidefromright(e){g=$(e),g.hasClass("active")?hideslidefromright(e):showslidefromright(e)}function showslidefromright(e){hideAll(),g=$(e),g.css({transform:"translateX(50%)",right:"50%"}),g.addClass("active")}function hideslidefromright(e){g=$(e),g.css({transform:"translateX(100%)",right:"0px"}),g.removeClass("active")}function togglenewavatar(){pv=$("#newavatar"),pv.hasClass("active")?hideimageeditor():showimageeditor("#retouchebox")}function showimageeditor(e,t){if(pv=$("#newavatar"),pv.addClass("active"),pv.css("display","block"),addMask("hideimageeditor()",.75,699,"imageeditormask"),null!=t){var a=$(t).parent().find("img"),n=a.attr("src"),i=$(t).closest(".deletable").attr("data-src").replace(/[{:}]/g,"");r=$("#retoucheBox"),r.attr("data-action","addImage"),r.attr("data-arg",i),r.attr("data-w",a.attr("naturalWidth")),r.attr("data-h",a.attr("naturalHeight")),retouche.set(e,n)}else retouche.restart("#retoucheBox")}function hideimageeditor(){pv=$("#newavatar"),pv.removeClass("active"),pv.css("display","none"),$("#container").css("filter","none"),$("#container").css("-webkit-filter","none"),pv.html('<div id="retoucheBox"><div class="placeholder"><i class="label fa fa-photo"></i><span class="underLabel">Cliquez pour choisir une photo</span><input type="file"></input></div></div>'),removeMask("imageeditormask")}function push_shownewpost(){window.history.replaceState("newpost","",window.location.href.replace(/\#.*/,"")+"#newpost"),evaluateURL()}function shownewpost(){e=$("#newpost"),hideAll(),showslidefromright("#slidenewpost"),typebox.start("#typeBox"),invite=$('<div contenteditable="true" data-placeholder="Partagez quelque chose..."></div>'),$("#typeBox").html(invite),e.addClass("active"),addMask("push_hidenewpost()",.75)}function push_hideAll(){window.history.pushState("","",window.location.href.replace(/\#.*/,"")),evaluateURL()}function push_hidenewpost(e){window.history.replaceState("","",window.location.href.replace(/\#.*/,"")),hidenewpost(e)}function hidenewpost(t){if(t)var a=!0;else{var n=document.getElementById("typeBox").childNodes.length,i=document.getElementById("typeBox").childNodes[0].innerHTML.replace(/\<br\>/,"");if(1==n&&""==i)var a=!0;else var a=confirm("Voulez-vous vraiment annuler le message ?")}1==a&&(e=$("#newpost"),hideslidefromright("#slidenewpost"),$("#newpost").removeClass("active"),invite=$('<div contenteditable="true" data-placeholder="Partagez quelque chose..."></div>'),$("#typeBox").html(invite),typebox.stop("#typeBox"),removeMask())}function hidenewcommentsection(e){t=$(e),t.after('<div onclick="shownewcommentsection(this)" onfocus="shownewcommentsection(this)" class="new-comment-section" tabindex="1"><div class="fake-comment"><i class="fa fa-comment-o"></i>Ecrire un commentaire...</div></div>'),t.remove()}function shownewcommentsection(e){if(null==e&&(e=$("#post-viewer .new-comment-section").get(0)),t=$(e),fc=t.children(":first-child"),fc.hasClass("fake-comment")){fc.remove();var a=$('<div id="commentBox" class="dynamicBox"><div contenteditable="true" data-placeholder="Ecrire un commentaire..."></div></div>'),n=$('<div class="menu"></div>'),i=$('<div class="menu-cell"></div>');i.append('<button class="cancel" onclick="hidenewcommentsection($(\'.new-comment-section\'))">Annuler</button>');var o=$('<div class="menu-cell"></div>');o.append('<button onclick="inputFile(\'#commentBox\')" class="action"><i class="fa fa-paperclip"></i></button>');var s=$('<div class="menu-cell"></div>');s.append('<button class="send" onclick="sendIt(\'#commentBox\')">Envoyer</button>'),n.append(i),n.append(o),n.append(s),t.append(a).append(n),typebox.start("#commentBox"),typebox.Control.niceFocus("#commentBox")}}function push_showpost(e){window.history.pushState("{pid:"+e+"}","",window.location.href.replace(/\#.*/,"")+"#"+e),evaluateURL()}function showpostviewer(e){hideAll(),showslidefromright("#slidepostviewer"),spv=$("#slidepostviewer"),spv.addClass("active"),spv.append('<div class="nano"><div class="nano-content"></div></div>'),$("#slidepostviewer .nano .nano-content").append('<div id="post-viewer" tabindex="-1"></div>'),addMask("push_hideAll()",.75),$("#post-viewer").attr("data-id",e),$("#post-viewer").append('<div class="spinner"><div class="bg-white bounce1"></div><div class="bg-white bounce2"></div><div class="bg-white bounce3"></div></div>'),active_post=e,$.ajax({url:"Ajax/get.php",type:"GET",data:{action:"getPost",id:e},success:function(t){if(null==t||""==t)push_hideAll();else{recordUsage("post"),$("#post-viewer .spinner").remove(),$("#mask").addClass("dark-mask");var a=$(t.html);$("#post-viewer").append(a),$("#post-viewer").append('<div onclick="shownewcommentsection(this)" onfocus="shownewcommentsection(this)" class="new-comment-section" tabindex="1"><div class="fake-comment"><i class="fa fa-comment-o"></i>Ecrire un commentaire...</div></div>'),updatePostStats(e),lazyload($(".nano-content")[0]),$(".nano-content").on("scroll",function(e){lazyload(e.currentTarget)}),$("#post-viewer").focus()}},error:function(){}})}function hidepostviewer(){unblockBody(),hideslidefromright("#slidepostviewer");var e=$("#slidepostviewer");e.html(""),e.off(),removeMask(),typebox.stop("#commentBox"),active_post=0}function addMask(e,t,a,n){null==n&&(n="mask"),mask=$('<div class="mask" id="'+n+'" onclick="'+e+'"></div>'),$("body").append(mask),blockBody(),$("#"+n).css("background","rgba(0,0,0,"+t+")"),null!=a&&$("#"+n).css("z-index",a)}function removeMask(e){null==e&&(e="mask"),$("#"+e).remove(),unblockBody()}function lazyload(e){$(e).find("img.lazyload:not([src])").each(function(){for(var t=e.scrollTop+window.screen.height,a=this,n=a.offsetTop-10;!a.parentNode.className.match(/\.nano-content/)&&a.parentNode!=document.body;)a=a.parentNode,n+=a.offsetTop;t>n&&unveil(this)})}function unveil(e){""==e.src&&(e.src=e.dataset.src,e.onload=function(){e.style.opacity=1,e.removeAttribute("width"),e.removeAttribute("height")})}function fakeComment(){$("#info").attr("data-uid");$.ajax({url:"Ajax/post.php",type:"post",data:{action:"recordUsage",usage:usage},success:function(e){},error:function(){}});$('<div onclick="shownewcommentsection(this)" onfocus="shownewcommentsection(this)" class="new-comment-section" tabindex="1"><div class="fake-comment"><i class="fa fa-comment-o"></i>Ecrire un commentaire...</div></div>')}function error_im(e){e.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"}function utf8_encode(e){if(null===e||"undefined"==typeof e)return"";var t,a,n=e+"",i="",o=0;t=a=0,o=n.length;for(var s=0;o>s;s++){var r=n.charCodeAt(s),d=null;if(128>r)a++;else if(r>127&&2048>r)d=String.fromCharCode(r>>6|192,63&r|128);else if(55296!=(63488&r))d=String.fromCharCode(r>>12|224,r>>6&63|128,63&r|128);else{if(55296!=(64512&r))throw new RangeError("Unmatched trail surrogate at "+s);var c=n.charCodeAt(++s);if(56320!=(64512&c))throw new RangeError("Unmatched lead surrogate at "+(s-1));r=((1023&r)<<10)+(1023&c)+65536,d=String.fromCharCode(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}null!==d&&(a>t&&(i+=n.slice(t,a)),i+=d,t=a=s+1)}return a>t&&(i+=n.slice(t,o)),i}function str2md5(e){var t,a,n,i,o,s,r,d,c,l,u=function(e,t){return e<<t|e>>>32-t},p=function(e,t){var a,n,i,o,s;return i=2147483648&e,o=2147483648&t,a=1073741824&e,n=1073741824&t,s=(1073741823&e)+(1073741823&t),a&n?2147483648^s^i^o:a|n?1073741824&s?3221225472^s^i^o:1073741824^s^i^o:s^i^o},h=function(e,t,a){return e&t|~e&a},f=function(e,t,a){return e&a|t&~a},m=function(e,t,a){return e^t^a},g=function(e,t,a){return t^(e|~a)},v=function(e,t,a,n,i,o,s){return e=p(e,p(p(h(t,a,n),i),s)),p(u(e,o),t)},w=function(e,t,a,n,i,o,s){return e=p(e,p(p(f(t,a,n),i),s)),p(u(e,o),t)},b=function(e,t,a,n,i,o,s){return e=p(e,p(p(m(t,a,n),i),s)),p(u(e,o),t)},$=function(e,t,a,n,i,o,s){return e=p(e,p(p(g(t,a,n),i),s)),p(u(e,o),t)},x=function(e){for(var t,a=e.length,n=a+8,i=(n-n%64)/64,o=16*(i+1),s=new Array(o-1),r=0,d=0;a>d;)t=(d-d%4)/4,r=d%4*8,s[t]=s[t]|e.charCodeAt(d)<<r,d++;return t=(d-d%4)/4,r=d%4*8,s[t]=s[t]|128<<r,s[o-2]=a<<3,s[o-1]=a>>>29,s},y=function(e){var t,a,n="",i="";for(a=0;3>=a;a++)t=e>>>8*a&255,i="0"+t.toString(16),n+=i.substr(i.length-2,2);return n},k=[],_=7,C=12,I=17,A=22,j=5,E=9,T=14,S=20,R=4,M=11,N=16,L=23,P=6,z=10,U=15,B=21;for(e=this.utf8_encode(e),k=x(e),r=1732584193,d=4023233417,c=2562383102,l=271733878,t=k.length,a=0;t>a;a+=16)n=r,i=d,o=c,s=l,r=v(r,d,c,l,k[a+0],_,3614090360),l=v(l,r,d,c,k[a+1],C,3905402710),c=v(c,l,r,d,k[a+2],I,606105819),d=v(d,c,l,r,k[a+3],A,3250441966),r=v(r,d,c,l,k[a+4],_,4118548399),l=v(l,r,d,c,k[a+5],C,1200080426),c=v(c,l,r,d,k[a+6],I,2821735955),d=v(d,c,l,r,k[a+7],A,4249261313),r=v(r,d,c,l,k[a+8],_,1770035416),l=v(l,r,d,c,k[a+9],C,2336552879),c=v(c,l,r,d,k[a+10],I,4294925233),d=v(d,c,l,r,k[a+11],A,2304563134),r=v(r,d,c,l,k[a+12],_,1804603682),l=v(l,r,d,c,k[a+13],C,4254626195),c=v(c,l,r,d,k[a+14],I,2792965006),d=v(d,c,l,r,k[a+15],A,1236535329),r=w(r,d,c,l,k[a+1],j,4129170786),l=w(l,r,d,c,k[a+6],E,3225465664),c=w(c,l,r,d,k[a+11],T,643717713),d=w(d,c,l,r,k[a+0],S,3921069994),r=w(r,d,c,l,k[a+5],j,3593408605),l=w(l,r,d,c,k[a+10],E,38016083),c=w(c,l,r,d,k[a+15],T,3634488961),d=w(d,c,l,r,k[a+4],S,3889429448),r=w(r,d,c,l,k[a+9],j,568446438),l=w(l,r,d,c,k[a+14],E,3275163606),c=w(c,l,r,d,k[a+3],T,4107603335),d=w(d,c,l,r,k[a+8],S,1163531501),r=w(r,d,c,l,k[a+13],j,2850285829),l=w(l,r,d,c,k[a+2],E,4243563512),c=w(c,l,r,d,k[a+7],T,1735328473),d=w(d,c,l,r,k[a+12],S,2368359562),r=b(r,d,c,l,k[a+5],R,4294588738),l=b(l,r,d,c,k[a+8],M,2272392833),c=b(c,l,r,d,k[a+11],N,1839030562),d=b(d,c,l,r,k[a+14],L,4259657740),r=b(r,d,c,l,k[a+1],R,2763975236),l=b(l,r,d,c,k[a+4],M,1272893353),c=b(c,l,r,d,k[a+7],N,4139469664),d=b(d,c,l,r,k[a+10],L,3200236656),r=b(r,d,c,l,k[a+13],R,681279174),l=b(l,r,d,c,k[a+0],M,3936430074),c=b(c,l,r,d,k[a+3],N,3572445317),d=b(d,c,l,r,k[a+6],L,76029189),r=b(r,d,c,l,k[a+9],R,3654602809),l=b(l,r,d,c,k[a+12],M,3873151461),c=b(c,l,r,d,k[a+15],N,530742520),d=b(d,c,l,r,k[a+2],L,3299628645),r=$(r,d,c,l,k[a+0],P,4096336452),l=$(l,r,d,c,k[a+7],z,1126891415),c=$(c,l,r,d,k[a+14],U,2878612391),d=$(d,c,l,r,k[a+5],B,4237533241),r=$(r,d,c,l,k[a+12],P,1700485571),l=$(l,r,d,c,k[a+3],z,2399980690),c=$(c,l,r,d,k[a+10],U,4293915773),d=$(d,c,l,r,k[a+1],B,2240044497),r=$(r,d,c,l,k[a+8],P,1873313359),l=$(l,r,d,c,k[a+15],z,4264355552),c=$(c,l,r,d,k[a+6],U,2734768916),d=$(d,c,l,r,k[a+13],B,1309151649),r=$(r,d,c,l,k[a+4],P,4149444226),l=$(l,r,d,c,k[a+11],z,3174756917),c=$(c,l,r,d,k[a+2],U,718787259),d=$(d,c,l,r,k[a+9],B,3951481745),r=p(r,n),d=p(d,i),c=p(c,o),l=p(l,s);var H=y(r)+y(d)+y(c)+y(l);return H.toLowerCase()}function htmlentities(e,t,a,n){var i=this.get_html_translation_table("HTML_ENTITIES",t),o="";if(e=null==e?"":e+"",!i)return!1;if(t&&"ENT_QUOTES"===t&&(i["'"]="&#039;"),n||null==n)for(o in i)i.hasOwnProperty(o)&&(e=e.split(o).join(i[o]));else e=e.replace(/([\s\S]*?)(&(?:#\d+|#x[\da-f]+|[a-zA-Z][\da-z]*);|$)/g,function(e,t,a){for(o in i)i.hasOwnProperty(o)&&(t=t.split(o).join(i[o]));return t+a});return e}function html_entity_decode(e,t){var a={},n="",i="",o="";if(i=e.toString(),!1===(a=this.get_html_translation_table("HTML_ENTITIES",t)))return!1;delete a["&"],a["&"]="&amp;";for(n in a)o=a[n],i=i.split(o).join(n);return i=i.split("&#039;").join("'")}function get_html_translation_table(e,t){var a,n={},i={},o={},s={},r={},d={};if(o[0]="HTML_SPECIALCHARS",o[1]="HTML_ENTITIES",s[0]="ENT_NOQUOTES",s[2]="ENT_COMPAT",s[3]="ENT_QUOTES",r=isNaN(e)?e?e.toUpperCase():"HTML_SPECIALCHARS":o[e],d=isNaN(t)?t?t.toUpperCase():"ENT_COMPAT":s[t],"HTML_SPECIALCHARS"!==r&&"HTML_ENTITIES"!==r)throw new Error("Table: "+r+" not supported");n[38]="&amp;","HTML_ENTITIES"===r&&(n[160]="&nbsp;",n[161]="&iexcl;",n[162]="&cent;",n[163]="&pound;",n[164]="&curren;",n[165]="&yen;",n[166]="&brvbar;",n[167]="&sect;",n[168]="&uml;",n[169]="&copy;",n[170]="&ordf;",n[171]="&laquo;",n[172]="&not;",n[173]="&shy;",n[174]="&reg;",n[175]="&macr;",n[176]="&deg;",n[177]="&plusmn;",n[178]="&sup2;",n[179]="&sup3;",n[180]="&acute;",n[181]="&micro;",n[182]="&para;",n[183]="&middot;",n[184]="&cedil;",n[185]="&sup1;",n[186]="&ordm;",n[187]="&raquo;",n[188]="&frac14;",n[189]="&frac12;",n[190]="&frac34;",n[191]="&iquest;",n[192]="&Agrave;",n[193]="&Aacute;",n[194]="&Acirc;",n[195]="&Atilde;",n[196]="&Auml;",n[197]="&Aring;",n[198]="&AElig;",n[199]="&Ccedil;",n[200]="&Egrave;",n[201]="&Eacute;",n[202]="&Ecirc;",n[203]="&Euml;",n[204]="&Igrave;",n[205]="&Iacute;",n[206]="&Icirc;",n[207]="&Iuml;",n[208]="&ETH;",n[209]="&Ntilde;",n[210]="&Ograve;",n[211]="&Oacute;",n[212]="&Ocirc;",n[213]="&Otilde;",n[214]="&Ouml;",n[215]="&times;",n[216]="&Oslash;",n[217]="&Ugrave;",n[218]="&Uacute;",n[219]="&Ucirc;",n[220]="&Uuml;",n[221]="&Yacute;",n[222]="&THORN;",n[223]="&szlig;",n[224]="&agrave;",n[225]="&aacute;",n[226]="&acirc;",n[227]="&atilde;",n[228]="&auml;",n[229]="&aring;",n[230]="&aelig;",n[231]="&ccedil;",n[232]="&egrave;",n[233]="&eacute;",n[234]="&ecirc;",n[235]="&euml;",n[236]="&igrave;",n[237]="&iacute;",n[238]="&icirc;",n[239]="&iuml;",n[240]="&eth;",n[241]="&ntilde;",n[242]="&ograve;",n[243]="&oacute;",n[244]="&ocirc;",n[245]="&otilde;",n[246]="&ouml;",n[247]="&divide;",n[248]="&oslash;",n[249]="&ugrave;",n[250]="&uacute;",n[251]="&ucirc;",n[252]="&uuml;",n[253]="&yacute;",n[254]="&thorn;",n[255]="&yuml;"),"ENT_NOQUOTES"!==d&&(n[34]="&quot;"),"ENT_QUOTES"===d&&(n[39]="&#39;"),n[60]="&lt;",n[62]="&gt;";for(a in n)n.hasOwnProperty(a)&&(i[String.fromCharCode(a)]=n[a]);return i}function br2nl(e){return e.replace(/<br\s*\/?>/gi,"\n")}function nl2br(e){return e.replace(/\n|\r|\n\r|\r\n/g,"<br>")}function decode(e){return br2nl(html_entity_decode(e,"ENT_NOQUOTES"))}function encode(e){return nl2br(htmlentities(e,"ENT_NOQUOTES"))}function dataURItoBlob(e){for(var t=atob(e.split(",")[1]),a=e.split(",")[0].split(":")[1].split(";")[0],n=new ArrayBuffer(t.length),i=new Uint8Array(n),o=0;o<t.length;o++)i[o]=t.charCodeAt(o);return new Blob([i],{type:a})}function createId(){var e=Date.now().toString(36),t=Math.random().toString(36).slice(2),a=document.documentElement.innerHTML.hashCode().toString(36).slice(1);return e+t+a}!function(e,t){function a(e){$("#landing .login-form").on("submit",function(e){e.preventDefault(),$(".form-notif").addClass("hidden"),action=$(this).children(".action").val(),mail=$(this).children(".mail").val(),password=$(this).children(".password").val(),password_conf=$(this).children(".password-confirmation").val(),action=$(this).attr("data-action"),"passwordReset"!=$(this).attr("data-action")?mail.match(/[\.\-\w]+\@[\.\-\w]+\.[\.\-\w]+/)?$(".password-confirmation").hasClass("hidden")||password==password_conf||""==password_conf?$.ajax({url:"Ajax/connect.php",type:"POST",data:{action:action,mail:mail,password:password,password_conf:password_conf},success:function(e){"fail"!=e?window.location.reload():($(".form-notif").html("Mauvais mot de passe ou identifiant"),$(".form-notif").removeClass("hidden"))},error:function(){}}):($(".form-notif").html("Les mots de passe ne correspondent pas"),$(".form-notif").removeClass("hidden")):($(".form-notif").html("Votre mail semble Ãªtre incorrect"),$(".form-notif").removeClass("hidden")):$.ajax({url:"Ajax/post.php",type:"POST",data:{action:action,mail:mail},success:function(e){window.location.reload()},error:function(){}})})}function n(){$("#landing > .login-form").off()}function i(){"login"==$("#landing .login-form").attr("data-action")?landing.switchToSignup():landing.switchToLogin()}function o(){$(".form-notif").addClass("hidden"),$("#landing .signin").html("S'inscrire"),$("#landing .center-form .title-form").html("Se connecter"),$("#landing .login-form").attr("data-action","login"),$('*[name="password"]').addClass("borderBottom").removeClass("borderMiddle").removeClass("hidden"),$('*[name="password-confirmation"]').addClass("hidden"),$("#landing .center-form .action").removeClass("hidden"),$("#landing .background").css("background-image",'url("Assets/Backgrounds/16b.jpg"), url("Assets/Backgrounds/small/16b.jpg")')}function s(){$(".form-notif").addClass("hidden"),$("#landing .signin").html("Se connecter"),$("#landing .center-form .title-form").html("S'inscrire"),$("#landing .login-form").attr("data-action","signup"),$('*[name="password"]').removeClass("borderBottom").addClass("borderMiddle").removeClass("hidden"),$('*[name="password-confirmation"]').removeClass("hidden"),$("#landing .center-form .action").addClass("hidden"),$("#landing .background").css("background-image",'url("Assets/Backgrounds/1b.jpg"), url("Assets/Backgrounds/small/1b.jpg")')}function r(){$(".form-notif").addClass("hidden"),$("#landing .signin").html("Se connecter"),$("#landing .center-form .title-form").html("RÃ©initialiser votre mot de passe"),$("#landing .login-form").attr("data-action","passwordReset"),$('*[name="password"]').addClass("hidden"),$('*[name="password-confirmation"]').addClass("hidden"),$("#landing .center-form .action").addClass("hidden"),$("#landing .background").css("background-image",'url("Assets/Backgrounds/1.jpg"), url("Assets/Backgrounds/small/1.jpg")')}e.start=a,e.stop=n,e.switchForm=i,e.switchToLogin=o,e.switchToSignup=s,e.switchToPasswordReset=r,t.landing=e}({},function(){return this}()),!function(e,t){function a(e){for(var t=$(e).closest(".deletable").next().find("img.zoomPossible")[0],a=$(e).closest(".post").nextUntil("post"),n=0;30>n&&"undefined"==typeof t&&a.length>0;)a=$(a.get(0)),t=a.find(".deletable img.zoomPossible")[0],a=a.nextUntil("post"),n++;return t}function n(e){for(var t=$(e).closest(".deletable").prev().find("img.zoomPossible")[0],a=$(e).closest(".post").prevUntil("post"),n=0;30>n&&"undefined"==typeof t&&a.length>0;)a=$(a.get(0)),t=a.find(".deletable img.zoomPossible")[0],a=a.prevUntil("post"),n++;return t}function i(e){var t=$(e)[0];if(null!=t.dataset.lightbox)var a=t.dataset.lightbox;else var a=t.src;lightbox.darken();for(var n=t,i=n.offsetTop-10;!n.parentNode.className.match(/\.nano-content/)&&n.parentNode!=document.body;)n=n.parentNode,i+=n.offsetTop;$(".nano-content")[0].scrollTop=i;var o=lightbox.searchNext(t),s=lightbox.searchPrevious(t),r=new Image;r.onload=function(){var e=this.naturalWidth,t=this.naturalHeight,a=Math.min(e,.95*(window.innerWidth-10));t=a/e*t;var n=Math.min(t,.95*(window.innerHeight-10));a=n/t*a,$("body").css({overflow:"hidden","max-height":"100%"});var i=$('<div id="lightbox"></div>');if("undefined"!=typeof s){$(s).addClass("lightbox_prev"),unveil(s);var r=$('<div onclick="lightbox.enlighten(\'.lightbox_prev\')" class="prev"><i class="fa fa-arrow-left"></i></div>');$(window).on("keydown",function(e){37==e.which&&r.click()})}if("undefined"!=typeof o){$(o).addClass("lightbox_next"),unveil(o);var d=$('<div onclick="lightbox.enlighten(\'.lightbox_next\')" class="next"><i class="fa fa-arrow-right"></i></div>');$(window).on("keydown",function(e){39==e.which&&d.click()})}var c=$('<div class="close material-shadow" onclick="lightbox.darken()"><i class="fa fa-close"></i></div>');$(this).attr("onclick","lightbox.darken()").addClass("zoomedImage"),i.css({top:(window.innerHeight-n)/2+"px",left:(window.innerWidth-a)/2+"px",width:a+"px",height:n+"px"}),i.append(d).append(r).append(this).append(c),$("body").append(i),$(window).on("keydown",function(e){27==e.which&&lightbox.darken()})},r.src=a,mask=$('<div class="lightbox-mask" onclick="lightbox.darken()"></div>'),mask.append('<div class="spinner"><div class="bg-white bounce1"></div><div class="bg-white bounce2"></div><div class="bg-white bounce3"></div></div>'),
$("body").append(mask)}function o(){$("#lightbox").remove(),$(".lightbox-mask").remove(),$(".lightbox_next").removeClass("lightbox_next"),$(".lightbox_prev").removeClass("lightbox_prev"),$(window).off("keydown")}e.searchNext=a,e.searchPrevious=n,e.enlighten=i,e.darken=o,t.lightbox=e}({},function(){return this}()),!function(e,t){function a(e,t){var a=document.createElement("video");a.controls=!0,a.autoplay=!0,a.onloadeddata=function(){$('*[data-id="'+t+'"]').remove();var n=createId();PF.showVideo(a,t,n),PF.sendVideo(e,n)},a.src=URL.createObjectURL(e)}function n(e,t,a){var n=$('<span data-src="{:'+a+':}" class="deletable deletable-block" contenteditable="false"></span>');n.append(e),$(t).append(n),$(t).append('<div contenteditable="true"></div>')}function i(e,t){var a=new FormData,n=$("#info").attr("data-uid");a.append("video",e),a.append("fileId",t),a.append("uid",n),a.append("action","addVideo");var i=$('<div class="progressBar"><div class="progress"></div><div class="conversion"></div></div>');$('*[data-src="{:'+t+':}"]').append(i),$.ajax({url:"Ajax/post.php",type:"POST",data:a,success:function(e){window.sending=window.sending-1},error:function(){window.sending=window.sending-1},processData:!1,contentType:!1,xhr:function(){var e=$.ajaxSettings.xhr();return e.upload.onprogress=function(e){var a=parseInt(e.loaded/e.total*100);content=$('*[data-src="{:'+t+':}"]'),content.find(".progressBar .progress").css("width",a+"%")},e.upload.onload=function(){setTimeout(function(){o(t)},500)},e}}),window.sending=window.sending+1}function o(e){pid=setInterval(function(){$.ajax({url:"Ajax/get.php",type:"GET",data:{fileId:e,action:"getProgress"},success:function(t){if(t.progress){content=$('*[data-src="{:'+e+':}"]');var a=content.find("video")[0].duration,n=t.progress.replace(/\r?\n|\r/g,"")/1e6,i=n/a*100;content.find(".progressBar .conversion").css("width",i+"%")}else clearInterval(pid),content=$('*[data-src="{:'+e+':}"]'),content.find(".progressBar").remove()},error:function(){clearInterval(pid),content=$('*[data-src="{:'+e+':}"]'),content.find(".progressBar").remove()}})},1e3)}function s(e,t){var a=new Image;a.onload=function(){canvas=document.createElement("canvas"),w=Math.min(this.width,1024),h=Math.min(this.height,1024),g=Math.min(w/a.width,h/a.height),canvas.width=this.width*g,canvas.height=this.height*g,ctx=canvas.getContext("2d"),ctx.drawImage(a,0,0,this.width*g,this.height*g),delete a;var e=createId();PF.showImage(canvas,t,e),PF.sendImage(canvas,e)},a.src=URL.createObjectURL(e)}function r(e,t,a){var n=$('<span data-src="{:'+a+':}" class="deletable deletable-block" contenteditable="false"></span>');n.append(e),$(t).append(n),$(t).append('<div contenteditable="true"></div>')}function d(e,t){var a=e.toDataURL("image/png");delete e;var n=new FormData,i=$("#info").attr("data-uid");n.append("image",dataURItoBlob(a)),n.append("fileId",t),n.append("uid",i),n.append("action","addImage");var o=$('<div class="progressBar"><div class="progress"></div></div>');$('*[data-src="{:'+t+':}"]').append(o),$.ajax({url:"Ajax/post.php",type:"POST",data:n,success:function(e){window.sending=window.sending-1},error:function(){window.sending=window.sending-1},processData:!1,contentType:!1,xhr:function(){var e=$.ajaxSettings.xhr();return e.upload.onprogress=function(e){var a=parseInt(e.loaded/e.total*100);content=$('*[data-src="{:'+t+':}"]'),content.find(".progressBar .progress").css("width",a+"%")},e.upload.onload=function(){setTimeout(function(){content=$('*[data-src="{:'+t+':}"]'),content.find(".progressBar").remove()},1e3)},e}}),window.sending=window.sending+1}e.loadVideo=a,e.showVideo=n,e.sendVideo=i,e.trackProgress=o,e.loadImage=s,e.showImage=r,e.sendImage=d,t.PF=e}({},function(){return this}()),!function(e,a){function n(e,t){var a=new Image,n=$(e).find("canvas")[0],i=(n.getContext("2d"),n.toDataURL("image/png"));a.onload=function(){delete i;var o=document.createElement("canvas");o.height=a.width,o.width=a.height,o.dataset.h=a.width,o.dataset.w=a.height,o.style.width=n.style.height,o.style.height=n.style.width;var s=o.getContext("2d");s.translate(o.width/2,o.height/2),s.rotate(t),s.translate(-o.height/2,-o.width/2),s.drawImage(a,0,0,a.width,a.height),$(n).after(o),$(n).remove(),delete a,0!=$(e).find(".zone").length&&retouche.initHandles(e)},a.src=i}function i(e){z=$(e+" > .zone")[0],x=document.querySelector(e).offsetHeight,y=document.querySelector(e).offsetWidth,w=parseInt($(e).attr("data-w")),h=parseInt($(e).attr("data-h")),(null==w||null==h)&&(w=h=128),u(z,(x-h)/2,(y-w)/2,w,h)}function o(e){zone=$('<div data-movable="true" class="zone"></div>'),cachetop=$('<div class="cachetop cache"></div>'),cachebottom=$('<div class="cachebottom cache"></div>'),cacheleft=$('<div class="cacheleft cache"></div>'),cacheright=$('<div class="cacheright cache"></div>'),handletl=$('<div class="unselectable handlecontainer handletl"><div class="handle"></div></div>'),handletr=$('<div class="unselectable handlecontainer handletr"><div class="handle"></div></div>'),handlebl=$('<div class="unselectable handlecontainer handlebl"><div class="handle"></div></div>'),handlebr=$('<div class="unselectable handlecontainer handlebr"><div class="handle"></div></div>'),$(e).append(zone),$(e).append(cachetop),$(e).append(cachebottom),$(e).append(cacheleft),$(e).append(cacheright),$(e).append(handletl),$(e).append(handletr),$(e).append(handlebl),$(e).append(handlebr),z=$(e+" > .zone")[0],k(z,"movable",null,e),retouche.initHandles(e),z=$(e+" > .handletl")[0],k(z,"resizeHandletl",e+" > .zone",e),z=$(e+" > .handletr")[0],k(z,"resizeHandletr",e+" > .zone",e),z=$(e+" > .handlebl")[0],k(z,"resizeHandlebl",e+" > .zone",e),z=$(e+" > .handlebr")[0],k(z,"resizeHandlebr",e+" > .zone",e)}function s(e,t){window.retouche.img=e,canvas=document.createElement("canvas");var a=Math.min(e.width,1024),n=Math.min(e.height,1024),i=Math.min(e.width,Math.min(1024,Math.min(window.innerWidth,window.innerHeight)-100)),o=Math.min(e.height,Math.min(1024,Math.min(window.innerWidth,window.innerHeight)-100)),s=Math.min(i/e.width,o/e.height),r=Math.min(a/e.width,n/e.height);canvas.width=e.width*r,canvas.height=e.height*r,canvas.style.width=e.width*s,canvas.style.height=e.height*s,ctx=canvas.getContext("2d"),ctx.drawImage(e,0,0,e.width*r,e.height*r),canvas.dataset.w=e.width*r,canvas.dataset.h=e.height*r,URL.revokeObjectURL(e.src),e=null,delete e,$(t).html(canvas),v(t),"changeAvatar"==$(t).attr("data-action")&&retouche.addHandles(t);var d=$('<div class="menu"></div>'),c=$('<div class="menu-cell"><button onclick="togglenewavatar()" class="material-button">Annuler</button></div>'),l=$('<div class="menu-cell"><button onclick="retouche.turn(\''+t+'\',-Math.PI/2)" class="material-button"><i class="fa fa-rotate-left"></i></button></div>'),u=$('<div class="menu-cell"><button onclick="retouche.turn(\''+t+'\',Math.PI/2)" class="material-button"><i class="fa fa-rotate-right"></i></button></div>'),p=$('<div class="menu-cell"><button onclick="retouche.sendCanvas(\''+t+'\')" class="material-button">Envoyer</button></div>');d.append(c),d.append(l),d.append(u),d.append(p),$(t).parent().append(d)}function d(e,t){img=new Image,img.onload=function(){retouche.loadCanvas(img,t)},img.src=URL.createObjectURL(e)}function c(e){id=e.data;var t=e.target.files[0];t.type.match("image.*")&&($(id+" > i").removeClass("fa-photo").addClass("fa-cog fa-spin").css({top:"calc(50% - 25px)",left:"calc(50% - 25px)"}),d(t,id))}function u(e,t,a,n,i){p=e.parentNode,n=Math.max(n,64),i=Math.max(i,64),n=Math.min(n,p.offsetWidth),i=Math.min(i,p.offsetHeight),g=p.dataset.w/p.dataset.h,n/i!=g&&(n=g*i),t=Math.max(t,0),a=Math.max(a,0),t=Math.min(t,p.offsetHeight-i),a=Math.min(a,p.offsetWidth-n),t=parseInt(t),a=parseInt(a),n=parseInt(n),i=parseInt(i),e.style.width=n,e.style.height=i,e.style.top=t,e.style.left=a,ct=e.nextSibling,ct.style.height=t,cb=ct.nextSibling,cb.style.top=t+i,cl=cb.nextSibling,cl.style.height=i,cl.style.width=a,cl.style.top=t,cr=cl.nextSibling,cr.style.height=i,cr.style.top=t,cr.style.left=a+n,htl=cr.nextSibling,htl.style.top=t-12,htl.style.left=a-12,htr=htl.nextSibling,htr.style.top=t-12,htr.style.left=a-12+n,hbl=htr.nextSibling,hbl.style.top=t-12+i,hbl.style.left=a-12,hbr=hbl.nextSibling,hbr.style.top=t-12+i,hbr.style.left=a-12+n}function m(e,t,a,n,i){window.s=new Object,window.s.elmt=e.target,window.s.type=a,window.blockScroll=!0,"mousedown"==e.type?(cx=e.clientX,cy=e.clientY):(cx=e.touches[0].clientX,cy=e.touches[0].clientY),rect=e.target.getBoundingClientRect(),offsetX=parseInt(cx-rect.left),offsetY=parseInt(cy-rect.top),window.s.offsetX=offsetX,window.s.offsetY=offsetY,window.s.clientX=parseInt(cx),window.s.clientY=parseInt(cy),window.s.action=document.querySelector(n),z=document.querySelector(i+" > .zone"),window.s.t=parseInt(z.style.top),window.s.l=parseInt(z.style.left),window.s.w=z.offsetWidth,window.s.h=z.offsetHeight}function v(e){$(e+" .label").remove(),$(e+" .underLabel").remove(),$(e+" input").remove()}function b(e){null!=window.s&&null!=window.s.type&&("mousemove"==e.type?(cx=e.clientX,cy=e.clientY):(cx=e.touches[0].clientX,cy=e.touches[0].clientY),"movable"==window.s.type&&(r=window.s.elmt.parentNode.getBoundingClientRect(),t=cy-r.top-window.s.offsetY,l=cx-r.left-window.s.offsetX,w=window.s.w,h=window.s.h,(l!=window.s.l||t!=window.s.t)&&u(window.s.elmt,t,l,w,h)),"r"==window.s.type[0]&&(target=window.s.action,t=window.s.t,l=window.s.l,w=window.s.w,h=window.s.h,mx=cx-window.s.clientX,my=cy-window.s.clientY,g=0,"resizeHandletl"==window.s.type&&(g=(-mx-my)/2,t-=g,l-=g),"resizeHandletr"==window.s.type&&(g=(mx-my)/2,t-=g),"resizeHandlebl"==window.s.type&&(g=(-mx+my)/2,l-=g),"resizeHandlebr"==window.s.type&&(g=(mx+my)/2),w+=g,h+=g,(t!=window.s.t||l!=window.s.l||w!=window.s.w||h!=window.s.h)&&u(target,t,l,w,h)))}function k(e,t,a,n){e.addEventListener("mousedown",function(i){m(i,e,t,a,n)},!1),e.addEventListener("touchstart",function(i){m(i,e,t,a,n)},!1)}function _(e){document.body.addEventListener("mousemove",function(e){b(e)},!1),document.body.addEventListener("touchmove",function(e){b(e)},!1),document.body.addEventListener("mouseup",function(){window.s=null},!1),document.body.addEventListener("touchend",function(){window.s=null,window.blockScroll=!1},!1),$(window).on("touchmove",function(e){window.blockScroll&&e.preventDefault()}),C(e)}function C(e){$(e+" input").off(),$(e+" input").on("change",null,e,c)}function I(e){$(e+" > input").off()}function A(e,t){var a=new Image;a.onload=function(){s(a,e)},a.src=t}function j(e){canvas=document.querySelector(e+" canvas");var a=canvas.getContext("2d"),n=$(e).attr("data-action"),i=$(e).attr("data-arg");if("changeAvatar"==n){g=canvas.offsetWidth/parseInt(canvas.dataset.w),z=document.querySelector(e+" > .zone"),l=parseInt(z.style.left)/g,t=parseInt(z.style.top)/g,w=parseInt(z.style.width)/g,h=parseInt(z.style.height)/g,data=a.getImageData(l,t,w,h);var o=$(e).attr("data-w"),s=$(e).attr("data-h");null!=o&&null!=s?g=Math.min(Math.max(w,o)/w,Math.max(h,s)/h):g=Math.min(Math.max(w,1024)/w,Math.max(h,1024)/h)}else g=1,w=$(e).find("canvas").attr("data-w"),h=$(e).find("canvas").attr("data-h"),data=a.getImageData(0,0,canvas.dataset.w,canvas.dataset.h);c2=document.createElement("canvas"),c2.width=parseInt(w),c2.height=parseInt(h),ctx2=c2.getContext("2d"),ctx2.putImageData(data,0,0),imgURL=c2.toDataURL("image/png"),delete c2,delete ctx2,c3=document.createElement("canvas"),c3.width=parseInt(w*g),c3.height=parseInt(h*g),ctx3=c3.getContext("2d"),ctx3.transform(g,0,0,g,0,0);var r=new Image;r.onload=function(){ctx3.drawImage(r,0,0),delete imgURL,imgURL=c3.toDataURL("image/png"),delete c3,delete ctx3,delete r,f=new FormData,f.append("image",dataURItoBlob(imgURL));var t=$("#info").attr("data-uid"),a=$("#info").attr("data-fid");f.append("uid",t),f.append("fid",a),f.append("action",n),f.append("fileId",i),$.ajax({url:"Ajax/post.php",type:"POST",data:f,success:function(e){location.reload()},error:function(){},processData:!1,contentType:!1});var o=$('<div class="loading-retouche"><div class="spinner"><div class="bg-white bounce1"></div><div class="bg-white bounce2"></div><div class="bg-white bounce3"></div></div></div>');$(e).parent().append(o)},r.src=imgURL}URL=window.URL||window.webkitURL,e.turn=n,e.initHandles=i,e.addHandles=o,e.loadCanvas=s,e.loadImage=d,e.handleFileSelect=c,e.setZone=u,e.downEvent=m,e.stopInput=v,e.moveEvent=b,e.setAsType=k,e.start=_,e.restart=C,e.stop=I,e.set=A,e.sendCanvas=j,a.retouche=e}({},function(){return this}()),!function(e,t){function a(){for(var e=$(".slideshow"),t=0;t<e.length;t++)$(e.get(t)).find(".current").attr("src",e.get(t).childNodes[0].dataset.src),$(e.get(t)).attr("data-current",0)}function n(e){var t=$(e).closest(".slideshow"),a=parseInt(t.attr("data-current"));a+=1,t.find(".photo").length<=a&&(a=0),t.find(".current").attr("src",t.get(0).childNodes[a].dataset.src),t.attr("data-current",a)}function i(e){var t=$(e).closest(".slideshow"),a=parseInt(t.attr("data-current"));a-=1,0>a&&(a=t.find(".photo").length-1),t.find(".current").attr("src",t.get(0).childNodes[a].dataset.src),t.attr("data-current",a)}e.init=a,e.next=n,e.previous=i,t.slideshow=e}({},function(){return this}()),albumFiles=window.albumFiles=[],URL=window.URL||window.webkitURL,sending=0,active_post=0,loading_posts=!1,$(window).ready(function(){document.body.onload=function(){var e=(new Date).getTime()-window.startLoading;$.ajax({url:"Ajax/post.php",type:"post",data:{action:"saveRecord",loadingTime:e,screenHeight:screen.height,screenWidth:screen.width},success:function(e){},error:function(){}})},$(function(){FastClick.attach(document.body)}),""!=$("#info").attr("data-fid")&&$(document).on("scroll",function(){window.pageYOffset+window.innerHeight>document.body.scrollHeight-window.innerHeight/2&&loadMorePosts()}),window.onresize=function(){loadMorePosts()},window.ctrl=!1,$(window).keydown(function(e){17!=e.keyCode&&e.ctrlKey?window.ctrl=!0:window.ctrl=!1}),retouche.start("#retoucheBox"),setpostsviewable(),"undefined"!=typeof SC&&SC.initialize({client_id:"01af1b3315ad8177aefecab596621e09"}),0!=$("#info").length&&(evaluateURL(),$(window).on("popstate",function(){evaluateURL()})),$(window).on("beforeunload",function(e){return window.sending>0?"Upload en cours !":void 0}),setInterval(function(){$(".nano").nanoScroller()},1e3),loadMorePosts()}),!function(t,a){function n(e){var t=$(e)[0];c.filter_out_all(t)}function o(e){$(e).off()}function s(e){var t=$(e)[0],a=$(e);a.off(),a.on("paste",function(a){a.preventDefault(),a.stopPropagation();var n="",i=$(this);return a.clipboardData?n=a.clipboardData.getData("text/plain"):window.clipboardData?n=window.clipboardData.getData("Text"):a.originalEvent.clipboardData&&(n=$("<div></div>").text(a.originalEvent.clipboardData.getData("text"))),document.queryCommandSupported("insertText")?(document.execCommand("insertHTML",!1,$(n).html()),t=$(e)[0],c.filter_out_all(t),!1):(i.find("*").each(function(){$(this).addClass("within")}),setTimeout(function(){i.find("*").each(function(){$(this).not(".within").contents().unwrap()})},1),!1)}),a.on("keydown",function(e){if(13===e.keyCode){if(!e.ctrlKey)return cpos=c.getCpos(document.activeElement),e.target.innerHTML.trim().match(/\<br\>$/)?typebox.pasteHtmlAtCaret("<br>",!1):(typebox.pasteHtmlAtCaret("<br>",!1),e.target.innerHTML=e.target.innerHTML+"<br>"),c.setCpos(document.activeElement,parseInt(cpos+1)),cpos=c.getCpos(document.activeElement),!1;a.parent().find(".menu .send").click()}}),a.on("keyup",function(a){if((!a.ctrlKey&&17!=a.keyCode&&!window.ctrl||86==a.keyCode)&&$(":focus").parent().is(e)){if(8==a.keyCode&&""==$(":focus").html())return a.preventDefault(),a.stopPropagation(),!1;(null==window.typed||window.typed!=$(e).html())&&(a.target.textContent.match(/https?:\/\/[^\s]+/i)||a.target.textContent.match(/\{\:[A-Za-z0-9]+\:\}/i))&&(t=$(e)[0],cpos=c.getCpos(document.activeElement),13==a.keyCode?c.filter_out_ending(t):c.filter_out_search(t),0!=cpos&&(13==a.keyCode?bias=1:bias=0,bias=0,c.setCpos(document.activeElement,parseInt(cpos+bias))),window.typed=$(e).html())}}),$(e).on("click",function(e){e.currentTarget==e.target&&c.niceFocus(e.currentTarget)})}function r(){$(".post .dynamicBox").each(function(){c.filter_out_all(this,!0),$(this).find("*[contenteditable=true]").removeAttr("contenteditable"),lazyload($(this).closest(".nano-content")[0])})}function d(e,t){var a,n;if(window.getSelection){if(a=window.getSelection(),a.getRangeAt&&a.rangeCount){n=a.getRangeAt(0),n.deleteContents();var i=document.createElement("div");i.innerHTML=e;for(var o,s,r=document.createDocumentFragment();o=i.firstChild;)s=r.appendChild(o);var d=r.firstChild;n.insertNode(r),s&&(n=n.cloneRange(),n.setStartAfter(s),t?n.setStartBefore(d):n.collapse(!0),a.removeAllRanges(),a.addRange(n))}}else if((a=document.selection)&&"Control"!=a.type){var c=a.createRange();c.collapse(!0),a.createRange().pasteHTML(e),t&&(n=a.createRange(),n.setEndPoint("StartToStart",c),n.select())}}var c={mergeEditableNodes:function(e){for(i=0;i<e.childNodes.length;i++)"DIV"==e.childNodes[i].tagName&&null!=e.childNodes[i-1]&&"DIV"==e.childNodes[i-1].tagName&&(e.childNodes[i-1].innerHTML+="<br>"+e.childNodes[i].innerHTML,e.removeChild(e.childNodes[i]))},searchFilter:function(e,t,a,n){for(toProcess=[],i=0;i<e.childNodes.length;i++)node=e.childNodes[i],"DIV"==node.tagName&&toProcess.push(node);for(i=0;i<toProcess.length;i++){var o=[];if(o[0]="",node=toProcess[i],inner=node.innerHTML,o=t(inner,n,a),o.length>1||o[0]!=node.innerHTML?hasChanged=!0:hasChanged=!1,hasChanged){var s="";if(o.length>1)for(j=o.length-1;j>0;j--)node.insertAdjacentHTML("afterend",o[j]),""==s&&(s=node.nextSibling.id);if(o[0].match(/^\s*$/)?a?$(node).remove():$(node).attr("data-placeholder","").html(""):node.innerHTML=o[0],!a&&""!=s){var r=setInterval(function(){var e=document.getElementById(s);e.scrollHeight>0&&(e.nextSibling.scrollIntoView(!1),clearInterval(r))},100);setTimeout(function(){clearInterval(r)},1e4)}}(null==a||0==a)&&c.refocus(e)}c.refreshContent(a,e)},getCpos:function(e){var t,a=0,n=e.ownerDocument||e.document,i=n.defaultView||n.parentWindow;if("undefined"!=typeof i.getSelection){if(t=i.getSelection(),t.rangeCount>0){var o=i.getSelection().getRangeAt(0),s=o.cloneRange();s.selectNodeContents(e),s.setEnd(o.endContainer,o.endOffset),a=s.toString().length}}else if((t=n.selection)&&"Control"!=t.type){var r=t.createRange(),d=n.body.createTextRange();d.moveToElementText(e),d.setEndPoint("EndToEnd",r),a=d.text.length}var c=$(e).find("br").length;return a+=c},setCpos:function(e,t){var a=!1;for(t=parseInt(t),0>t&&(t=0),count=0,i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];if("undefined"==typeof n.tagName){if(n.length>=t-count){var o=document.createRange();o.setStart(n,t-count),o.setEnd(n,t-count);var s=window.getSelection();s.removeAllRanges(),s.addRange(o),a=!0;break}count=parseInt(count)+parseInt(n.length)}else{if(t-count<=1){$(n).after(document.createTextNode(" "));var o=document.createRange();o.setStartAfter(n),o.setEndAfter(n);var s=window.getSelection();s.removeAllRanges(),s.addRange(o),a=!0;break}count++}}if(!a){n=e.childNodes[e.childNodes.length-1];var o=document.createRange();o.setStart(n,n.length),o.setEnd(n,n.length);var s=window.getSelection();s.removeAllRanges(),s.addRange(o)}},refreshContent:function(e,t){t=$(t),(null==e||0==e)&&(t.find("*[contenteditable]").off(),t.find(".deletable").off(),t.find("*[contenteditable]").on("dragover drop",function(e){return e.preventDefault(),!1}),t.find(".deletable").on("mouseenter",function(e){$(e.currentTarget).append('<div onclick="$(this).closest(\'.deletable\').remove();" class="delete-btn"><i class="fa fa-times"></i></div>')}),t.find(".deletable").on("mouseleave",function(e){$(e.currentTarget).children(".delete-btn").remove()})),t.find("iframe:not([src])").remove()},niceFocus:function(e){$(e).is("[contenteditable]")?""==$(e).html()&&(e=e.parentNode,c.refocus(e)):c.refocus(e)},refocus:function(t){t=$(t),t.children().last().is("div")||(t.append('<div contenteditable="true"> </div>'),c.refreshContent(t)),e=t.children().last()[0],e.focus();var a=document.createRange();a.selectNodeContents(e),a.collapse(!1);var n=window.getSelection();n.removeAllRanges(),n.addRange(a)},filter_out_ending:function(e,t){c.filter_out_search(e,t,!0)},filter_out_search:function(e,t,a){c.searchFilter(e,l.searchImgur,t,a),c.searchFilter(e,l.searchInstagram,t,a),c.searchFilter(e,l.searchOnedrive,t,a),c.searchFilter(e,l.searchGoogleDrive,t,a),c.searchFilter(e,l.searchSoundcloud,t,a),c.searchFilter(e,l.searchYoutube,t,a),c.searchFilter(e,l.searchYoutube2,t,a),c.searchFilter(e,l.searchVimeo,t,a),c.searchFilter(e,l.searchDailymotion,t,a),c.searchFilter(e,l.searchVine,t,a),c.searchFilter(e,l.searchImage,t,a),c.searchFilter(e,l.searchGif,t,a),c.searchFilter(e,l.searchVideo,t,a),c.searchFilter(e,l.searchLink,t,a),c.searchFilter(e,l.searchFile,t,a)},filter_out_all:function(e,t){c.filter_out_ending(e,t),c.filter_out_search(e,t)},searchMatch:function(e){var t=(e.callerName,e.inner),a=e.regex,n=e.substitution,i=e.callback,o=e.fail,s=e.ajax_url,r=e.ajax_var,d=e.ajax_method;"undefined"==typeof d&&(d="post"),t=decode(t);var c=[],l=t.match(a);if(m=[],xhrs=[],null!=l)for(j=0;j<l.length;j++)m.push(l[j].replace(/[\s]*/gi,""));if(m.length>0,0!=m.length){var u=t;for(j=0;j<m.length;j++){var p=u.indexOf(m[j]),h=u.slice(0,p);h.match(/^\s+$/)&&(h=""),0==j?c.push(encode(h)):c.push('<div contenteditable="true">'+encode(h)+"</div>"),c.push(n(m[j])),u=u.slice(p+m[j].length)}for(u.match(/^\s*$/)||c.push('<div contenteditable="true">'+encode(u)+"</div>"),j=0;j<m.length;j++){settings=new Object;var f=[];"undefined"!=typeof r&&(f=r),f.url=m[j],"undefined"!=typeof s&&(settings.url=s,settings.data=f,settings.method=d,null!=i?settings.success=function(e){i(e)}:settings.success=function(e){},null!=o&&(settings.error=function(){o(m[j])}),null!=i&&$.ajax(settings))}}else c[0]=encode(t);return c}},l={searchImgur:function(t,a){var n=createId(),i=new RegExp(regex.imgur,"gi");a||(i=new RegExp(regex.imgur+"[s]","gi")),substitution=function(e){return output='<span class="deletable deletable-block" data-src="'+e+'" contenteditable="false" id="'+n+'"><img src="Assets/ajax-loader.gif"/></span>',output};var o="Ajax/post.php",s={action:"getImgur"};return callback=function(t){e=$(t.html),balise=$("#"+n),balise.html(e)},fail=function(t){e=l.fail_request(t),balise=$("#"+n),balise.html(e)},output=c.searchMatch({callerName:"searchImgur",inner:t,regex:i,ajax_url:o,ajax_var:s,substitution:substitution,callback:callback,fail:fail}),output},searchInstagram:function(t,a){var n=createId(),i=new RegExp(regex.instagram,"gi");a||(i=new RegExp(regex.instagram+"[s]","gi")),substitution=function(e){return output='<span class="deletable deletable-block" data-src="'+e+'" contenteditable="false" id="'+n+'"><img src="Assets/ajax-loader.gif"/></span>',output};var o="Ajax/post.php",s={action:"getInstagram"};return callback=function(t){e=$('<a class="mediaLink material-shadow" href="'+t.url+'" target="_blank"><i class="fa fa-instagram"></i></a><img class="zoomPossible" onclick="lightbox.enlighten(this)" onerror="error_im(this)" src="'+t.thumbnail_url+'"/>'),balise=$("#"+n),balise.html(e)},fail=function(t){e=l.fail_request(t),balise=$("#"+n),balise.html(e)},output=c.searchMatch({callerName:"searchInstagram",inner:t,regex:i,ajax_url:o,ajax_var:s,substitution:substitution,callback:callback,fail:fail}),output},searchOnedrive:function(e,t){var a=new RegExp(regex.onedrive,"gi");return t||(a=new RegExp(regex.onedrive+"[s]","gi")),substitution=function(e){if(e.match(/resid=/))var t=e.replace(/(https?:\/\/onedrive.live.com\/).*resid=([\!\%\w]+).*/,"$2");else var t=e.replace(/(https?:\/\/onedrive.live.com\/).*id=([\!\%\w]+).*/,"$2");if(t.match(/^[\!\%\w]+$/)){var a='<span class="deletable deletable-block" data-src="'+e+'" contenteditable="false" id="'+str2md5(e)+'">',n='<iframe width="320" height="180" seamless src="https://onedrive.live.com/embed?resid='+t+'" frameborder="0"></iframe>',i="</span>";return a+n+i}return l.fail_request(e)},output=c.searchMatch({callerName:"searchOnedrive",inner:e,regex:a,substitution:substitution}),output},searchGoogleDrive:function(e,t){var a=new RegExp(regex.googleDrive,"gi");return t||(a=new RegExp(regex.googleDrive+"[s]","gi")),substitution=function(e){if(e.match(/open\?id=/))var t=e.replace(/(https?:\/\/drive.google.com\/open\?id=)(\w+)/,"$2");else var t=e.replace(/(https?:\/\/drive.google.com\/file\/d\/)([\w]+)(\/)([^\s]+)/,"$2");if(t.match(/^\w+$/)){var a='<span class="deletable deletable-block" data-src="'+e+'" contenteditable="false" id="'+str2md5(e)+'">',n='<div class="embed-responsive embed-responsive-square"><iframe seamless class="embed-responsive-item" src="https://drive.google.com/file/d/'+t+'/preview" frameborder="0"></iframe></div>',i="</span>";return a+n+i}return l.fail_request(e)},output=c.searchMatch({callerName:"searchGoogleDrive",inner:e,regex:a,substitution:substitution}),output},searchSoundcloud:function(e,t){var a=new RegExp(regex.soundcloud,"gi");return t||(a=new RegExp(regex.soundcloud+"[s]","gi")),substitution=function(e){output='<span class="deletable deletable-block" data-src="'+e+'" contenteditable="false" id="'+str2md5(e)+'"><img src="Assets/ajax-loader.gif"/></span>',setTimeout(function(){SC.oEmbed(e,{auto_play:!0},function(t){song_url=t.html.replace(/.*src="([^"]+)".*/,"$1");var a=song_url.replace(/auto_play=false/,"auto_play=true"),n=origin_url+"Data/miniature/"+str2md5(e)+".jpg",i='<span class="deletable deletable-block" data-src="'+e+'" contenteditable="false" id="'+str2md5(e)+'">';i+='<div class="embed-responsive embed-responsive-16by9">',i+='<div onclick="loadIframe(this)" data-src="'+a+'" class="launcher">',i+='<img src="'+n+'" onerror="loadIframe(this)"/>',i+="</div></div></span>",$("#"+str2md5(e)).html(i)})},50);var t='<span class="deletable deletable-block" data-src="'+e+'" contenteditable="false" id="'+str2md5(e)+'">',a=e.replace(/(https?:\/\/vine.co\/v\/)([\w\-]+)/,'<div class="embed-responsive embed-responsive-square"><iframe seamless class="embed-responsive-item" src="$1$2/embed/simple" frameborder="0"></iframe></div><script async src="//platform.vine.co/static/scripts/embed.js" charset="utf-8"></script>'),n="</span>";return t+a+n},output=c.searchMatch({callerName:"searchSoundcloud",inner:e,regex:a,substitution:substitution}),output},searchVine:function(e,t){var a=new RegExp(regex.vine,"gi");return t||(a=new RegExp(regex.vine+"[s]","gi")),substitution=function(e){var t='<span class="deletable deletable-block" data-src="'+e+'" contenteditable="false" id="'+str2md5(e)+'">',a=e.replace(/(https?:\/\/vine.co\/v\/)([\w\-]+)/,'<div class="embed-responsive embed-responsive-square"><iframe seamless class="embed-responsive-item" src="$1$2/embed/simple" frameborder="0"></iframe></div><script async src="//platform.vine.co/static/scripts/embed.js" charset="utf-8"></script>'),n="</span>";return t+a+n},output=c.searchMatch({callerName:"searchVine",inner:e,regex:a,substitution:substitution}),output},searchDailymotion:function(e,t){var a=new RegExp(regex.dailymotion,"gi");return t||(a=new RegExp(regex.dailymotion+"[s]","gi")),substitution=function(e){var t=e.replace(/(https?:\/\/www.dailymotion.com\/video\/)([\w\-]+)/,"http://www.dailymotion.com/embed/video/$2?autoplay=1"),a=origin_url+"Data/miniature/"+str2md5(e)+".jpg",n='<span class="deletable deletable-block" data-src="'+e+'" contenteditable="false" id="'+str2md5(e)+'">';return n+='<div class="embed-responsive embed-responsive-16by9">',n+='<div onclick="loadIframe(this)" data-src="'+t+'" class="launcher">',n+='<img src="'+a+'" onerror="loadIframe(this)"/>',n+="</div></div></span>"},output=c.searchMatch({callerName:"searchDailymotion",inner:e,regex:a,substitution:substitution}),output},searchVimeo:function(e,t){var a=new RegExp(regex.vimeo,"gi");return t||(a=new RegExp(regex.vimeo+"[s]","gi")),substitution=function(e){var t=e.replace(/(https?:\/\/vimeo.com\/)(channels\/staffpicks\/)?([0-9]+)/,"http://player.vimeo.com/video/$3?autoplay=1"),a=origin_url+"Data/miniature/"+str2md5(e)+".jpg",n='<span class="deletable deletable-block" data-src="'+e+'" contenteditable="false" id="'+str2md5(e)+'">';return n+='<div class="embed-responsive embed-responsive-16by9">',n+='<div onclick="loadIframe(this)" data-src="'+t+'" class="launcher">',n+='<img src="'+a+'" onerror="loadIframe(this)"/>',n+="</div></div></span>"},output=c.searchMatch({callerName:"searchVimeo",inner:e,regex:a,substitution:substitution}),output},searchYoutube2:function(e,t){var a=new RegExp(regex.youtube2,"gi");return t||(a=new RegExp(regex.youtube2+"[s]","gi")),substitution=function(e){var t=e.replace(/(https?:\/\/youtu\.be\/)([\w\-]+)([^\s]*)/,"$2"),a="http://www.youtube.com/embed/"+t+"?autoplay=1&controls=2&wmode=opaque",n=origin_url+"Data/miniature/"+str2md5(e)+".jpg",i='<span class="deletable deletable-block" data-src="'+e+'" contenteditable="false" id="'+str2md5(e)+'">';return i+='<div class="embed-responsive embed-responsive-16by9">',i+='<div onclick="loadIframe(this)" data-src="'+a+'" class="launcher">',i+='<img src="'+n+'" onerror="loadIframe(this)"/>',i+="</div></div></span>"},output=c.searchMatch({callerName:"searchYoutube2",inner:e,regex:a,substitution:substitution}),output},searchYoutube:function(e,t){var a=new RegExp(regex.youtube,"gi");return t||(a=new RegExp(regex.youtube+"[s]","gi")),substitution=function(e){var t=e.replace(/(https?:\/\/(www|m).youtube.com\/watch\?)([^\s]*)v=([\w\-]+)([^\s]*)/,"$4"),a="http://www.youtube.com/embed/"+t+"?autoplay=1&controls=2&wmode=opaque",n=origin_url+"Data/miniature/"+str2md5(e)+".jpg",i='<span class="deletable deletable-block" data-src="'+e+'" contenteditable="false" id="'+str2md5(e)+'">';return i+='<div class="embed-responsive embed-responsive-16by9">',i+='<div onclick="loadIframe(this)" data-src="'+a+'" class="launcher">',i+='<img src="'+n+'" onerror="loadIframe(this)"/>',i+="</div></div></span>"},output=c.searchMatch({callerName:"searchYoutube",inner:e,regex:a,substitution:substitution}),output},searchVideo:function(e,t){var a=new RegExp(regex.video,"gi");return t||(a=new RegExp(regex.video+"[s]","gi")),substitution=function(e){var t=e;e.match(/\.gifv/)&&(t=e.replace(/\.gifv/,".webm"));var a=origin_url+"Data/miniature/"+str2md5(e)+".jpg",n='<span class="deletable deletable-block" data-src="'+e+'" contenteditable="false" id="'+str2md5(e)+'">';return n+='<div onclick="loadVideo(this)" data-src="'+t+'" class="launcher">',n+='<img src="'+a+'" onerror="loadVideo(this)"/>',n+="</div></span>"},output=c.searchMatch({callerName:"searchVideo",inner:e,regex:a,substitution:substitution}),output},searchImage:function(e,t){var a=new RegExp(regex.image,"gi");return t||(a=new RegExp(regex.image+"[s]","gi")),substitution=function(e){return'<span class="deletable deletable-block" data-src="'+e+'" contenteditable="false" id="'+str2md5(e)+'"><img class="zoomPossible" onclick="lightbox.enlighten(this)" onerror="error_im(this)" src="'+e+'"/></span>'},output=c.searchMatch({callerName:"searchImage",inner:e,regex:a,substitution:substitution}),output},searchGif:function(e,t){var a=new RegExp(regex.gif,"gi");return t||(a=new RegExp(regex.gif+"[s]","gi")),substitution=function(e){var t=origin_url+"Data/miniature/"+str2md5(e)+".jpg",a='<span class="deletable deletable-block" data-src="'+e+'" contenteditable="false" id="'+str2md5(e)+'">';return a+='<div onclick="loadImage(this)" data-src="'+e+'" class="launcher">',a+='<img src="'+t+'" onerror="loadImage(this)"/>',a+="</div></span>"},output=c.searchMatch({callerName:"searchImage",inner:e,regex:a,substitution:substitution}),output},searchFile:function(e,t,a){var n=new RegExp(regex.file,"gi");substitution=function(e){return output='<span class="deletable deletable-block" data-src="'+e+'" contenteditable="false" id="'+str2md5(e.replace(/#.+$/,""))+'"><img src="Assets/ajax-loader.gif"/></span>',output};var i="Ajax/post.php",o={action:"getFile",viewer:a};return callback=function(e){balise=$("#"+str2md5(decodeURI(e.url))),balise.html(e.html),
0!=a&&$("img.lazyload").each(function(){this.src=this.dataset.src,this.style.opacity=1})},fail=function(e){balise=$("#"+str2md5(e)),balise.html("error")},output=c.searchMatch({callerName:"searchFile",inner:e,regex:n,substitution:substitution,ajax_url:i,ajax_var:o,callback:callback,fail:fail}),output},fail_request:function(t){return e=$('<a class="b-link" href="'+t.replace(/\s/," ")+'" target="_blank">'+t+"</a>"),e},open_graph_build:function(t){base_url=t.base_url;var a="";if("undefined"!=typeof t.image&&"undefined"!=typeof t.image.url&&!t.image.url.match(/^\s*$/)){var n=origin_url+"Data/miniature/"+str2md5(t.url)+".jpg";a='<div class="preview"><img src="'+n+'" onerror="error_im(this)"/></div>'}return"undefined"!=typeof t.title&&""!=t.title?title='<div class="title">'+html_entity_decode(t.title)+"</div>":title="","undefined"!=typeof t.description&&""!=t.description?description='<div class="description">'+t.description+"</div>":description="",""!=a||""!=title&&""!=description?(e=$('<a class="article_big" href="'+decodeURI(t.url)+'" target="_blank">'+a+title+description+'<div class="base_url">'+base_url+"</div></a>"),"undefined"!=typeof t.image&&""!=t.image.url&&null!=t.image.width&&null!=t.image.height&&parseInt(t.image.width)<380&&(e=$('<a class="article_small" href="'+decodeURI(t.url)+'" target="_blank">'+a+title+description+'<div class="base_url">'+base_url+"</div></a>"))):e=l.fail_request(t.url),e},searchLink:function(t,a){var n=createId(),i=new RegExp(regex.link,"gi");a||(i=new RegExp(regex.link+"[s]","gi")),substitution=function(e){return output='<span class="deletable deletable-block" data-src="'+e+'" contenteditable="false" id="'+n+'"><img src="Assets/ajax-loader.gif"/></span>',output};var o="Ajax/post.php",s={action:"gen_preview"};return callback=function(t){e=l.open_graph_build(t),balise=$('*[data-src="'+t.url+'"]'),balise.html(e)},fail=function(t){e=l.fail_request(t),balise=$("#"+n),balise.html(e)},output=c.searchMatch({callerName:"searchLink",inner:t,regex:i,substitution:substitution,ajax_var:s,ajax_url:o,callback:callback,fail:fail}),output}};t.Control=c,t.Filter=l,t.evaluate=n,t.stop=o,t.start=s,t.view=r,t.pasteHtmlAtCaret=d,a.typebox=t}({},function(){return this}()),String.prototype.hashCode=function(){var e,t,a,n=0;if(0===this.length)return n;for(e=0,a=this.length;a>e;e++)t=this.charCodeAt(e),n=(n<<5)-n+t,n|=0;return n};
