function loadRetoucheBox(e,t,n){r=$("#retoucheBox"),r.attr("data-w",e),r.attr("data-h",t),r.attr("data-action",n),togglenewavatar()}function destroyAccount(e){if(password=$(e).val(),null==password||password.match(/^\s*$/))return!1;var t=$("#info").attr("data-uid");$.ajax({url:"Ajax/post.php",type:"POST",data:{action:"destroyAccount",uid:t,password:password},success:function(e){console.log(e),disconnect()}})}function changeforumname(e){if(name=$(e).val(),null==name||name.match(/^\s*$/))return!1;var t=$("#info").attr("data-uid"),n=$("#info").attr("data-forum");$.ajax({url:"Ajax/post.php",type:"POST",data:{action:"changeForum",uid:t,fid:n,name:name},success:function(e){console.log(e),location.reload()}})}function changename(e){if(name=$(e).val(),null==name||name.match(/^\s*$/))return!1;var t=$("#info").attr("data-uid");$.ajax({url:"Ajax/post.php",type:"POST",data:{action:"changeProfile",uid:t,name:name},success:function(e){console.log(e),location.reload()}})}function inviteUser(e){mail=$(e).val(),uid=$("#info").attr("data-uid"),forum=$("#info").attr("data-forum"),$.ajax({url:"Ajax/post.php",type:"POST",data:{action:"inviteUser",uid:uid,mail:mail,forum:forum},success:function(e){console.log(e),console.log("success!")},error:function(){console.log("fail!")}})}function changepassword(e,t){if(old_password=$(e).val(),new_password=$(t).val(),null==old_password||old_password.match(/^\s*$/))return!1;if(null==new_password||new_password.match(/^\s*$/))return!1;var n=$("#info").attr("data-uid");$.ajax({url:"Ajax/post.php",type:"POST",data:{action:"changeProfile",uid:n,old_password:old_password,new_password:new_password},success:function(e){console.log(e),location.reload()}})}function sendIt(e){if(msg="","#commentBox"==e?parentID=$("#post-viewer").attr("data-id"):parentID=0,"#editBox"==e)var n=$(e).parent().attr("data-id");else var n=0;for(t=$(e),i=0;i<t.children().length;i++)c=$(t.children()[i]),c.hasClass("deletable")?msg+=" "+c.attr("data-src"):msg+=" "+decode(c.html());uid=$("#info").eq(0).attr("data-uid"),forum=$("#info").eq(0).attr("data-forum"),console.log("text:"+msg+",forum:"+forum+",uid:"+uid+",parent:"+parentID+",pid:"+n),$.ajax({url:"Ajax/save_msg.php",type:"POST",data:{text:msg,forum:forum,uid:uid,parent:parentID,pid:n},success:function(e){if(console.log(e),0==e.parent||null==e.parent){if(0==e.pid||null==e.pid)$("#container").prepend('<div class="post-mini" data-id="'+e.id+'"><img src="'+e.preview+'"/></div>');else{var t=$("#container .post-mini[data-id="+e.pid+"]");t.after('<div class="post-mini" data-id="'+e.id+'"><img src="'+e.preview+'"/></div>'),t.remove()}setpostsviewable(),hidenewpost(),hidepostviewer()}else $(".new-comment-section").before(e.html),hidenewcommentsection($(".new-comment-section")),view()},error:function(){console.log("fail")}})}function setpostsviewable(){$(".post-mini").off(),$(".post-mini").on("click",function(e){return togglepostviewer(e),!1})}function deletePost(e){p=$(e).parent().parent().parent().parent(),id=p.attr("data-id"),console.log("delete:"+id),forum=$("#info").attr("data-forum"),$.ajax({url:"Ajax/post.php",type:"POST",data:{action:"deletePost",id:id,forum:forum},success:function(e){p.hasClass("parent-post")?(hidepostviewer(),$(".post-mini[data-id="+id+"]").remove()):$(".post[data-id="+id+"]").remove()}})}function editPost(e){var t=$(e).parent().parent().parent().parent(),n=t.attr("data-id");$.get("Ajax/get.php?action=getRaw&pid="+n,function(e){box='<div id="editBox" class="dynamicBox">',box+='<div contenteditable="true" data-placeholder="Share something...">'+e.raw+"</div>",box+="</div>",box+='<div class="menu">',box+='<div class="menu-cell">',box+='<button id="cancelit" onclick="hidepostviewer()">Cancel</button>',box+="</div>",box+='<div class="menu-cell">',box+='<button id="sendit" onclick="sendIt(\'#editBox\')">Send</button>',box+="</div>",box+="</div>",t.html(box),start_typebox("#editBox")})}function loadMorePosts(){window.loading||(window.loading=!0,forum=$("#info").attr("data-forum"),$.get("Ajax/morePosts.php?start="+window.n+"&forum="+forum,function(e){$("#container").append(e.html),e.entries<30?(window.stop=!0,$(document).unbind("scroll")):(window.n=window.n+30,window.loading=!1),setpostsviewable()}))}function disconnect(){$.ajax({url:"Ajax/connect.php",type:"POST",data:{mail:"",password:""},success:function(e){window.location.reload(!0)}})}function cancelAsk(){$("#ask").remove(),removeMask("askMask")}function answerAsk(e,t){var n=$("#ask input").val();cancelAsk(),e(n,t)}function ask(e,t,n,a){var i=$('<div id="ask"></div>'),s=$("<span>"+e+"</span>"),o=$('<input type="text" maxlength="'+t+'"></input>'),r=$("<button>Ok</button>");r.on("click",function(){answerAsk(n,a)});var c=$('<button onclick="cancelAsk()">Annuler</button>');i.append(s).append(o).append(r).append(c),$("body").append(i),addMask("cancelAsk()",.4,9e3,"askMask")}function addForum(e){return null==e||e.match(/^\s*$/)?!1:(uid=$("#info").attr("data-uid"),void $.ajax({url:"Ajax/post.php",type:"POST",data:{action:"addForum",uid:uid,name:e},success:function(e){console.log(e),console.log("success!")},error:function(){console.log("fail!")}}))}function addUserToForum(e){nid=$(e).parent().parent().attr("data-id"),uid=$("#info").attr("data-uid"),$.ajax({url:"Ajax/post.php",type:"POST",data:{action:"addUserToForum",uid:uid,nid:nid},success:function(e){console.log(e),console.log("success!")},error:function(){console.log("fail!")}}),$(e).parent().parent().remove()}function removeNotification(e){nid=$(e).parent().parent().attr("data-id"),uid=$("#info").attr("data-uid"),$.ajax({url:"Ajax/post.php",type:"POST",data:{action:"removeNotification",uid:uid,nid:nid},success:function(e){console.log(e),console.log("success!")},error:function(){console.log("fail!")}}),$(e).parent().parent().remove()}function hideAll(){$("#mainmenu").hasClass("active")&&hideslidefromleft("#mainmenu"),$("#newavatar").hasClass("active")&&hidenewavatar(),$("#post-viewer").hasClass("active")&&hidepostviewer(),$("#newpost").hasClass("active")&&hidenewpost()}function toggleoptionsmenu(e){g=$(e).find(".options-menu"),g.hasClass("active")?(g.css("display","none"),g.removeClass("active"),$(e).find("i").removeClass("fa-caret-up"),$(e).find("i").addClass("fa-caret-down")):(g.css("display","block"),g.addClass("active"),$(e).find("i").removeClass("fa-caret-down"),$(e).find("i").addClass("fa-caret-up"))}function toggleslidefromleft(e){g=$(e),g.hasClass("active")?hideslidefromleft(e):showslidefromleft(e)}function showslidefromleft(e){hideAll(),g=$(e),console.log(g),g.css({transform:"translateX(0)"}),g.addClass("active"),addMask("hideslidefromleft('"+e+"')",.6)}function hideslidefromleft(e){g=$(e),g.css({transform:"translateX(-100%)"}),g.removeClass("active"),removeMask()}function toggleslidefromright(e){g=$(e),g.hasClass("active")?hideslidefromright(e):showslidefromright(e)}function showslidefromright(e){hideAll(),g=$(e),g.css({transform:"translateX(0)"}),g.addClass("active")}function hideslidefromright(e){g=$(e),g.css({transform:"translateX(100%)"}),g.removeClass("active")}function togglenewavatar(){pv=$("#newavatar"),pv.hasClass("active")?hidenewavatar():(hideAll(),pv.addClass("active"),pv.css("display","block"),addMask("togglenewavatar()",.6),retouche.restart("#retoucheBox"))}function hidenewavatar(){pv=$("#newavatar"),pv.removeClass("active"),pv.css("display","none"),$("#container").css("filter","none"),$("#container").css("-webkit-filter","none"),$("#mask").remove(),$("body").css("overflow","auto"),pv.html('<div id="retoucheBox"><i class="label fa fa-photo"></i><span class="underLabel">Click to upload a photo</span><input type="file"></input></div>'),removeMask()}function togglenewpost(){e=$("#newpost"),e.hasClass("active")?hidenewpost():shownewpost()}function shownewpost(){e=$("#newpost"),hideAll(),showslidefromright("#slidenewpost"),typebox.start("#typeBox"),invite=$('<div contenteditable="true" data-placeholder="Partagez quelquechose..."></div>'),$("#typeBox").html(invite),e.addClass("active"),addMask("hidenewpost()",.6)}function hidenewpost(){e=$("#newpost"),hideslidefromright("#slidenewpost"),$("#newpost").removeClass("active"),invite=$('<div contenteditable="true" data-placeholder="Partagez quelquechose..."></div>'),$("#typeBox").html(invite),typebox.stop("#typeBox"),removeMask()}function togglepostviewer(e){if(pv=$("#post-viewer"),pv.hasClass("active")||null==e)hidepostviewer();else{var t=$(e.target).parent().attr("data-id");showpostviewer(t)}}function hidenewcommentsection(e){t=$(e),t.html('<div onclick="shownewcommentsection(this)" class="new-comment-section"><div class="fake-comment" data-placeholder="Write a comment..."></div></div>')}function shownewcommentsection(e){if(t=$(e),fc=t.children(":first-child"),fc.hasClass("fake-comment")){fc.remove();var n=$('<div class="commentator"><img src="'+$("#info").attr("data-avatar")+'"/></div>'),a=$('<div id="commentBox" class="dynamicBox"><div contenteditable="true" data-placeholder="Comment..."></div></div>'),i=$('<div class="newpost-menu"></div>'),s=$('<div class="newpost-menu-cell"></div>');s.append('<button id="sendit" onclick="sendIt(\'#commentBox\')">Send</button>'),i.append(s),t.append(n).append(a).append(i),typebox.start("#commentBox"),niceFocus("#commentBox")}}function showpostviewer(e){hideAll(),showslidefromright("#slidepostviewer"),pv=$("#post-viewer"),pv.addClass("active"),pv.css("display","block"),console.log("show: "+e),$.get("Ajax/get.php?action=getPost&id="+e,function(e){$("#mask").addClass("dark-mask"),pv.append('<div class="post-separator"></div>'),pv.append('<div class="post-options"><div onclick="hidepostviewer()"><i class="fa fa-long-arrow-right"></i></div></div>'),pv.append('<div class="post-separator"></div>'),pv.append(e.html),pv.append('<div onclick="shownewcommentsection(this)" class="new-comment-section"><div class="fake-comment" data-placeholder="Write a comment..."></div></div>'),view()}),addMask("togglepostviewer()",.6),pv.attr("data-id",e)}function hidepostviewer(){$("body").css({overflow:"auto","max-height":"none"}),hideslidefromright("#slidepostviewer"),pv=$("#post-viewer"),pv.removeClass("active"),removeMask(),pv.attr("data-id",""),pv.html(""),typebox.stop("#commentBox")}function addMask(e,t,n,a){null==a&&(a="mask"),mask=$('<div class="mask" id="'+a+'" onclick="'+e+'"></div>'),$("body").append(mask),$("body").css({overflow:"hidden","max-height":"100%"}),$("#"+a).css("background","rgba(0,0,0,"+t+")"),null!=n&&$("#"+a).css("z-index",n)}function removeMask(e){null==e&&(e="mask"),$("#"+e).remove()}function SetCaretAtEnd(e){var t=e.value.length;e.selectionStart=t,e.selectionEnd=t,e.focus()}function getExtension(e){var t=e.split(".");return t[t.length-1]}function isImage(e){var t=getExtension(e);switch(t.toLowerCase()){case"jpg":case"gif":case"bmp":case"png":return!0}return!1}function isVideo(e){var t=getExtension(e);switch(t.toLowerCase()){case"m4v":case"avi":case"mpg":case"mp4":return!0}return!1}function utf8_encode(e){if(null===e||"undefined"==typeof e)return"";var t,n,a=e+"",i="",s=0;t=n=0,s=a.length;for(var o=0;s>o;o++){var r=a.charCodeAt(o),c=null;if(128>r)n++;else if(r>127&&2048>r)c=String.fromCharCode(r>>6|192,63&r|128);else if(55296!=(63488&r))c=String.fromCharCode(r>>12|224,r>>6&63|128,63&r|128);else{if(55296!=(64512&r))throw new RangeError("Unmatched trail surrogate at "+o);var l=a.charCodeAt(++o);if(56320!=(64512&l))throw new RangeError("Unmatched lead surrogate at "+(o-1));r=((1023&r)<<10)+(1023&l)+65536,c=String.fromCharCode(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}null!==c&&(n>t&&(i+=a.slice(t,n)),i+=c,t=n=o+1)}return n>t&&(i+=a.slice(t,s)),i}function str2md5(e){var t,n,a,i,s,o,r,c,l,d,u=function(e,t){return e<<t|e>>>32-t},p=function(e,t){var n,a,i,s,o;return i=2147483648&e,s=2147483648&t,n=1073741824&e,a=1073741824&t,o=(1073741823&e)+(1073741823&t),n&a?2147483648^o^i^s:n|a?1073741824&o?3221225472^o^i^s:1073741824^o^i^s:o^i^s},m=function(e,t,n){return e&t|~e&n},f=function(e,t,n){return e&n|t&~n},h=function(e,t,n){return e^t^n},g=function(e,t,n){return t^(e|~n)},v=function(e,t,n,a,i,s,o){return e=p(e,p(p(m(t,n,a),i),o)),p(u(e,s),t)},w=function(e,t,n,a,i,s,o){return e=p(e,p(p(f(t,n,a),i),o)),p(u(e,s),t)},b=function(e,t,n,a,i,s,o){return e=p(e,p(p(h(t,n,a),i),o)),p(u(e,s),t)},$=function(e,t,n,a,i,s,o){return e=p(e,p(p(g(t,n,a),i),o)),p(u(e,s),t)},y=function(e){for(var t,n=e.length,a=n+8,i=(a-a%64)/64,s=16*(i+1),o=new Array(s-1),r=0,c=0;n>c;)t=(c-c%4)/4,r=c%4*8,o[t]=o[t]|e.charCodeAt(c)<<r,c++;return t=(c-c%4)/4,r=c%4*8,o[t]=o[t]|128<<r,o[s-2]=n<<3,o[s-1]=n>>>29,o},x=function(e){var t,n,a="",i="";for(n=0;3>=n;n++)t=e>>>8*n&255,i="0"+t.toString(16),a+=i.substr(i.length-2,2);return a},_=[],T=7,C=12,E=17,k=22,N=5,S=9,I=14,j=20,M=4,A=11,O=16,z=23,L=6,U=10,R=15,D=21;for(e=this.utf8_encode(e),_=y(e),r=1732584193,c=4023233417,l=2562383102,d=271733878,t=_.length,n=0;t>n;n+=16)a=r,i=c,s=l,o=d,r=v(r,c,l,d,_[n+0],T,3614090360),d=v(d,r,c,l,_[n+1],C,3905402710),l=v(l,d,r,c,_[n+2],E,606105819),c=v(c,l,d,r,_[n+3],k,3250441966),r=v(r,c,l,d,_[n+4],T,4118548399),d=v(d,r,c,l,_[n+5],C,1200080426),l=v(l,d,r,c,_[n+6],E,2821735955),c=v(c,l,d,r,_[n+7],k,4249261313),r=v(r,c,l,d,_[n+8],T,1770035416),d=v(d,r,c,l,_[n+9],C,2336552879),l=v(l,d,r,c,_[n+10],E,4294925233),c=v(c,l,d,r,_[n+11],k,2304563134),r=v(r,c,l,d,_[n+12],T,1804603682),d=v(d,r,c,l,_[n+13],C,4254626195),l=v(l,d,r,c,_[n+14],E,2792965006),c=v(c,l,d,r,_[n+15],k,1236535329),r=w(r,c,l,d,_[n+1],N,4129170786),d=w(d,r,c,l,_[n+6],S,3225465664),l=w(l,d,r,c,_[n+11],I,643717713),c=w(c,l,d,r,_[n+0],j,3921069994),r=w(r,c,l,d,_[n+5],N,3593408605),d=w(d,r,c,l,_[n+10],S,38016083),l=w(l,d,r,c,_[n+15],I,3634488961),c=w(c,l,d,r,_[n+4],j,3889429448),r=w(r,c,l,d,_[n+9],N,568446438),d=w(d,r,c,l,_[n+14],S,3275163606),l=w(l,d,r,c,_[n+3],I,4107603335),c=w(c,l,d,r,_[n+8],j,1163531501),r=w(r,c,l,d,_[n+13],N,2850285829),d=w(d,r,c,l,_[n+2],S,4243563512),l=w(l,d,r,c,_[n+7],I,1735328473),c=w(c,l,d,r,_[n+12],j,2368359562),r=b(r,c,l,d,_[n+5],M,4294588738),d=b(d,r,c,l,_[n+8],A,2272392833),l=b(l,d,r,c,_[n+11],O,1839030562),c=b(c,l,d,r,_[n+14],z,4259657740),r=b(r,c,l,d,_[n+1],M,2763975236),d=b(d,r,c,l,_[n+4],A,1272893353),l=b(l,d,r,c,_[n+7],O,4139469664),c=b(c,l,d,r,_[n+10],z,3200236656),r=b(r,c,l,d,_[n+13],M,681279174),d=b(d,r,c,l,_[n+0],A,3936430074),l=b(l,d,r,c,_[n+3],O,3572445317),c=b(c,l,d,r,_[n+6],z,76029189),r=b(r,c,l,d,_[n+9],M,3654602809),d=b(d,r,c,l,_[n+12],A,3873151461),l=b(l,d,r,c,_[n+15],O,530742520),c=b(c,l,d,r,_[n+2],z,3299628645),r=$(r,c,l,d,_[n+0],L,4096336452),d=$(d,r,c,l,_[n+7],U,1126891415),l=$(l,d,r,c,_[n+14],R,2878612391),c=$(c,l,d,r,_[n+5],D,4237533241),r=$(r,c,l,d,_[n+12],L,1700485571),d=$(d,r,c,l,_[n+3],U,2399980690),l=$(l,d,r,c,_[n+10],R,4293915773),c=$(c,l,d,r,_[n+1],D,2240044497),r=$(r,c,l,d,_[n+8],L,1873313359),d=$(d,r,c,l,_[n+15],U,4264355552),l=$(l,d,r,c,_[n+6],R,2734768916),c=$(c,l,d,r,_[n+13],D,1309151649),r=$(r,c,l,d,_[n+4],L,4149444226),d=$(d,r,c,l,_[n+11],U,3174756917),l=$(l,d,r,c,_[n+2],R,718787259),c=$(c,l,d,r,_[n+9],D,3951481745),r=p(r,a),c=p(c,i),l=p(l,s),d=p(d,o);var P=x(r)+x(c)+x(l)+x(d);return P.toLowerCase()}function htmlspecialchars_decode(e,t){var n=0,a=0,i=!1;"undefined"==typeof t&&(t=2),e=e.toString().replace(/&lt;/g,"<").replace(/&gt;/g,">");var s={ENT_NOQUOTES:0,ENT_HTML_QUOTE_SINGLE:1,ENT_HTML_QUOTE_DOUBLE:2,ENT_COMPAT:2,ENT_QUOTES:3,ENT_IGNORE:4};if(0===t&&(i=!0),"number"!=typeof t){for(t=[].concat(t),a=0;a<t.length;a++)0===s[t[a]]?i=!0:s[t[a]]&&(n|=s[t[a]]);t=n}return t&s.ENT_HTML_QUOTE_SINGLE&&(e=e.replace(/&#0*39;/g,"'")),i||(e=e.replace(/&quot;/g,'"')),e=e.replace(/&amp;/g,"&")}function htmlspecialchars(e,t,n,a){var i=0,s=0,o=!1;("undefined"==typeof t||null===t)&&(t=2),e=e.toString(),a!==!1&&(e=e.replace(/&/g,"&amp;")),e=e.replace(/</g,"&lt;").replace(/>/g,"&gt;");var r={ENT_NOQUOTES:0,ENT_HTML_QUOTE_SINGLE:1,ENT_HTML_QUOTE_DOUBLE:2,ENT_COMPAT:2,ENT_QUOTES:3,ENT_IGNORE:4};if(0===t&&(o=!0),"number"!=typeof t){for(t=[].concat(t),s=0;s<t.length;s++)0===r[t[s]]?o=!0:r[t[s]]&&(i|=r[t[s]]);t=i}return t&r.ENT_HTML_QUOTE_SINGLE&&(e=e.replace(/'/g,"&#039;")),o||(e=e.replace(/"/g,"&quot;")),e}function htmlentities(e,t,n,a){var i=this.get_html_translation_table("HTML_ENTITIES",t),s="";if(e=null==e?"":e+"",!i)return!1;if(t&&"ENT_QUOTES"===t&&(i["'"]="&#039;"),a||null==a)for(s in i)i.hasOwnProperty(s)&&(e=e.split(s).join(i[s]));else e=e.replace(/([\s\S]*?)(&(?:#\d+|#x[\da-f]+|[a-zA-Z][\da-z]*);|$)/g,function(e,t,n){for(s in i)i.hasOwnProperty(s)&&(t=t.split(s).join(i[s]));return t+n});return e}function html_entity_decode(e,t){var n={},a="",i="",s="";if(i=e.toString(),!1===(n=this.get_html_translation_table("HTML_ENTITIES",t)))return!1;delete n["&"],n["&"]="&amp;";for(a in n)s=n[a],i=i.split(s).join(a);return i=i.split("&#039;").join("'")}function get_html_translation_table(e,t){var n,a={},i={},s={},o={},r={},c={};if(s[0]="HTML_SPECIALCHARS",s[1]="HTML_ENTITIES",o[0]="ENT_NOQUOTES",o[2]="ENT_COMPAT",o[3]="ENT_QUOTES",r=isNaN(e)?e?e.toUpperCase():"HTML_SPECIALCHARS":s[e],c=isNaN(t)?t?t.toUpperCase():"ENT_COMPAT":o[t],"HTML_SPECIALCHARS"!==r&&"HTML_ENTITIES"!==r)throw new Error("Table: "+r+" not supported");a[38]="&amp;","HTML_ENTITIES"===r&&(a[160]="&nbsp;",a[161]="&iexcl;",a[162]="&cent;",a[163]="&pound;",a[164]="&curren;",a[165]="&yen;",a[166]="&brvbar;",a[167]="&sect;",a[168]="&uml;",a[169]="&copy;",a[170]="&ordf;",a[171]="&laquo;",a[172]="&not;",a[173]="&shy;",a[174]="&reg;",a[175]="&macr;",a[176]="&deg;",a[177]="&plusmn;",a[178]="&sup2;",a[179]="&sup3;",a[180]="&acute;",a[181]="&micro;",a[182]="&para;",a[183]="&middot;",a[184]="&cedil;",a[185]="&sup1;",a[186]="&ordm;",a[187]="&raquo;",a[188]="&frac14;",a[189]="&frac12;",a[190]="&frac34;",a[191]="&iquest;",a[192]="&Agrave;",a[193]="&Aacute;",a[194]="&Acirc;",a[195]="&Atilde;",a[196]="&Auml;",a[197]="&Aring;",a[198]="&AElig;",a[199]="&Ccedil;",a[200]="&Egrave;",a[201]="&Eacute;",a[202]="&Ecirc;",a[203]="&Euml;",a[204]="&Igrave;",a[205]="&Iacute;",a[206]="&Icirc;",a[207]="&Iuml;",a[208]="&ETH;",a[209]="&Ntilde;",a[210]="&Ograve;",a[211]="&Oacute;",a[212]="&Ocirc;",a[213]="&Otilde;",a[214]="&Ouml;",a[215]="&times;",a[216]="&Oslash;",a[217]="&Ugrave;",a[218]="&Uacute;",a[219]="&Ucirc;",a[220]="&Uuml;",a[221]="&Yacute;",a[222]="&THORN;",a[223]="&szlig;",a[224]="&agrave;",a[225]="&aacute;",a[226]="&acirc;",a[227]="&atilde;",a[228]="&auml;",a[229]="&aring;",a[230]="&aelig;",a[231]="&ccedil;",a[232]="&egrave;",a[233]="&eacute;",a[234]="&ecirc;",a[235]="&euml;",a[236]="&igrave;",a[237]="&iacute;",a[238]="&icirc;",a[239]="&iuml;",a[240]="&eth;",a[241]="&ntilde;",a[242]="&ograve;",a[243]="&oacute;",a[244]="&ocirc;",a[245]="&otilde;",a[246]="&ouml;",a[247]="&divide;",a[248]="&oslash;",a[249]="&ugrave;",a[250]="&uacute;",a[251]="&ucirc;",a[252]="&uuml;",a[253]="&yacute;",a[254]="&thorn;",a[255]="&yuml;"),"ENT_NOQUOTES"!==c&&(a[34]="&quot;"),"ENT_QUOTES"===c&&(a[39]="&#39;"),a[60]="&lt;",a[62]="&gt;";for(n in a)a.hasOwnProperty(n)&&(i[String.fromCharCode(n)]=a[n]);return i}function br2nl(e){return e.replace(/<br\s*\/?>/gi,"\n")}function nl2br(e){return e.replace(/\n|\r|\n\r|\r\n/g,"<br>")}!function(e,n){function a(e){var t;t=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):unescape(e.split(",")[1]);for(var n=e.split(",")[0].split(":")[1].split(";")[0],a=new Uint8Array(t.length),i=0;i<t.length;i++)a[i]=t.charCodeAt(i);return new Blob([a],{type:n})}function i(e,t){img=new Image,img.onload=function(){canvas=document.createElement("canvas");var e=Math.min(img.width,1024),n=Math.min(img.height,1024),a=Math.min(e/img.width,n/img.height);canvas.width=img.width*a,canvas.height=img.height*a,ctx=canvas.getContext("2d"),ctx.drawImage(img,0,0,img.width*a,img.height*a),canvas.dataset.w=img.width*a,canvas.dataset.h=img.height*a,URL.revokeObjectURL(img.src),img=null,$(t).append(canvas),d(t),zone=$('<div data-movable="true" class="zone"></div>'),cachetop=$('<div class="cachetop cache"></div>'),cachebottom=$('<div class="cachebottom cache"></div>'),cacheleft=$('<div class="cacheleft cache"></div>'),cacheright=$('<div class="cacheright cache"></div>'),handletl=$('<div class="unselectable handlecontainer handletl"><div class="handle"></div></div>'),handletr=$('<div class="unselectable handlecontainer handletr"><div class="handle"></div></div>'),handlebl=$('<div class="unselectable handlecontainer handlebl"><div class="handle"></div></div>'),handlebr=$('<div class="unselectable handlecontainer handlebr"><div class="handle"></div></div>'),$(t).append(zone),$(t).append(cachetop),$(t).append(cachebottom),$(t).append(cacheleft),$(t).append(cacheright),$(t).append(handletl),$(t).append(handletr),$(t).append(handlebl),$(t).append(handlebr),z=$(t+" > .zone")[0],m(z,"movable",null,t),x=document.querySelector(t).offsetHeight,y=document.querySelector(t).offsetWidth,w=parseInt($(t).attr("data-w")),h=parseInt($(t).attr("data-h")),(null==w||null==h)&&(w=h=128),o(z,(x-h)/2,(y-w)/2,w,h),z=$(t+" > .handletl")[0],m(z,"resizeHandletl",t+" > .zone",t),z=$(t+" > .handletr")[0],m(z,"resizeHandletr",t+" > .zone",t),z=$(t+" > .handlebl")[0],m(z,"resizeHandlebl",t+" > .zone",t),z=$(t+" > .handlebr")[0],m(z,"resizeHandlebr",t+" > .zone",t),menu=$('<div class="menu"><div class="menu-cell"><button class="cancelit" onclick="togglenewavatar()">Cancel</button></div><div class="menu-cell"><button class="sendit">Submit</button></div></div>'),menu.on("click",function(){T(t)}),$(t).parent().append(menu)},img.src=URL.createObjectURL(e)}function s(e){id=e.data;var t=e.target.files[0];t.type.match("image.*")&&($(id+" > i").removeClass("fa-photo").addClass("fa-cog fa-spin").css({top:"calc(50% - 25px)",left:"calc(50% - 25px)"}),i(t,id))}function o(e,t,n,a,i){p=e.parentNode,a=Math.max(a,64),i=Math.max(i,64),a=Math.min(a,p.offsetWidth),i=Math.min(i,p.offsetHeight),t=Math.max(t,0),n=Math.max(n,0),t=Math.min(t,p.offsetHeight-i),n=Math.min(n,p.offsetWidth-a),t=parseInt(t),n=parseInt(n),a=parseInt(a),i=parseInt(i),e.style.width=a,e.style.height=i,e.style.top=t,e.style.left=n,ct=e.nextSibling,ct.style.height=t,cb=ct.nextSibling,cb.style.top=t+i,cl=cb.nextSibling,cl.style.height=i,cl.style.width=n,cl.style.top=t,cr=cl.nextSibling,cr.style.height=i,cr.style.top=t,cr.style.left=n+a,htl=cr.nextSibling,htl.style.top=t-12,htl.style.left=n-12,htr=htl.nextSibling,htr.style.top=t-12,htr.style.left=n-12+a,hbl=htr.nextSibling,hbl.style.top=t-12+i,hbl.style.left=n-12,hbr=hbl.nextSibling,hbr.style.top=t-12+i,hbr.style.left=n-12+a}function c(e,t,n,a,i){window.s=new Object,window.s.elmt=e.target,window.s.type=n,window.blockScroll=!0,"mousedown"==e.type?(cx=e.clientX,cy=e.clientY):(cx=e.touches[0].clientX,cy=e.touches[0].clientY),rect=e.target.getBoundingClientRect(),offsetX=parseInt(cx-rect.left),offsetY=parseInt(cy-rect.top),window.s.offsetX=offsetX,window.s.offsetY=offsetY,window.s.clientX=parseInt(cx),window.s.clientY=parseInt(cy),window.s.action=document.querySelector(a),z=document.querySelector(i+" > .zone"),window.s.t=parseInt(z.style.top),window.s.l=parseInt(z.style.left),window.s.w=z.offsetWidth,window.s.h=z.offsetHeight}function d(e){$(e+" .label").remove(),$(e+" .underLabel").remove(),$(e+" input").remove(),$(e).css("height","auto")}function u(e){null!=window.s&&null!=window.s.type&&("mousemove"==e.type?(cx=e.clientX,cy=e.clientY):(cx=e.touches[0].clientX,cy=e.touches[0].clientY),"movable"==window.s.type&&(r=window.s.elmt.parentNode.getBoundingClientRect(),t=cy-r.top-window.s.offsetY,l=cx-r.left-window.s.offsetX,w=window.s.w,h=window.s.h,(l!=window.s.l||t!=window.s.t)&&o(window.s.elmt,t,l,w,h)),"r"==window.s.type[0]&&(target=window.s.action,t=window.s.t,l=window.s.l,w=window.s.w,h=window.s.h,mx=cx-window.s.clientX,my=cy-window.s.clientY,g=0,"resizeHandletl"==window.s.type&&(g=(-mx-my)/2,t-=g,l-=g),"resizeHandletr"==window.s.type&&(g=(mx-my)/2,t-=g),"resizeHandlebl"==window.s.type&&(g=(-mx+my)/2,l-=g),"resizeHandlebr"==window.s.type&&(g=(mx+my)/2),w+=g,h+=g,(t!=window.s.t||l!=window.s.l||w!=window.s.w||h!=window.s.h)&&o(target,t,l,w,h)))}function m(e,t,n,a){e.addEventListener("mousedown",function(i){c(i,e,t,n,a)},!1),e.addEventListener("touchstart",function(i){c(i,e,t,n,a)},!1)}function v(e){document.body.addEventListener("mousemove",function(e){u(e)},!1),document.body.addEventListener("touchmove",function(e){u(e)},!1),document.body.addEventListener("mouseup",function(){window.s=null},!1),document.body.addEventListener("touchend",function(){window.s=null,window.blockScroll=!1},!1),$(window).on("touchmove",function(e){window.blockScroll&&e.preventDefault()}),b(e)}function b(e){$(e+" > input").off(),$(e+" > input").on("change",null,e,s)}function _(e){$(e+" > input").off()}function T(e){canvas=document.querySelector(e+" canvas");var n=canvas.getContext("2d");g=canvas.offsetWidth/parseInt(canvas.dataset.w),z=document.querySelector(e+" > .zone"),l=parseInt(z.style.left)/g,t=parseInt(z.style.top)/g,w=parseInt(z.style.width)/g,h=parseInt(z.style.height)/g,data=n.getImageData(l,t,w,h),g=Math.min(Math.min(w,256)/w,Math.min(h,256)/h),c2=document.createElement("canvas"),c2.width=parseInt(w),c2.height=parseInt(h),ctx2=c2.getContext("2d"),ctx2.putImageData(data,0,0),imgURL=c2.toDataURL("image/png"),htmlImage=$("<img>").attr("src",imgURL)[0],delete c2,delete ctx2,delete imgURL,c3=document.createElement("canvas"),c3.width=parseInt(w*g),c3.height=parseInt(h*g),ctx3=c3.getContext("2d"),ctx3.transform(g,0,0,g,0,0),ctx3.drawImage(htmlImage,0,0),imgURL=c3.toDataURL("image/png"),delete c3,delete ctx3,delete htmlImage,f=new FormData,f.append("avatar",a(imgURL));var i=$("#info").attr("data-uid"),s=$("#info").attr("data-forum"),o=$(e).attr("data-action");f.append("uid",i),f.append("fid",s),f.append("action",o),$.ajax({url:"Ajax/post.php",type:"POST",data:f,success:function(e){console.log(e),location.reload()},error:function(){console.log("fail")},processData:!1,contentType:!1}),togglenewavatar(e)}n.retouche=e,URL=window.URL||window.webkitURL,e.dataURItoBlob=a,e.loadImage=i,e.handleFileSelect=s,e.setZone=o,e.downEvent=c,e.stopInput=d,e.moveEvent=u,e.setAsType=m,e.start=v,e.restart=b,e.stop=_,e.sendCanvas=T}({},function(){return this}()),$(window).ready(function(){$(function(){FastClick.attach(document.body)}),window.ctrl=!1,$(window).keydown(function(e){17!=e.keyCode&&e.ctrlKey?window.ctrl=!0:window.ctrl=!1}),retouche.start("#retoucheBox"),"undefined"!=typeof SC&&SC.initialize({client_id:"01af1b3315ad8177aefecab596621e09"})}),!function(t,n){function a(e){$(e).off()}function s(e){var t=$(e)[0],n=$(e);n.off(),r.filter_out_all(t),n.on("paste",function(n){n.preventDefault(),n.stopPropagation();var a="",i=$(this);return n.clipboardData?a=n.clipboardData.getData("text/plain"):window.clipboardData?a=window.clipboardData.getData("Text"):n.originalEvent.clipboardData&&(a=$("<div></div>").text(n.originalEvent.clipboardData.getData("text"))),document.queryCommandSupported("insertText")?(document.execCommand("insertHTML",!1,$(a).html()),t=$(e)[0],r.filter_out_all(t),!1):(i.find("*").each(function(){$(this).addClass("within")}),setTimeout(function(){i.find("*").each(function(){$(this).not(".within").contents().unwrap()})},1),!1)}),n.on("keyup",function(n){if((n.ctrlKey||17==n.keyCode||window.ctrl)&&86!=n.keyCode);else if($(":focus").parent().is(e)){if(8==n.keyCode&&""==$(":focus").html())return n.preventDefault(),n.stopPropagation(),!1;(null==window.typed||window.typed!=$(e).html())&&(t=$(e)[0],cpos=r.getCpos(document.activeElement),13==n.keyCode?r.filter_out_ending(t):r.filter_out_search(t),0!=cpos&&(13==n.keyCode?bias=1:bias=0,r.setCpos(document.activeElement,parseInt(cpos+bias))),window.typed=$(e).html())}}),$(e).on("click",function(e){r.niceFocus(e.target)})}function o(){$(".post .dynamicBox").each(function(){r.filter_out_all(this,!0),$(this).find("*[contenteditable=true]").remove()})}n.typebox=t;var r={mergeEditableNodes:function(e){for(i=0;i<e.childNodes.length;i++)"DIV"==e.childNodes[i].tagName&&null!=e.childNodes[i-1]&&"DIV"==e.childNodes[i-1].tagName&&(e.childNodes[i-1].innerHTML+="<br>"+e.childNodes[i].innerHTML,e.removeChild(e.childNodes[i]))},searchFilter:function(e,t,n){for(r.mergeEditableNodes(e),toProcess=[],i=0;i<e.childNodes.length;i++)node=e.childNodes[i],"DIV"==node.tagName&&toProcess.push(node);for(i=0;i<toProcess.length;i++){var a=[];if(a[0]="",node=toProcess[i],inner=node.innerHTML.trim(),a=t(inner),a.length>1||a[0]!=node.innerHTML?hasChanged=!0:hasChanged=!1,a.length>1)for(j=a.length-1;j>0;j--)$(node).after(a[j]);""==a[0]?$(node).remove():node.innerHTML=a[0]}(null==n||0==n)&&hasChanged&&refocus(e),r.refreshContent(n,e)},getCpos:function(e){var t,n=0,a=e.ownerDocument||e.document,i=a.defaultView||a.parentWindow;if("undefined"!=typeof i.getSelection){if(t=i.getSelection(),t.rangeCount>0){var s=i.getSelection().getRangeAt(0),o=s.cloneRange();o.selectNodeContents(e),o.setEnd(s.endContainer,s.endOffset),n=o.toString().length}}else if((t=a.selection)&&"Control"!=t.type){var r=t.createRange(),c=a.body.createTextRange();c.moveToElementText(e),c.setEndPoint("EndToEnd",r),n=c.text.length}return n},setCpos:function(e,t){for(t=parseInt(t),0>t&&(t=0),count=0,i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];if(null==n.tagName){if(n.length>=t-count){var a=document.createRange();a.setStart(n,t-count),a.setEnd(n,t-count);var s=window.getSelection();s.removeAllRanges(),s.addRange(a);break}count=parseInt(count)+parseInt(n.length)}else if(t-count<=1){$(n).after(document.createTextNode(" "));var a=document.createRange();a.setStartAfter(n),a.setEndAfter(n);var s=window.getSelection();s.removeAllRanges(),s.addRange(a);break}}},refreshContent:function(e,t){t=$(t),(null==e||0==e)&&(t.find("*[contenteditable]").on("dragover drop",function(e){return e.preventDefault(),!1}),t.find(".deletable").off(),t.find(".deletable").on("mouseenter",function(e){$(e.currentTarget).append('<div onclick="$(this).parent().remove();" class="delete-btn"><i class="fa fa-times"></i></div>')}),t.find(".deletable").on("mouseleave",function(e){$(e.currentTarget).children(".delete-btn").remove()})),t.find("iframe:not([src])").remove()},niceFocus:function(e){$(e).is("[contenteditable]")?""==$(e).html()&&(e=e.parentNode,r.refocus(e)):r.refocus(e)},refocus:function(t){t=$(t),t.children().last().is("div")||(t.append('<div contenteditable="true"> </div>'),refreshContent(t)),e=t.children().last()[0],e.focus();var n=document.createRange();n.selectNodeContents(e),n.collapse(!1);var a=window.getSelection();a.removeAllRanges(),a.addRange(n)},filter_out_ending:function(e,t){r.searchFilter(e,l.endingYoutube,t),r.searchFilter(e,l.endingYoutube2,t),r.searchFilter(e,l.endingVimeo,t),r.searchFilter(e,l.endingDailymotion,t),r.searchFilter(e,l.endingVine,t),r.searchFilter(e,l.endingDeezer,t),r.searchFilter(e,l.endingSoundcloud,t),r.searchFilter(e,l.endingImage,t),r.searchFilter(e,l.endingVideo,t),r.searchFilter(e,l.endingLink,t)},filter_out_search:function(e,t){r.searchFilter(e,l.searchYoutube,t),r.searchFilter(e,l.searchYoutube2,t),r.searchFilter(e,l.searchVimeo,t),r.searchFilter(e,l.searchDailymotion,t),r.searchFilter(e,l.searchVine,t),r.searchFilter(e,l.searchDeezer,t),r.searchFilter(e,l.searchSoundcloud,t),r.searchFilter(e,l.searchImage,t),r.searchFilter(e,l.searchVideo,t),r.searchFilter(e,l.searchLink,t)},filter_out_all:function(e,t){r.filter_out_ending(e,t),r.filter_out_search(e,t)},decode:function(e){return br2nl(html_entity_decode(e,"ENT_NOQUOTES"))},encode:function(e){return nl2br(htmlentities(e,"ENT_NOQUOTES"))},searchMatch:function(e){var t=(e.callerName,e.inner),n=e.regex,a=e.substitution,i=e.callback,s=e.fail,o=e.ajax_url;t=r.decode(t);var c=[],l=t.match(n);if(m=[],xhrs=[],null!=l)for(j=0;j<l.length;j++)m.push(l[j].replace(/[\s]*/gi,""));if(m.length>0&&(console.log(e),console.log("from inner:'"+t+"'")),0!=m.length){var d=t;for(j=0;j<m.length;j++){var u=d.indexOf(m[j]),p=d.slice(0,u);p.match(/^\s+$/)&&(p=""),0==j?c.push(encode(p)):c.push('<div contenteditable="true">'+encode(p)+"</div>"),c.push(a(m[j])),d=d.slice(u+m[j].length)}for(d.match(/^\s*$/)||c.push('<div contenteditable="true">'+encode(d)+"</div>"),
j=0;j<m.length;j++)settings=new Object,settings.url=o+"?url="+encodeURI(m[j]),null!=i?settings.success=function(e){i(e)}:settings.success=function(e){console.log(e)},null!=s&&(settings.error=function(){s(m[j])}),null!=i&&$.ajax(settings)}else c[0]=r.encode(t);return c}},l={endingDeezer:function(e){return r1=/[\s]*(https?:\/\/www.deezer.com\/)(playlist)\/(\d+)$/gi,substitution=function(e){return playlist_id=e.replace(/[\s]*(https?:\/\/www.deezer.com\/)(playlist)\/(\d+)$/,"$3"),output='<span class="deletable" data-src="'+e+'" contenteditable="false" id="'+str2md5(e)+'">',output+='<div class="embed-responsive embed-responsive-16by9"><iframe scrolling="no" frameborder="0" allowTransparency="true" src="http://www.deezer.com/plugins/player?playlist=true&type=playlist&id='+playlist_id+'"></iframe></div>',output+="</span>",output},output=r.searchMatch({callerName:"endingDeezer",inner:e,regex:r1,substitution:substitution}),output},searchDeezer:function(e){return r1=/[\s]*(https?:\/\/www.deezer.com\/)(playlist)\/(\d+)[\s]/gi,substitution=function(e){return playlist_id=e.replace(/[\s]*(https?:\/\/www.deezer.com\/)(playlist)\/(\d+)$/,"$3"),output='<span class="deletable" data-src="'+e+'" contenteditable="false" id="'+str2md5(e)+'">',output+='<div class="embed-responsive embed-responsive-16by9"><iframe scrolling="no" frameborder="0" allowTransparency="true" src="http://www.deezer.com/plugins/player?playlist=true&type=playlist&id='+playlist_id+'"></iframe></div>',output+="</span>",output},output=r.searchMatch({callerName:"searchDeezer",inner:e,regex:r1,substitution:substitution}),output},endingSoundcloud:function(e){return r1=/[\s]*(https?:\/\/soundcloud.com\/)([\w\-]+)\/([\w\-]+)(\/[\w\-]+)?$/gi,substitution=function(e){return output='<span class="deletable" data-src="'+e+'" contenteditable="false" id="'+str2md5(e)+'"><img src="Assets/ajax-loader.gif"/></span>',"undefined"!=typeof SC&&setTimeout(function(){SC.oEmbed(e,{auto_play:!0},function(t){song_url=t.html.replace(/.*src="([^"]+)".*/,"$1"),song_url=song_url.replace(/auto_play=true/,"auto_play=false"),output='<div class="embed-responsive embed-responsive-16by9"><iframe class="embed-responsive-item" scrolling="no" frameborder="0" src="'+song_url+'"></iframe></div>',$("#"+str2md5(e)).html(output)})},50),output},output=r.searchMatch({callerName:"endingSoundcloud",inner:e,regex:r1,substitution:substitution}),output},searchSoundcloud:function(e){return r1=/[\s]*(https?:\/\/soundcloud.com\/)([\w\-]+)\/([\w\-]+)(\/[\w\-]+)?[\s]/gi,substitution=function(e){return output='<span class="deletable" data-src="'+e+'" contenteditable="false" id="'+str2md5(e)+'"><img src="Assets/ajax-loader.gif"/></span>',setTimeout(function(){SC.oEmbed(e,{auto_play:!0},function(t){song_url=t.html.replace(/.*src="([^"]+)".*/,"$1"),song_url=song_url.replace(/auto_play=true/,"auto_play=false"),output='<div class="embed-responsive embed-responsive-16by9"><iframe class="embed-responsive-item" scrolling="no" frameborder="0" src="'+song_url+'"></iframe></div>',$("#"+str2md5(e)).html(output)})},50),output},output=r.searchMatch({callerName:"searchSoundcloud",inner:e,regex:r1,substitution:substitution}),output},endingVine:function(e){return r1=/[\s]*(https?:\/\/vine.co\/v\/)([\w\-]+)$/gi,substitution=function(e){var t='<span class="deletable" data-src="'+e+'" contenteditable="false" id="'+str2md5(e)+'">',n=e.replace(/(https?:\/\/vine.co\/v\/)([\w\-]+)/,'<div class="embed-responsive embed-responsive-square"><iframe seamless class="embed-responsive-item" src="$1$2/embed/simple" frameborder="0"></iframe></div><script async src="//platform.vine.co/static/scripts/embed.js" charset="utf-8"></script>'),a="</span>";return t+n+a},output=r.searchMatch({callerName:"endingVine",inner:e,regex:r1,substitution:substitution}),output},searchVine:function(e){return r1=/[\s]*(https?:\/\/vine.co\/v\/)([\w\-]+)[\s]/gi,substitution=function(e){var t='<span class="deletable" data-src="'+e+'" contenteditable="false" id="'+str2md5(e)+'">',n=e.replace(/(https?:\/\/vine.co\/v\/)([\w\-]+)/,'<div class="embed-responsive embed-responsive-square"><iframe seamless class="embed-responsive-item" src="$1$2/embed/simple" frameborder="0"></iframe></div><script async src="//platform.vine.co/static/scripts/embed.js" charset="utf-8"></script>'),a="</span>";return t+n+a},output=r.searchMatch({callerName:"searchVine",inner:e,regex:r1,substitution:substitution}),output},endingDailymotion:function(e){return r1=/[\s]*(https?:\/\/www.dailymotion.com\/video\/)([\w\-]+)$/gi,substitution=function(e){var t='<span class="deletable" data-src="'+e+'" contenteditable="false" id="'+str2md5(e)+'">',n=e.replace(/(http:\/\/www.dailymotion.com\/video\/)([\w\-]+)/,'<div class="embed-responsive embed-responsive-16by9"><iframe seamless frameborder="0" class="embed-responsive-item" src="http://www.dailymotion.com/embed/video/$2" allowfullscreen></iframe></div>'),a="</span>";return t+n+a},output=r.searchMatch({callerName:"endingDailymotion",inner:e,regex:r1,substitution:substitution}),output},searchDailymotion:function(e){return r1=/[\s]*(https?:\/\/www.dailymotion.com\/video\/)([\w\-]+)[\s]/gi,substitution=function(e){var t='<span class="deletable" data-src="'+e+'" contenteditable="false" id="'+str2md5(e)+'">',n=e.replace(/(https?:\/\/www.dailymotion.com\/video\/)([\w\-]+)/,'<div class="embed-responsive embed-responsive-16by9"><iframe seamless frameborder="0" class="embed-responsive-item" src="http://www.dailymotion.com/embed/video/$2" allowfullscreen></iframe></div>'),a="</span>";return t+n+a},output=r.searchMatch({callerName:"searchDailymotion",inner:e,regex:r1,substitution:substitution}),output},endingVimeo:function(e){return r1=/[\s]*(https?:\/\/vimeo.com\/)(channels\/staffpicks\/)?([0-9]+)$/gi,substitution=function(e){var t='<span class="deletable" data-src="'+e+'" contenteditable="false" id="'+str2md5(e)+'">',n=e.replace(/(https?:\/\/vimeo.com\/)(channels\/staffpicks\/)?([0-9]+)/,'<div class="embed-responsive embed-responsive-16by9"><iframe seamless frameborder="0" class="embed-responsive-item" src="http://player.vimeo.com/video/$3" allowfullscreen></iframe></div>'),a="</span>";return t+n+a},output=r.searchMatch({callerName:"endingVimeo",inner:e,regex:r1,substitution:substitution}),output},searchVimeo:function(e){return r1=/[\s]*(https?:\/\/vimeo.com\/)(channels\/staffpicks\/)?([0-9]+)[\s]/gi,substitution=function(e){var t='<span class="deletable" data-src="'+e+'" contenteditable="false" id="'+str2md5(e)+'">',n=e.replace(/(https?:\/\/vimeo.com\/)(channels\/staffpicks\/)?([0-9]+)/,'<div class="embed-responsive embed-responsive-16by9"><iframe seamless frameborder="0" class="embed-responsive-item" src="http://player.vimeo.com/video/$3" allowfullscreen></iframe></div>'),a="</span>";return t+n+a},output=r.searchMatch({callerName:"searchVimeo",inner:e,regex:r1,substitution:substitution}),output},endingYoutube2:function(e){return r1=/[\s]*https?:\/\/youtu\.be\/[\w\/=?~.%&+\-#]+$/gi,substitution=function(e){var t=e.replace(/(https?:\/\/youtu\.be\/)([\w\-]+)([^\s]*)/,"$2"),n="http://www.youtube.com/embed/"+t,a='<span class="deletable" data-src="'+e+'" contenteditable="false" id="'+str2md5(e)+'"><div class="embed-responsive embed-responsive-16by9"><iframe class="embed-responsive-item" seamless src="'+n+'"/><iframe></div></span>';return a},output=r.searchMatch({callerName:"endingYoutube2",inner:e,regex:r1,substitution:substitution}),output},searchYoutube2:function(e){return r1=/[\s]*https?:\/\/youtu\.be\/[\w\/=?~.%&+\-#]+[\s]/gi,substitution=function(e){var t=e.replace(/(https?:\/\/youtu\.be\/)([\w\-]+)([^\s]*)/,"$2"),n="http://www.youtube.com/embed/"+t+"?wmode=opaque",a='<span class="deletable" data-src="'+e+'" contenteditable="false" id="'+str2md5(e)+'"><div class="embed-responsive embed-responsive-16by9"><iframe class="embed-responsive-item" seamless src="'+n+'"/><iframe></div></span>';return a},output=r.searchMatch({callerName:"searchYoutube2",inner:e,regex:r1,substitution:substitution}),output},endingYoutube:function(e){return r1=/[\s]*https?:\/\/(www|m)\.youtube\.com\/watch[\w\/=?~.%&+\-#]+$/gi,substitution=function(e){var t=e.replace(/(https?:\/\/(www|m).youtube.com\/watch\?)([^\s]*)v=([\w\-]+)([^\s]*)/,"$4"),n="http://www.youtube.com/embed/"+t,a='<span class="deletable" data-src="'+e+'" contenteditable="false" id="'+str2md5(e)+'"><div class="embed-responsive embed-responsive-16by9"><iframe class="embed-responsive-item" seamless  src="'+n+'"/><iframe></div></span>';return a},output=r.searchMatch({callerName:"endingYoutube",inner:e,regex:r1,substitution:substitution}),output},searchYoutube:function(e){return r1=/[\s]*https?:\/\/(www|m)\.youtube\.com\/watch[\w\/=?~.%&+\-#]+[\s]/gi,substitution=function(e){var t=e.replace(/(https?:\/\/(www|m).youtube.com\/watch\?)([^\s]*)v=([\w\-]+)([^\s]*)/,"$4"),n="http://www.youtube.com/embed/"+t+"?wmode=opaque",a='<span class="deletable" data-src="'+e+'" contenteditable="false" id="'+str2md5(e)+'"><div class="embed-responsive embed-responsive-16by9"><iframe class="embed-responsive-item" seamless  src="'+n+'"/><iframe></div></span>';return a},output=r.searchMatch({callerName:"searchYoutube",inner:e,regex:r1,substitution:substitution}),output},endingVideo:function(e){return r1=/[\s]*https?:\/\/[\w\/=?~.%&+\-#]+(\.mp4|\.webm)(\?\w*)?$/gi,substitution=function(e){return'<span class="deletable" data-src="'+e+'" contenteditable="false" id="'+str2md5(e)+'"><video autoplay loop><source src="'+e+'"></video></span>'},output=r.searchMatch({callerName:"endingVideo",inner:e,regex:r1,substitution:substitution}),output},searchVideo:function(e){return r1=/[\s]*https?:\/\/[\w\/=?~.%&+\-#]+(\.mp4|\.webm)(\?\w*)?[\s]/gi,substitution=function(e){return'<span class="deletable" data-src="'+e+'" contenteditable="false" id="'+str2md5(e)+'"><video autoplay loop><source src="'+e+'"></video></span>'},output=r.searchMatch({callerName:"searchVideo",inner:e,regex:r1,substitution:substitution}),output},endingImage:function(e){return r1=/[\s]*https?:\/\/[\w\/=?~.%&+\-#]+(\.png|\.bmp|\.jpg|\.jpeg|\.gif)(\?\w*)?$/gi,substitution=function(e){return'<span class="deletable" data-src="'+e+'" contenteditable="false" id="'+str2md5(e)+'"><img onerror="this.src=\'http://www.nibou.eu/zusam/web/assets/no_image.png\'" src="'+e+'"/></span>'},output=r.searchMatch({callerName:"endingImage",inner:e,regex:r1,substitution:substitution}),output},searchImage:function(e){return r1=/[\s]*https?:\/\/[\w\/=?~.%&+\-#\!]+(\.png|\.bmp|\.jpg|\.jpeg|\.gif)(\?\w*)?[\s]/gi,substitution=function(e){return'<span class="deletable" data-src="'+e+'" contenteditable="false" id="'+str2md5(e)+'"><img onerror="this.src=\'http://www.nibou.eu/zusam/web/assets/no_image.png\'" src="'+e+'"/></span>'},output=r.searchMatch({callerName:"searchImage",inner:e,regex:r1,substitution:substitution}),output},fail_request:function(t){for(base_url=decodeURI(t).replace(/https?:\/\/(www\.)?([^\/\?\#]+).*/i,"$1$2"),e=$('<a class="b-link" href="'+decodeURI(t).replace(/\s/," ")+'" target="_blank"></a>'),container=$("<div>"),total_width=0,i=0;i<100&&!(total_width>100);i++)c=parseInt(100*Math.random()+30),w=10*Math.random(),total_width+=w,h="80px",d=$("<div>").css({margin:"0px",display:"inline-block",width:w+"%","padding-bottom":h,background:"rgba("+c+","+c+","+c+",1)"}),container.append(d);return e.append(container),e.append('<span><i class="fa fa-external-link-square"></i> '+base_url+"</span>"),e},open_graph_build:function(t){return base_url=t.base_url,console.log(t.image.url),t.image.url.match(/https?:\/\/.+(\.png|\.bmp|\.jpg|\.jpeg|\.gif)/i)?preview='<div class="preview"><img src="'+t.image.url+'"/></div>':(console.log("nope"),preview=""),null!=t.title&&""!=t.title?title='<div class="title">'+html_entity_decode(t.title)+"</div>":title="",null!=t.description&&""!=t.description?description='<div class="description">'+html_entity_decode(t.description)+"</div>":description="",""!=preview||""!=title&&""!=description?""!=t.image.url&&null!=t.w&&null!=t.h&&parseInt(t.w)<380?e=$('<a class="article_small" href="'+decodeURI(t.url)+'" target="_blank">'+preview+title+description+'<div class="base_url">'+base_url+"</div></a>"):e=$('<a class="article_big" href="'+decodeURI(t.url)+'" target="_blank">'+preview+title+description+'<div class="base_url">'+base_url+"</div></a>"):e=fail_request(t.url),e},endingLink:function(t){return r1=/[\s]*https?:\/\/[\w\/=?~,.%&+\-#\!]+$/gi,substitution=function(e){return output='<span class="deletable" data-src="'+e+'" contenteditable="false" id="'+str2md5(e.replace(/#.+$/,""))+'"><img src="Assets/ajax-loader.gif"/></span>',output},ajax_url="Ajax/gen_preview.php",callback=function(t){e=open_graph_build(t),balise=$("#"+str2md5(decodeURI(t.url))),balise.html(e)},fail=function(t){e=fail_request(t),balise=$("#"+str2md5(t)),balise.html(e)},output=r.searchMatch({callerName:"endinglink",inner:t,regex:r1,substitution:substitution,ajax_url:ajax_url,callback:callback,fail:fail}),output},searchLink:function(t){return r1=/[\s]*https?:\/\/[\w\/=?~,.%&+\-#]+[\s]/gi,substitution=function(e){return output='<span class="deletable" data-src="'+e+'" contenteditable="false" id="'+str2md5(e.replace(/#.+$/,""))+'"><img src="Assets/ajax-loader.gif"/></span>',output},ajax_url="Ajax/gen_preview.php",callback=function(t){e=open_graph_build(t),balise=$("#"+str2md5(decodeURI(t.url))),balise.html(e)},fail=function(t){e=fail_request(t),balise=$("#"+str2md5(t)),balise.html(e)},output=r.searchMatch({callerName:"searchLink",inner:t,regex:r1,substitution:substitution,ajax_url:ajax_url,callback:callback,fail:fail}),output}};t.Control=r,t.Filter=l,t.stop=a,t.start=s,t.view=o}({},function(){return this}());
