{"version":3,"sources":["../node_modules/idb-keyval/dist/idb-keyval.mjs","core/param.js","core/alert.js","core/cache.js","core/storage.js","core/me.js","core/lang.js","core/router.js","core/util.js","core/http.js","core/index.js","service-workers.js"],"names":["Store","constructor","dbName","storeName","_dbp","Promise","resolve","reject","openreq","indexedDB","open","onerror","error","onsuccess","result","onupgradeneeded","createObjectStore","_withIDBStore","type","callback","then","db","transaction","oncomplete","onabort","objectStore","store","getDefaultStore","get","key","req","set","value","put","del","delete","clear","keys","openKeyCursor","openCursor","call","push","continue","param","ZUSAM_VERSION","CACHE_VERSION","CACHE","CACHE_STORE","alert","remove","id","document","getElementById","outerHTML","add","text","alertStyle","countdown","alertNode","createElement","hash","innerHTML","classList","body","appendChild","setTimeout","str","length","i","charCodeAt","cache","name","cache_store","purgeOldCache","_","map","k","e","lastUsed","Date","now","console","log","url","caches","c","removeMatching","matchAll","a","all","filter","match","r","storage","usage","total","localStorage","hasOwnProperty","createStorageBox","data","metadata","createdAt","removeItem","setItem","JSON","stringify","getItem","parse","reset","window","dispatchEvent","CustomEvent","me","update","http","Object","assign","notifications","loadNotifications","fetchDict","matchNotification","notif","target","isNew","Array","isArray","some","n","fromMessage","removeMatchingNotifications","lang","dict","possibleLang","en","es","fr","sk","getDefaultLang","querySelector","content","getCurrentLang","t","params","count","getOwnPropertyNames","isNaN","sort","b","slice","forEach","s","rid","replace","router","route","action","backUrl","backUrlPrompt","entityUrl","entityType","search","entity","isValidUrl","URL","getSubpath","baseURI","pathname","toApp","location","origin","removeSubpath","path","RegExp","getParam","searchParams","substring","res","split","find","getSegments","isOutside","includes","isEntity","getUrlComponents","components","navigate","options","href","warn","util","getId","group","catch","history","replaceState","pushState","apiKey","post","user","groups","sync","onClick","newTab","preventDefault","stopPropagation","closest","getAttribute","startsWith","targetUrl","host","ctrlKey","getElementsByClassName","urlRegExp","getUrl","txt","link","endsWith","humanFullDate","timestamp","d","getTime","getTimezoneOffset","toISOString","humanTime","duration","Math","abs","round","floor","getGroupId","getGroupName","g","pop","thumbnail","width","height","crop","defaultAvatar","reduce","colorHash","backgroundHash","c1","c2","reverse","join","sendFile","formData","loadFn","progressFn","errorFn","xhr","XMLHttpRequest","setRequestHeader","addEventListener","status","response","statusText","upload","onprogress","loaded","send","err","nocache","h","fetch","method","headers","Headers","ok","json","contentType","request","fetchOptions","exception","message","_param","_alert","_cache","_storage","_http","_me","_router","_util","_lang","cached_routes","addToCache","fromNetwork","toCache","responseClone","clone","fromCache","matching","self","evt","respondWith","waitUntil"],"mappings":"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","file":"service-workers.js","sourceRoot":"../src","sourcesContent":["class Store {\r\n    constructor(dbName = 'keyval-store', storeName = 'keyval') {\r\n        this.storeName = storeName;\r\n        this._dbp = new Promise((resolve, reject) => {\r\n            const openreq = indexedDB.open(dbName, 1);\r\n            openreq.onerror = () => reject(openreq.error);\r\n            openreq.onsuccess = () => resolve(openreq.result);\r\n            // First time setup: create an empty object store\r\n            openreq.onupgradeneeded = () => {\r\n                openreq.result.createObjectStore(storeName);\r\n            };\r\n        });\r\n    }\r\n    _withIDBStore(type, callback) {\r\n        return this._dbp.then(db => new Promise((resolve, reject) => {\r\n            const transaction = db.transaction(this.storeName, type);\r\n            transaction.oncomplete = () => resolve();\r\n            transaction.onabort = transaction.onerror = () => reject(transaction.error);\r\n            callback(transaction.objectStore(this.storeName));\r\n        }));\r\n    }\r\n}\r\nlet store;\r\nfunction getDefaultStore() {\r\n    if (!store)\r\n        store = new Store();\r\n    return store;\r\n}\r\nfunction get(key, store = getDefaultStore()) {\r\n    let req;\r\n    return store._withIDBStore('readonly', store => {\r\n        req = store.get(key);\r\n    }).then(() => req.result);\r\n}\r\nfunction set(key, value, store = getDefaultStore()) {\r\n    return store._withIDBStore('readwrite', store => {\r\n        store.put(value, key);\r\n    });\r\n}\r\nfunction del(key, store = getDefaultStore()) {\r\n    return store._withIDBStore('readwrite', store => {\r\n        store.delete(key);\r\n    });\r\n}\r\nfunction clear(store = getDefaultStore()) {\r\n    return store._withIDBStore('readwrite', store => {\r\n        store.clear();\r\n    });\r\n}\r\nfunction keys(store = getDefaultStore()) {\r\n    const keys = [];\r\n    return store._withIDBStore('readonly', store => {\r\n        // This would be store.getAllKeys(), but it isn't supported by Edge or Safari.\r\n        // And openKeyCursor isn't supported by Safari.\r\n        (store.openKeyCursor || store.openCursor).call(store).onsuccess = function () {\r\n            if (!this.result)\r\n                return;\r\n            keys.push(this.result.key);\r\n            this.result.continue();\r\n        };\r\n    }).then(() => keys);\r\n}\n\nexport { Store, get, set, del, clear, keys };\n","const ZUSAM_VERSION = \"4.1\";\nconst CACHE_VERSION = \"0.3\";\n\nconst param = {\n  ZUSAM_VERSION: ZUSAM_VERSION,\n  CACHE_VERSION: CACHE_VERSION,\n  CACHE: \"zusam-\" + ZUSAM_VERSION + \"-simplecache-\" + CACHE_VERSION,\n  CACHE_STORE: \"zusam-\" + ZUSAM_VERSION\n};\n\nexport default param;\n","const alert = {\n  remove: id => (document.getElementById(id).outerHTML = \"\"),\n  add: (text, alertStyle = \"alert-success\", countdown = 5000) => {\n    if (!text) {\n      return;\n    }\n    let alertNode = document.createElement(\"DIV\");\n    alertNode.id = alert.hash(text);\n    alertNode.innerHTML = text;\n    alertNode.classList.add(\"global-alert\", \"alert\", alertStyle);\n    document.body.appendChild(alertNode);\n    setTimeout(() => alert.remove(alertNode.id), countdown);\n  },\n  hash: str => {\n    let hash = 0;\n    if (str.length == 0) {\n      return hash;\n    }\n    for (let i = 0; i < str.length; i++) {\n      let char = str.charCodeAt(i);\n      hash = (hash << 5) - hash + char;\n      hash = hash & hash; // Convert to 32bit integer\n    }\n    return hash;\n  }\n};\nexport default alert;\n","import { Store, set, get, keys, del } from \"idb-keyval\";\nimport param from \"./param.js\";\n\nconst cache = {\n  name: param.CACHE,\n  cache_store: new Store(param.CACHE_STORE, param.CACHE),\n  purgeOldCache: _ => {\n    keys().then(keys =>\n      keys.map(k =>\n        get(k).then(e => {\n          // purge if older than 30 days\n          if (e.lastUsed + 1000 * 60 * 60 * 24 * 30 < Date.now()) {\n            console.log(\"Remove from cache: \" + k.url);\n            del(k);\n            caches.open(cache.name).then(c => c.delete(k));\n          }\n        })\n      )\n    );\n  },\n  removeMatching: str =>\n    caches\n      .open(cache.name)\n      .then(c =>\n        c\n          .matchAll()\n          .then(a =>\n            Promise.all(a.filter(e => e.url.match(str)).map(r => c.delete(e)))\n          )\n      )\n};\n\nexport default cache;\n","const storage = {\n  usage: _ => {\n    let total = 0;\n    let k;\n    for (k in localStorage) {\n      if (localStorage.hasOwnProperty(k)) {\n        total += (localStorage[k].length + k.length) * 2;\n      }\n    }\n    return total;\n  },\n  createStorageBox: (data, metadata = null) => ({\n    data: data,\n    createdAt: Date.now(),\n    metadata: metadata\n  }),\n  remove: id => localStorage.removeItem(id),\n  set: (id, data, metadata = null) => {\n    localStorage.setItem(\n      id,\n      JSON.stringify(storage.createStorageBox(data, metadata))\n    );\n    return Promise.resolve(id);\n  },\n  get: id => {\n    let data = localStorage.getItem(id);\n    if (data != null) {\n      data = JSON.parse(data);\n      if (data.hasOwnProperty(\"data\")) {\n        return new Promise(r => r(data.data));\n      }\n    }\n    return new Promise(r => r(null));\n  },\n  reset: _ =>\n    localStorage.clear() &&\n    window.dispatchEvent(new CustomEvent(\"resetStorage\"))\n};\nexport default storage;\n","import http from \"./http.js\";\nimport lang from \"./lang.js\";\n\nconst me = {\n  me: {},\n  get: () => (me.me.id ? Promise.resolve(me.me) : me.update()),\n  update: () =>\n    http.get(\"/api/me\", true).then(r => {\n      if (!r) {\n        return;\n      }\n      me.me = Object.assign({ notifications: [] }, r);\n      me.loadNotifications();\n      lang.fetchDict();\n      window.dispatchEvent(new CustomEvent(\"meStateChange\"));\n      return r;\n    }),\n  loadNotifications: () =>\n    http.get(\"/api/users/\" + me.me.id + \"/notifications\").then(r => {\n      me.me.notifications = r;\n      window.dispatchEvent(new CustomEvent(\"meStateChange\"));\n    }),\n  matchNotification: (notif, id) => {\n    if (notif.id === id) {\n      return true;\n    }\n    if (notif.target === id) {\n      return true;\n    }\n    return false;\n  },\n  isNew: id =>\n    Array.isArray(me.me.notifications)\n      ? me.me.notifications.some(\n          n =>\n            me.matchNotification(n, id) ||\n            (n.type == \"new_comment\" && n.fromMessage.id === id)\n        )\n      : false,\n  removeMatchingNotifications: id => {\n    return me.loadNotifications().then(_ => {\n      if (!Array.isArray(me.me.notifications)) {\n        return Promise.reject(\"Failed to get notifications from server\");\n      }\n      return Promise.all(\n        me.me.notifications\n          .filter(n => me.matchNotification(n, id))\n          .map(n =>\n            http.delete(\"/api/notifications/\" + n.id).then(r => {\n              me.me.notifications = me.me.notifications.filter(\n                e => !me.matchNotification(e, id)\n              );\n              window.dispatchEvent(new CustomEvent(\"meStateChange\"));\n            })\n          )\n      );\n    });\n  }\n};\nexport default me;\n","import me from \"./me.js\";\nimport http from \"./http.js\";\n\nconst lang = {\n  dict: [], // dicts loaded for the current session\n  possibleLang: {\n    en: \"English\",\n    es: \"Español\",\n    fr: \"Français\",\n    sk: \"Slovenský\"\n  }, // possible dicts names to load\n  getDefaultLang: () =>\n    (document.querySelector(\"meta[name='zusam:default-lang']\") || {}).content ||\n    \"en\",\n  getCurrentLang: () =>\n    me.me && me.me[\"data\"]\n      ? me.me.data[\"lang\"] || lang.getDefaultLang()\n      : lang.getDefaultLang(),\n  fetchDict: (dict = lang.getCurrentLang()) =>\n    !lang.dict[dict] &&\n    http.get(\"/lang/\" + dict + \".json\").then(r => {\n      lang.dict[dict] = r;\n      window.dispatchEvent(new CustomEvent(\"fetchedNewDict\"));\n    }),\n  t: (id, params = {}) => {\n    // prepare default values\n    params.dict = params[\"dict\"] || lang.getCurrentLang();\n    params.count = params[\"count\"] || 0;\n\n    // quick validity checks\n    if (!id || !lang.dict[params.dict]) {\n      return \"\";\n    }\n\n    // select translation string corresponding to count\n    // We treat the list of translation keys like ranges\n    // So if we have the keys 0, 1, 5; we have the ranges [0], [1, 4], [5, +inf]\n    let str = lang.dict[params.dict][id] || \"\";\n    if (typeof str == \"object\") {\n      let keys = Object.getOwnPropertyNames(str)\n        .map(e => +e)\n        .filter(e => !isNaN(e) && e <= params.count)\n        .sort((a, b) => a - b);\n      str = keys.length ? str[keys.slice(-1)[0]] : \"\";\n    }\n\n    // replace parameters\n    Object.assign([], str.match(/{{\\w+}}/g)).forEach(s => {\n      let rid = s.replace(/[\\{\\}]/g, \"\");\n      if (params[rid]) {\n        str = str.replace(s, params[rid]);\n      }\n    });\n\n    return str;\n  }\n};\nexport default lang;\n","import http from \"./http.js\";\nimport me from \"./me.js\";\nimport util from \"./util.js\";\nimport lang from \"./lang.js\";\nimport storage from \"./storage.js\";\n\nconst router = {\n  route: \"\",\n  id: \"\",\n  action: \"\",\n  backUrl: \"\",\n  backUrlPrompt: \"\",\n  entityUrl: \"\",\n  entityType: \"\",\n  search: \"\",\n  entity: {},\n  isValidUrl: url => {\n    try {\n      new URL(url);\n      return true;\n    } catch (_) {\n      return false;\n    }\n  },\n  getSubpath: () => new URL(document.baseURI).pathname.replace(/\\/$/, \"\"),\n  toApp: url => {\n    if (!url || typeof url != \"string\") {\n      return \"\";\n    }\n    if (router.isValidUrl(url)) {\n      return url;\n    }\n    return location.origin + router.getSubpath() + url;\n  },\n  removeSubpath: path =>\n    path ? path.replace(new RegExp(\"^\" + router.getSubpath()), \"\") : \"\",\n  getParam: (param, searchParams = window.location.search.substring(1)) => {\n    let res = searchParams.split(\"&\").find(e => e.split(\"=\")[0] === param);\n    return res ? res.split(\"=\")[1] : \"\";\n  },\n  getSegments: () =>\n    window.location.pathname\n      .slice(1)\n      .split(\"?\")[0]\n      .split(\"/\"),\n  // check if route is \"outside\": accessible to non connected user\n  isOutside: () =>\n    [\n      \"login\",\n      \"password-reset\",\n      \"signup\",\n      \"invitation\",\n      \"stop-notification-emails\",\n      \"public\"\n    ].includes(router.route || router.getSegments()[0]),\n  isEntity: name =>\n    [\"messages\", \"groups\", \"users\", \"links\", \"files\"].includes(name),\n  getUrlComponents: url => {\n    let components = {};\n    if (url) {\n      components.url = new URL(url);\n      components.path = components.url.pathname;\n      components.search = components.url.search.slice(1);\n      [components.route, components.id, components.action] = router\n        .removeSubpath(components.path)\n        .slice(1)\n        .split(\"/\");\n    }\n    components.entityUrl = \"\";\n    components.entityType = \"\";\n    components.backUrl = \"\";\n    components.backUrlPrompt = \"\";\n    return components;\n  },\n  navigate: async (url = \"/\", options = {}) => {\n    if (!url.match(/^http/) && !options[\"raw_url\"]) {\n      url = router.toApp(url);\n    }\n    let components = router.getUrlComponents(url);\n    // do not allow to renavigate to the same url. This is done to avoid accidental navigate locks\n    if (router.url && router.url.href == components.url.href) {\n      console.warn(\"navigate lock !\");\n      return;\n    }\n    Object.assign(router, components);\n\n    // set url, backUrl and entityUrl\n    if (router.route && router.id && router.isEntity(router.route)) {\n      router.entityUrl = \"/api/\" + router.route + \"/\" + router.id;\n      router.entityType = router.route;\n\n      await http\n        .get(router.entityUrl)\n        .then(res => {\n          if (!res) {\n            console.warn(\"Unknown entity\");\n            router.navigate();\n            return;\n          }\n          router.entity = res;\n          switch (router.route) {\n            case \"groups\":\n              if (router.action == \"write\") {\n                router.backUrl = \"/\" + router.route + \"/\" + router.id;\n                router.backUrlPrompt = lang.t(\"cancel_write\");\n              }\n              if (router.search) {\n                router.backUrl = \"/\" + router.route + \"/\" + router.id;\n              }\n              break;\n            case \"messages\":\n              if (res[\"parent\"] && !res[\"isInFront\"]) {\n                router.backUrl = \"/messages/\" + res[\"parent\"].id;\n              } else {\n                router.backUrl = \"/groups/\" + util.getId(res.group);\n              }\n              break;\n            case \"users\":\n              router.backUrl = \"/\";\n              break;\n            default:\n              if (router.action) {\n                router.backUrl = \"/\";\n              }\n          }\n        })\n        .catch(e => console.warn(e));\n    }\n\n    switch (router.route) {\n      case \"login\":\n        storage.reset();\n      case \"create-group\":\n      case \"groups\":\n      case \"messages\":\n      case \"password-reset\":\n      case \"public\":\n      case \"share\":\n      case \"signup\":\n      case \"stop-notification-emails\":\n      case \"users\":\n        if (options.replace) {\n          history.replaceState(null, \"\", url);\n        } else {\n          history.pushState(null, \"\", url);\n        }\n        window.dispatchEvent(new CustomEvent(\"routerStateChange\"));\n        break;\n      case \"logout\":\n        storage.reset();\n        window.location.href = window.location.origin;\n        break;\n      case \"invitation\":\n        storage.get(\"apiKey\").then(apiKey => {\n          if (apiKey) {\n            http.post(\"/api/groups/invitation/\" + router.id, {}).then(res => {\n              window.location.href = window.location.origin;\n            });\n          } else {\n            router.navigate(\"/signup?inviteKey=\" + router.id);\n          }\n        });\n        break;\n      default:\n        me.get().then(user => {\n          if (!user) {\n            router.navigate(\"/login\");\n            return;\n          }\n          if (user.data[\"default_group\"]) {\n            router.navigate(\"/groups/\" + user.data[\"default_group\"]);\n          } else {\n            if (user.groups[0]) {\n              router.navigate(\"/groups/\" + user.groups[0].id);\n            } else {\n              window.location = \"/create-group\";\n            }\n          }\n        });\n    }\n  },\n  sync: () => {\n    router.navigate(location.pathname + location.search + location.hash, {\n      replace: true\n    });\n  },\n  onClick: (e, newTab = false, url = null) => {\n    // stop propagation\n    e.preventDefault();\n    e.stopPropagation();\n\n    // if url is not given, try to guess it\n    if (!url) {\n      const t = e.target.closest(\"a\");\n      if (t) {\n        if (t.target == \"_blank\") {\n          newTab = true;\n        }\n        url = t.getAttribute(\"href\");\n      }\n    }\n\n    if (!url) {\n      return;\n    }\n\n    // check if it's an external url\n    if (url.startsWith(\"http\")) {\n      let targetUrl = new URL(url);\n      if (targetUrl.host != location.host) {\n        if (e.ctrlKey || newTab) {\n          open(url, \"_blank\");\n        } else {\n          location.href = url;\n        }\n        return;\n      }\n    }\n\n    // disable active stances (dropdowns...)\n    for (let e of document.getElementsByClassName(\"active\")) {\n      e.classList.remove(\"active\");\n    }\n\n    // go to target url\n    if (e.ctrlKey || newTab) {\n      open(url, \"_blank\");\n    } else {\n      router.navigate(url);\n    }\n  }\n};\nexport default router;\n","import lang from \"./lang.js\";\nimport router from \"./router.js\";\nimport me from \"./me.js\";\n\nconst util = {\n  urlRegExp: new RegExp(\n    \"(\\\\([^()]*)?https?:\\\\/\\\\/[-A-Za-z0-9+&@#/%?=~_()|!:,.;*]*[-A-Za-z0-9+&@#/%=~_()|]\",\n    \"i\"\n  ),\n  getUrl: txt => {\n    if (!txt) {\n      return \"\";\n    }\n    let url = txt.match(util.urlRegExp);\n    if (url && url[0].startsWith(\"(\")) {\n      let link = url[0].match(/https?:\\/\\//i);\n      url[\"index\"] += link[\"index\"];\n      url[0] = url[0].slice(link[\"index\"]);\n      if (url[0].endsWith(\")\")) {\n        url[0] = url[0].slice(0, -1);\n      }\n    }\n    return url;\n  },\n  // full datetime as a string adapted to the users timezone\n  humanFullDate: timestamp => {\n    let d = new Date(timestamp * 1000);\n    d = new Date(d.getTime() + d.getTimezoneOffset() * 60000 * -1);\n    return d\n      .toISOString()\n      .replace(\"T\", \" \")\n      .replace(/\\..*$/, \"\");\n  },\n  // duration relative to event\n  humanTime: timestamp => {\n    if (!timestamp) {\n      return null;\n    }\n    const duration = Math.abs(Math.round((Date.now() / 1000 - timestamp) / 60));\n    if (duration < 1) {\n      return lang.t(\"just_now\");\n    }\n    if (duration < 60) {\n      return lang.t(\"ago\", { duration: duration + \"mn\" });\n    }\n    if (duration < 60 * 24) {\n      return lang.t(\"ago\", { duration: Math.floor(duration / 60) + \"h\" });\n    }\n    let date = new Date(timestamp * 1000);\n    return util.humanFullDate(timestamp).split(\" \")[0];\n  },\n  getGroupId: _ => {\n    if (me.me.groups) {\n      switch (router.entity.entityType) {\n        case \"group\":\n          return util.getId(router.entity);\n        case \"message\":\n          return util.getId(router.entity.group);\n      }\n    }\n    return \"\";\n  },\n  getGroupName: _ => {\n    let group = me.me.groups.find(g => g[\"id\"] == util.getGroupId());\n    return group ? group[\"name\"] : \"\";\n  },\n  // get the id of an object from an url\n  getId: e => {\n    switch (typeof e) {\n      case \"object\":\n        return e ? e.id : null;\n      case \"string\":\n        return e\n          .split(\"/\")\n          .pop()\n          .replace(/\\?.*$/, \"\")\n          .replace(/\\.\\w+$/, \"\");\n      default:\n        console.warn(e);\n        throw \"Could not extract id !\";\n    }\n  },\n  // get the url to a thubmnail\n  thumbnail: (id, width, height) =>\n    id\n      ? router.toApp(\"/api/images/thumbnail/\" + width + \"/\" + height + \"/\" + id)\n      : null,\n  // same as http.thumbnail but for a crop\n  crop: (id, width, height) =>\n    id\n      ? router.toApp(\"/api/images/crop/\" + width + \"/\" + height + \"/\" + id)\n      : null,\n  // default avatar in base64\n  defaultAvatar:\n    \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAABlBMVEUAAAD///+l2Z/dAAAAAnRSTlMA/iyWEiMAAAMJSURBVHja7ZtBjpwwEEWxmIhFFmiURZZEyi6HCLkZHCXr2eQKHIUjoEiRSGRRiWB6klaDU/hDF4z+W6LuNz3+ZRvbkCSEEEIIIYQQQgghhBBCCCGEEEIIITvwGfy+kxoTpNJigkw6TJBLjwkK8ZiglMFYUInAAqwQRKRBBR0q8FhXEKwVR0GLCvxCjeo6oyzkoIxnEvj5661acPO3yvFqpxdcV+Pj88VeNZ7cGB4ul1QFkv399KT4KBIpmGEwF4i9oL6DIN/3FzToL2ju8AvsBeE2aNFfQMFJBCkF0/R+bkHyCgSVuaDcVaC5zyvMBTkqyHYVaBZDKSpw5oJgLcMC5doXFBSoIMNutjcQBHJULmlhQYUKlmNQbs9kqGC5P2o3FqBBOVjMWkEOdcZQKam3dyqkkgP/g35zxmEpLhbjir0ZFz2tXHgbPR5deI+EMPKmig/hhU/fIkOYL4iYDbIyqpCXajp2Zy4yhNuxqUfbMCaEIraQZ9swJgQBQ0jBQr6eYXrzQrYIYdtC9uaFbDKayJajyTkL+VijyWA+mnBajGpDeFrMzAu5BNvwKoQBDaFHQ+jQEBo0hBoMYUBD8GgIHRpCi44mcAiJRQhoITvzQs63LGQxL2SOJnEhiHUI296bwNOixb1JYr5kz8yX7Odf6XDfBC9kd6yVzq+np69QIY/8AEJ45kt0T4hIM0VONm5CiLlVhLflS+CwdTGEVa2AnfOFTogaVAAfcg1QivpqzLFHD4LnrR0q8FAhqlux3PPUu0EFLSrooL6kLeaQwKMCTY4OfUjVoY+IOvTxSFiw81NtnbmgRwXeXDAg08IxBPIKBPX5BQ0FBxC0+wtSCg4gcBT853nruwiqfQXNHQT/LDiGD9Old6sEL2umn3MtqxDks9NotVbwfaG+FDfL6fznsjV32365cTXrtqoPdJKYrbmreIDvT42DCMYoIUEu4FvIKSpwgr6JvYEAfJm8QgUl+j58gb6Rn4Nvcv/p0jUmcODr8IQQQgghhBBCCCGEEEIIIYQQQgghs/wGp6uYgtiKODIAAAAASUVORK5CYII=\",\n  hash: str =>\n    str.split(\"\").reduce((a, c) => ((a << 5) - a + c.charCodeAt()) | 0),\n  colorHash: str =>\n    [\n      \"#000000\",\n      \"#333366\",\n      \"#333399\",\n      \"#3333CC\",\n      \"#339933\",\n      \"#339999\",\n      \"#33CC33\",\n      \"#33CC99\",\n      \"#663333\",\n      \"#663366\",\n      \"#666633\",\n      \"#666699\",\n      \"#66CC33\",\n      \"#66CCCC\",\n      \"#993333\",\n      \"#993366\",\n      \"#993399\",\n      \"#996633\",\n      \"#999966\",\n      \"#CC3333\",\n      \"#CC3366\",\n      \"#CC3399\",\n      \"#CC33CC\",\n      \"#CC6633\",\n      \"#CC9933\",\n      \"#CC99CC\",\n      \"#CCCC33\"\n    ][Math.abs(util.hash(str)) % 27],\n  backgroundHash: str => {\n    if (!str) {\n      return \"background-color: #aaa;\";\n    }\n    let c1 = util.colorHash(str);\n    let c2 = util.colorHash(\n      str\n        .split(\"\")\n        .reverse()\n        .join(\".\")\n    );\n    let deg = 45 * (Math.abs(util.hash(str)) % 4);\n    return (\n      \"background-color:\" +\n      c1 +\n      \";background-image:linear-gradient(\" +\n      deg +\n      \"deg, \" +\n      c2 +\n      \" 15%, transparent 15% 30%, \" +\n      c2 +\n      \" 30% 45%, transparent 45% 60%, \" +\n      c2 +\n      \" 60% 75%, transparent 75% 90%, \" +\n      c2 +\n      \" 90%);\"\n    );\n  }\n};\nexport default util;\n","import util from \"./util.js\";\nimport alert from \"./alert.js\";\nimport storage from \"./storage.js\";\nimport router from \"./router.js\";\n\nconst http = {\n  sendFile: (formData, loadFn, progressFn = null, errorFn = null) => {\n    return storage\n      .get(\"apiKey\")\n      .then(apiKey => {\n        let xhr = new XMLHttpRequest();\n        xhr.open(\"POST\", document.baseURI + \"api/files\", true);\n        xhr.setRequestHeader(\"X-AUTH-TOKEN\", apiKey);\n        xhr.addEventListener(\"load\", e => {\n          if (e.target.status > 199 && e.target.status < 300) {\n            loadFn(JSON.parse(e.target.response));\n          } else {\n            if (errorFn) {\n              errorFn(e.target.statusText);\n            } else {\n              console.error(e.target.statusText);\n            }\n          }\n        });\n        if (progressFn) {\n          xhr.upload.onprogress = e =>\n            progressFn({ loaded: e.loaded, total: e.total });\n        }\n        if (errorFn) {\n          xhr.addEventListener(\"error\", e => errorFn(e));\n        }\n        xhr.send(formData);\n      })\n      .catch(err => {\n        err => console.warn(\"ERROR for \" + url, err);\n      })\n      .catch(error => alert.add(error, \"alert-danger\"));\n  },\n  get: (url, nocache = false) => {\n    return storage\n      .get(\"apiKey\")\n      .then(apiKey => {\n        url = router.toApp(url);\n        if (!url) {\n          return;\n        }\n        let h = {};\n        if (apiKey) {\n          h[\"X-AUTH-TOKEN\"] = apiKey;\n        }\n        if (nocache) {\n          h[\"X-NOCACHE\"] = \"nocache\";\n        }\n        return fetch(url, {\n          method: \"GET\",\n          headers: new Headers(h)\n        })\n          .then(res => res.ok && res.json())\n          .catch(err => console.warn(\"ERROR for \" + url, err));\n      })\n      .catch(error => alert.add(error, \"alert-danger\"));\n  },\n  post: (url, data, contentType = \"application/json\") =>\n    http.request(url, data, \"POST\", contentType),\n  put: (url, data, contentType = \"application/json\") =>\n    http.request(url, data, \"PUT\", contentType),\n  delete: (url, data, contentType = \"application/json\") =>\n    http.request(url, null, \"DELETE\", contentType),\n  request: (url, data, method, contentType = \"application/json\") => {\n    return storage\n      .get(\"apiKey\")\n      .then(apiKey => {\n        url = router.toApp(url);\n        if (!url) {\n          return;\n        }\n        let h = {};\n        if (apiKey) {\n          h[\"X-AUTH-TOKEN\"] = apiKey;\n        }\n        if (contentType) {\n          h[\"Content-type\"] = contentType;\n        }\n        let fetchOptions = {\n          method: method,\n          headers: new Headers(h)\n        };\n        if (data) {\n          fetchOptions.body =\n            typeof data == \"object\" && data.constructor.name == \"Object\"\n              ? JSON.stringify(data)\n              : data;\n        }\n        return fetch(url, fetchOptions)\n          .then(res => {\n            if (method == \"DELETE\") {\n              return res;\n            }\n            try {\n              return res.json();\n            } catch (exception) {\n              console.warn(exception.message);\n              return Promise.reject(exception.message);\n            }\n          })\n          .catch(err => console.warn(\"ERROR for \" + url, err));\n      })\n      .catch(error => alert.add(error, \"alert-danger\"));\n  }\n};\nexport default http;\n","import _param from \"./param.js\";\nimport _alert from \"./alert.js\";\nimport _cache from \"./cache.js\";\nimport _storage from \"./storage.js\";\nimport _http from \"./http.js\";\nimport _me from \"./me.js\";\nimport _router from \"./router.js\";\nimport _util from \"./util.js\";\nimport _lang from \"./lang.js\";\n\nexport const param = _param;\nexport const alert = _alert;\nexport const cache = _cache;\nexport const storage = _storage;\nexport const http = _http;\nexport const me = _me;\nexport const router = _router;\nexport const util = _util;\nexport const lang = _lang;\n","import { Store, set, get } from \"idb-keyval\";\nimport param from \"/core\";\n\nconst cache_store = new Store(param.CACHE_STORE, param.CACHE);\nconst cached_routes = [\n  {\n    route: new RegExp(\"/api/users/[^/]+/?$\"),\n    duration: 1000 * 60 * 60 * 24, // 24h\n  },\n  {\n    route: new RegExp(\"/api/images/crop/\"),\n    duration: 1000 * 60 * 60 * 24 * 365, // 1 year\n  },\n  {\n    route: new RegExp(\"/api/images/thumbnail/\"),\n    duration: 1000 * 60 * 60 * 24 * 365, // 1 year\n  },\n  {\n    route: new RegExp(\"/api/links/by_url\\?\"),\n    duration: 1000 * 60 * 60 * 24 * 365, // 1 year\n  }\n];\n\n// On fetch, use cache but update the entry with the latest contents\n// from the server.\nself.addEventListener(\"fetch\", function(evt) {\n  if (evt.request.method == \"GET\") {\n    // cache-update routes: retrieve from cache and update in background\n    if (cached_routes.some(r => evt.request.url.match(r.route))) {\n      // You can use `respondWith()` to answer immediately, without waiting for the\n      // network response to reach the service worker...\n      evt.respondWith(fromCache(evt.request));\n\n      // ...and `waitUntil()` to prevent the worker from being killed until the function is finished.\n      evt.waitUntil(_ => {\n        get(evt.request.url, cache_store)\n          .then(r => {\n            if (r && r.hasOwnProperty(\"lastUsed\") && r.lastUsed != null) {\n              const timeout = r.lastUsed + cached_routes.find(r => evt.request.url.match(r.route))[\"duration\"];\n              // update the cache only if the timeout is reached\n              if (timeout < Date.now()) {\n                update(evt.request);\n              }\n            }\n          })\n          .catch(_ => update(evt.request));\n      });\n    }\n  }\n});\n\n// Add response to cache and store the lastUsed timestamp at the same time\nfunction addToCache(cache, request, response) {\n  return set(\n    request.url,\n    {\n      lastUsed: Date.now()\n    },\n    cache_store\n  ).then(_ => cache.put(request, response));\n}\n\n// Make a network request, return the result and add it to cache if asked\nfunction fromNetwork(request, toCache) {\n  return fetch(request).then(response => {\n    if (toCache) {\n      // response may be used only once\n      // we need to save clone to put one copy in cache\n      // and serve second one\n      let responseClone = response.clone();\n      caches.open(param.CACHE).then(cache => addToCache(cache, request, responseClone));\n    }\n    return response;\n  });\n}\n\n// Open the cache where the assets were stored and search for the requested\n// resource. Notice that in case of no matching, the promise still resolves\n// but it does with `undefined` as value.\nfunction fromCache(request) {\n  return caches.open(param.CACHE).then(cache => {\n    return cache.match(request).then(matching => {\n      if (matching) {\n        // reset lastUsed\n        return set(\n          request.url,\n          {\n            lastUsed: Date.now()\n          },\n          cache_store\n        ).then(_ => matching);\n      } else {\n        // if nothing matches, return response from network\n        return fromNetwork(request, true);\n      }\n    });\n  });\n}\n\n// Update consists in opening the cache, performing a network request and\n// storing the new response data.\nfunction update(request) {\n  return caches.open(param.CACHE).then(cache => {\n    return fetch(request).then(response => {\n      return addToCache(cache, request, response);\n    });\n  });\n}\n"]}