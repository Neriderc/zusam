{"version":3,"sources":["../node_modules/idb-keyval/dist/idb-keyval.mjs","core/param.js","core/alert.js","core/cache.js","core/storage.js","core/lang.js","core/me.js","core/util.js","core/router.js","core/http.js","core/index.js","service-workers.js"],"names":["Store","constructor","dbName","storeName","_dbp","Promise","resolve","reject","openreq","indexedDB","open","onerror","error","onsuccess","result","onupgradeneeded","createObjectStore","_withIDBStore","type","callback","then","db","transaction","oncomplete","onabort","objectStore","store","getDefaultStore","get","key","req","set","value","put","del","delete","clear","keys","openKeyCursor","openCursor","call","push","continue","param","ZUSAM_VERSION","CACHE_VERSION","CACHE","CACHE_STORE","alert","remove","id","document","getElementById","outerHTML","add","text","alertStyle","countdown","alertNode","createElement","hash","innerHTML","classList","body","appendChild","setTimeout","str","length","i","charCodeAt","cache","name","cache_store","purgeOldCache","map","k","e","lastUsed","Date","now","console","log","url","caches","c","removeMatching","openCache","matchAll","a","all","filter","match","storage","usage","total","localStorage","Object","prototype","hasOwnProperty","createStorageBox","data","metadata","createdAt","removeItem","setItem","JSON","stringify","getItem","parse","r","reset","window","dispatchEvent","CustomEvent","lang","dict","possibleLang","en","es","fr","sk","getDefaultLang","querySelector","content","getCurrentLang","me","fetchDict","http","t","params","count","getOwnPropertyNames","isNaN","sort","b","slice","assign","forEach","s","rid","replace","update","notifications","loadNotifications","matchNotification","notif","target","isNew","Array","isArray","some","n","fromMessage","removeMatchingNotifications","hasBookmark","bookmarks","bid","addBookmark","post","user","removeBookmark","loadBookmarks","util","genId","seed","toString","Math","random","id2Int","parseInt","urlRegExp","getUrl","txt","startsWith","link","endsWith","limitStrSize","limit","humanFullDate","timestamp","d","getTime","getTimezoneOffset","toISOString","humanTime","duration","abs","round","floor","split","getGroupId","groups","router","entity","entityType","getId","group","getGroupName","find","g","pop","thumbnail","width","height","toApp","crop","defaultAvatar","reduce","colorHash","backgroundHash","c1","c2","reverse","join","route","action","backUrl","backUrlPrompt","entityUrl","search","isValidUrl","URL","_","getSubpath","baseURI","pathname","location","origin","removeSubpath","path","RegExp","getParam","searchParams","substring","res","decodeURIComponent","getSegments","isOutside","includes","isEntity","getUrlComponents","components","navigate","options","href","warn","catch","history","replaceState","pushState","apiKey","sync","onClick","newTab","preventDefault","stopPropagation","closest","getAttribute","targetUrl","host","ctrlKey","getElementsByClassName","sendFile","formData","loadFn","progressFn","errorFn","xhr","XMLHttpRequest","setRequestHeader","addEventListener","status","response","statusText","upload","onprogress","loaded","send","nocache","h","fetch","method","headers","Headers","ok","json","err","contentType","request","fetchOptions","exception","message","_param","_alert","_cache","_storage","_http","_me","_router","_util","_lang","cached_routes","addToCache","fromNetwork","toCache","responseClone","clone","fromCache","matching","self","evt","respondWith","waitUntil","protoype"],"mappings":"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","file":"service-workers.js","sourceRoot":"../src","sourcesContent":["class Store {\r\n    constructor(dbName = 'keyval-store', storeName = 'keyval') {\r\n        this.storeName = storeName;\r\n        this._dbp = new Promise((resolve, reject) => {\r\n            const openreq = indexedDB.open(dbName, 1);\r\n            openreq.onerror = () => reject(openreq.error);\r\n            openreq.onsuccess = () => resolve(openreq.result);\r\n            // First time setup: create an empty object store\r\n            openreq.onupgradeneeded = () => {\r\n                openreq.result.createObjectStore(storeName);\r\n            };\r\n        });\r\n    }\r\n    _withIDBStore(type, callback) {\r\n        return this._dbp.then(db => new Promise((resolve, reject) => {\r\n            const transaction = db.transaction(this.storeName, type);\r\n            transaction.oncomplete = () => resolve();\r\n            transaction.onabort = transaction.onerror = () => reject(transaction.error);\r\n            callback(transaction.objectStore(this.storeName));\r\n        }));\r\n    }\r\n}\r\nlet store;\r\nfunction getDefaultStore() {\r\n    if (!store)\r\n        store = new Store();\r\n    return store;\r\n}\r\nfunction get(key, store = getDefaultStore()) {\r\n    let req;\r\n    return store._withIDBStore('readonly', store => {\r\n        req = store.get(key);\r\n    }).then(() => req.result);\r\n}\r\nfunction set(key, value, store = getDefaultStore()) {\r\n    return store._withIDBStore('readwrite', store => {\r\n        store.put(value, key);\r\n    });\r\n}\r\nfunction del(key, store = getDefaultStore()) {\r\n    return store._withIDBStore('readwrite', store => {\r\n        store.delete(key);\r\n    });\r\n}\r\nfunction clear(store = getDefaultStore()) {\r\n    return store._withIDBStore('readwrite', store => {\r\n        store.clear();\r\n    });\r\n}\r\nfunction keys(store = getDefaultStore()) {\r\n    const keys = [];\r\n    return store._withIDBStore('readonly', store => {\r\n        // This would be store.getAllKeys(), but it isn't supported by Edge or Safari.\r\n        // And openKeyCursor isn't supported by Safari.\r\n        (store.openKeyCursor || store.openCursor).call(store).onsuccess = function () {\r\n            if (!this.result)\r\n                return;\r\n            keys.push(this.result.key);\r\n            this.result.continue();\r\n        };\r\n    }).then(() => keys);\r\n}\n\nexport { Store, get, set, del, clear, keys };\n","const ZUSAM_VERSION = \"4.1\";\nconst CACHE_VERSION = \"0.3\";\n\nconst param = {\n  ZUSAM_VERSION,\n  CACHE_VERSION,\n  CACHE: `zusam-${  ZUSAM_VERSION  }-simplecache-${  CACHE_VERSION}`,\n  CACHE_STORE: `zusam-${  ZUSAM_VERSION}`\n};\n\nexport default param;\n","const alert = {\n  remove: id => (document.getElementById(id).outerHTML = \"\"),\n  add: (text, alertStyle = \"alert-success\", countdown = 5000) => {\n    if (!text) {\n      return;\n    }\n    let alertNode = document.createElement(\"DIV\");\n    alertNode.id = alert.hash(text);\n    alertNode.innerHTML = text;\n    alertNode.classList.add(\"global-alert\", \"alert\", alertStyle);\n    document.body.appendChild(alertNode);\n    setTimeout(() => alert.remove(alertNode.id), countdown);\n  },\n  hash: str => {\n    let hash = 0;\n    if (str.length == 0) {\n      return hash;\n    }\n    for (let i = 0; i < str.length; i++) {\n      let char = str.charCodeAt(i);\n      hash = (hash << 5) - hash + char;\n      hash = hash & hash; // Convert to 32bit integer\n    }\n    return hash;\n  }\n};\nexport default alert;\n","import { Store, get, keys, del } from \"idb-keyval\";\nimport param from \"./param.js\";\n\nconst cache = {\n  name: param.CACHE,\n  cache_store: new Store(param.CACHE_STORE, param.CACHE),\n  purgeOldCache: () => {\n    keys().then(keys =>\n      keys.map(k =>\n        get(k).then(e => {\n          // purge if older than 30 days\n          if (e.lastUsed + 1000 * 60 * 60 * 24 * 30 < Date.now()) {\n            console.log(`Remove from cache: ${  k.url}`);\n            del(k);\n            caches.open(cache.name).then(c => c.delete(k));\n          }\n        })\n      )\n    );\n  },\n  removeMatching: str => caches.open(cache.name).then(openCache => openCache.matchAll().then(a =>\n      Promise.all(a.filter(e => e.url.match(str)).map(e => openCache.delete(e)))\n    )\n  )\n};\n\nexport default cache;\n","const storage = {\n  usage: () => {\n    let total = 0;\n    let k;\n    for (k in localStorage) {\n      if (Object.prototype.hasOwnProperty.call(localStorage, k)) {\n        total += (localStorage[k].length + k.length) * 2;\n      }\n    }\n    return total;\n  },\n  createStorageBox: (data, metadata = null) => ({\n    data,\n    createdAt: Date.now(),\n    metadata\n  }),\n  remove: id => localStorage.removeItem(id),\n  set: (id, data, metadata = null) => {\n    localStorage.setItem(\n      id,\n      JSON.stringify(storage.createStorageBox(data, metadata))\n    );\n    return Promise.resolve(id);\n  },\n  get: id => {\n    let data = localStorage.getItem(id);\n    if (data != null) {\n      data = JSON.parse(data);\n      if (Object.prototype.hasOwnProperty.call(data, \"data\")) {\n        return new Promise(r => r(data.data));\n      }\n    }\n    return new Promise(r => r(null));\n  },\n  reset: () =>\n    localStorage.clear() &&\n    window.dispatchEvent(new CustomEvent(\"resetStorage\"))\n};\nexport default storage;\n","import me from \"./me.js\";\nimport http from \"./http.js\";\n\nconst lang = {\n  dict: [], // dicts loaded for the current session\n  possibleLang: {\n    en: \"English\",\n    es: \"Español\",\n    fr: \"Français\",\n    sk: \"Slovenský\"\n  }, // possible dicts names to load\n  getDefaultLang: () =>\n    (document.querySelector(\"meta[name='zusam:default-lang']\") || {}).content ||\n    \"en\",\n  getCurrentLang: () =>\n    me.me && me.me[\"data\"]\n      ? me.me.data[\"lang\"] || lang.getDefaultLang()\n      : lang.getDefaultLang(),\n  fetchDict: (dict = lang.getCurrentLang()) =>\n    !lang.dict[dict] &&\n    http.get(`/lang/${  dict  }.json`).then(r => {\n      lang.dict[dict] = r;\n      window.dispatchEvent(new CustomEvent(\"fetchedNewDict\"));\n    }),\n  t: (id, params = {}) => {\n    // prepare default values\n    params.dict = params[\"dict\"] || lang.getCurrentLang();\n    params.count = params[\"count\"] || 0;\n\n    // quick validity checks\n    if (!id || !lang.dict[params.dict]) {\n      return \"\";\n    }\n\n    // select translation string corresponding to count\n    // We treat the list of translation keys like ranges\n    // So if we have the keys 0, 1, 5; we have the ranges [0], [1, 4], [5, +inf]\n    let str = lang.dict[params.dict][id] || \"\";\n    if (typeof str == \"object\") {\n      let keys = Object.getOwnPropertyNames(str)\n        .map(e => +e)\n        .filter(e => !isNaN(e) && e <= params.count)\n        .sort((a, b) => a - b);\n      str = keys.length ? str[keys.slice(-1)[0]] : \"\";\n    }\n\n    // replace parameters\n    Object.assign([], str.match(/{{\\w+}}/g)).forEach(s => {\n      let rid = s.replace(/[{}]/g, \"\");\n      if (params[rid]) {\n        str = str.replace(s, params[rid]);\n      }\n    });\n\n    return str;\n  }\n};\nexport default lang;\n","import http from \"./http.js\";\nimport lang from \"./lang.js\";\n\nconst me = {\n  me: {},\n  get: () => (me.me.id ? Promise.resolve(me.me) : me.update()),\n  update: () =>\n    http.get(\"/api/me\", true).then(r => {\n      if (!r) {\n        return;\n      }\n      me.me = Object.assign({ notifications: [] }, r);\n      me.loadNotifications();\n      lang.fetchDict();\n      window.dispatchEvent(new CustomEvent(\"meStateChange\"));\n      return r;\n    }),\n  loadNotifications: () =>\n    http.get(`/api/users/${me.me.id}/notifications`).then(r => {\n      me.me.notifications = r;\n      window.dispatchEvent(new CustomEvent(\"meStateChange\"));\n    }),\n  matchNotification: (notif, id) => {\n    if (notif.id === id) {\n      return true;\n    }\n    if (notif.target === id) {\n      return true;\n    }\n    return false;\n  },\n  isNew: id =>\n    Array.isArray(me.me.notifications)\n      ? me.me.notifications.some(\n          n =>\n            me.matchNotification(n, id) ||\n            (n.type == \"new_comment\" && n.fromMessage.id === id)\n        )\n      : false,\n  removeMatchingNotifications: id => {\n    return me.loadNotifications().then(() => {\n      if (!Array.isArray(me.me.notifications)) {\n        return Promise.reject(\"Failed to get notifications from server\");\n      }\n      return Promise.all(\n        me.me.notifications\n          .filter(n => me.matchNotification(n, id))\n          .map(n =>\n            http.delete(`/api/notifications/${n.id}`).then(() => {\n              me.me.notifications = me.me.notifications.filter(\n                e => !me.matchNotification(e, id)\n              );\n              window.dispatchEvent(new CustomEvent(\"meStateChange\"));\n            })\n          )\n      );\n    });\n  },\n  hasBookmark: id => {\n    return Array.isArray(me.me?.data?.bookmarks) ? me.me.data.bookmarks.some(bid => bid === id) : false;\n  },\n  addBookmark: id => {\n    if (!me.hasBookmark(id)) {\n      http.post(`/api/users/${me.me.id}/bookmarks`, {id}).then(user => me.me = Object.assign(me.me, user));\n    }\n  },\n  removeBookmark: id => {\n    if (me.hasBookmark(id)) {\n      http.delete(`/api/users/${me.me.id}/bookmarks`, {id}).then(user => me.me = Object.assign(me.me, user));\n    }\n  },\n  loadBookmarks: () => Promise.all(me.me.data?.bookmarks?.map(bid => {\n    return http.get(`/api/messages/${bid}`);\n  })),\n};\nexport default me;\n","import lang from \"./lang.js\";\nimport router from \"./router.js\";\nimport me from \"./me.js\";\n\nconst util = {\n  // genId starts with a letter to be DOM friendly\n  // seed can be used to order ids\n  genId: seed => `z${seed}-${\n      Date.now().toString().slice(-5)\n    }${\n      Math.random().toString().slice(-5)\n    }`,\n  // transform an id into int for the API (TODO: revisit this on 0.5)\n  id2Int: id => parseInt(id.replace(/[^\\d]/g,''), 10),\n  urlRegExp: /(\\([^()]*)?https?:\\/\\/[^[\\]\\n\\r ]*[-A-Za-z0-9+&@#/%=~_()|]/i,\n  getUrl: txt => {\n    if (!txt) {\n      return \"\";\n    }\n    let url = txt.match(util.urlRegExp);\n    if (url && url[0].startsWith(\"(\")) {\n      let link = url[0].match(/https?:\\/\\//i);\n      url[\"index\"] += link[\"index\"];\n      url[0] = url[0].slice(link[\"index\"]);\n      if (url[0].endsWith(\")\")) {\n        url[0] = url[0].slice(0, -1);\n      }\n    }\n    return url;\n  },\n  limitStrSize: (str, limit) => str.length > limit ? `${str.slice(0, limit-3)}...` : str,\n  // full datetime as a string adapted to the users timezone\n  humanFullDate: timestamp => {\n    let d = new Date(timestamp * 1000);\n    d = new Date(d.getTime() + d.getTimezoneOffset() * 60000 * -1);\n    return d.toISOString().replace(\"T\", \" \").replace(/\\..*$/, \"\");\n  },\n  // duration relative to event\n  humanTime: timestamp => {\n    if (!timestamp) {\n      return null;\n    }\n    const duration = Math.abs(Math.round((Date.now() / 1000 - timestamp) / 60));\n    if (duration < 1) {\n      return lang.t(\"just_now\");\n    }\n    if (duration < 60) {\n      return lang.t(\"ago\", { duration: `${duration  }mn` });\n    }\n    if (duration < 60 * 24) {\n      return lang.t(\"ago\", { duration: `${Math.floor(duration / 60)  }h` });\n    }\n    return util.humanFullDate(timestamp).split(\" \")[0];\n  },\n  getGroupId: () => {\n    if (me.me.groups) {\n      switch (router.entity.entityType) {\n        case \"group\":\n          return util.getId(router.entity);\n        case \"message\":\n          return util.getId(router.entity.group);\n      }\n    }\n    return \"\";\n  },\n  getGroupName: () => {\n    let group = me.me.groups.find(g => g[\"id\"] == util.getGroupId());\n    return group ? group[\"name\"] : \"\";\n  },\n  // get the id of an object from an url\n  getId: e => {\n    switch (typeof e) {\n      case \"object\":\n        return e ? e.id : null;\n      case \"string\":\n        return e\n          .split(\"/\")\n          .pop()\n          .replace(/\\?.*$/, \"\")\n          .replace(/\\.\\w+$/, \"\");\n      default:\n        console.error(e);\n        throw \"Could not extract id !\";\n    }\n  },\n  // get the url to a thubmnail\n  thumbnail: (id, width, height) =>\n    id\n      ? router.toApp(`/api/images/thumbnail/${width}/${height}/${id}`)\n      : null,\n  // same as http.thumbnail but for a crop\n  crop: (id, width, height) =>\n    id\n      ? router.toApp(`/api/images/crop/${width}/${height}/${id}`)\n      : null,\n  // default avatar in base64\n  defaultAvatar:\n    \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAABlBMVEUAAAD///+l2Z/dAAAAAnRSTlMA/iyWEiMAAAMJSURBVHja7ZtBjpwwEEWxmIhFFmiURZZEyi6HCLkZHCXr2eQKHIUjoEiRSGRRiWB6klaDU/hDF4z+W6LuNz3+ZRvbkCSEEEIIIYQQQgghhBBCCCGEEEIIITvwGfy+kxoTpNJigkw6TJBLjwkK8ZiglMFYUInAAqwQRKRBBR0q8FhXEKwVR0GLCvxCjeo6oyzkoIxnEvj5661acPO3yvFqpxdcV+Pj88VeNZ7cGB4ul1QFkv399KT4KBIpmGEwF4i9oL6DIN/3FzToL2ju8AvsBeE2aNFfQMFJBCkF0/R+bkHyCgSVuaDcVaC5zyvMBTkqyHYVaBZDKSpw5oJgLcMC5doXFBSoIMNutjcQBHJULmlhQYUKlmNQbs9kqGC5P2o3FqBBOVjMWkEOdcZQKam3dyqkkgP/g35zxmEpLhbjir0ZFz2tXHgbPR5deI+EMPKmig/hhU/fIkOYL4iYDbIyqpCXajp2Zy4yhNuxqUfbMCaEIraQZ9swJgQBQ0jBQr6eYXrzQrYIYdtC9uaFbDKayJajyTkL+VijyWA+mnBajGpDeFrMzAu5BNvwKoQBDaFHQ+jQEBo0hBoMYUBD8GgIHRpCi44mcAiJRQhoITvzQs63LGQxL2SOJnEhiHUI296bwNOixb1JYr5kz8yX7Odf6XDfBC9kd6yVzq+np69QIY/8AEJ45kt0T4hIM0VONm5CiLlVhLflS+CwdTGEVa2AnfOFTogaVAAfcg1QivpqzLFHD4LnrR0q8FAhqlux3PPUu0EFLSrooL6kLeaQwKMCTY4OfUjVoY+IOvTxSFiw81NtnbmgRwXeXDAg08IxBPIKBPX5BQ0FBxC0+wtSCg4gcBT853nruwiqfQXNHQT/LDiGD9Old6sEL2umn3MtqxDks9NotVbwfaG+FDfL6fznsjV32365cTXrtqoPdJKYrbmreIDvT42DCMYoIUEu4FvIKSpwgr6JvYEAfJm8QgUl+j58gb6Rn4Nvcv/p0jUmcODr8IQQQgghhBBCCCGEEEIIIYQQQgghs/wGp6uYgtiKODIAAAAASUVORK5CYII=\",\n  hash: str =>\n    str.split(\"\").reduce((a, c) => ((a << 5) - a + c.charCodeAt()) | 0),\n  colorHash: str =>\n    [\n      \"#000000\",\n      \"#333366\",\n      \"#333399\",\n      \"#3333CC\",\n      \"#339933\",\n      \"#339999\",\n      \"#33CC33\",\n      \"#33CC99\",\n      \"#663333\",\n      \"#663366\",\n      \"#666633\",\n      \"#666699\",\n      \"#66CC33\",\n      \"#66CCCC\",\n      \"#993333\",\n      \"#993366\",\n      \"#993399\",\n      \"#996633\",\n      \"#999966\",\n      \"#CC3333\",\n      \"#CC3366\",\n      \"#CC3399\",\n      \"#CC33CC\",\n      \"#CC6633\",\n      \"#CC9933\",\n      \"#CC99CC\",\n      \"#CCCC33\"\n    ][Math.abs(util.hash(str)) % 27],\n  backgroundHash: str => {\n    if (!str) {\n      return \"background-color: #aaa;\";\n    }\n    let c1 = util.colorHash(str);\n    let c2 = util.colorHash(\n      str\n        .split(\"\")\n        .reverse()\n        .join(\".\")\n    );\n    let deg = 45 * (Math.abs(util.hash(str)) % 4);\n    return (\n      `background-color:${c1};background-image:linear-gradient(${deg}deg, ${c2} 15%, transparent 15% 30%, ${c2} 30% 45%, transparent 45% 60%, ${c2} 60% 75%, transparent 75% 90%, ${c2} 90%);`\n    );\n  }\n};\nexport default util;\n","import http from \"./http.js\";\nimport me from \"./me.js\";\nimport util from \"./util.js\";\nimport lang from \"./lang.js\";\nimport storage from \"./storage.js\";\n\nconst router = {\n  route: \"\",\n  id: \"\",\n  action: \"\",\n  backUrl: \"\",\n  backUrlPrompt: \"\",\n  entityUrl: \"\",\n  entityType: \"\",\n  search: \"\",\n  entity: {},\n  isValidUrl: url => {\n    try {\n      new URL(url);\n      return true;\n    } catch (_) {\n      return false;\n    }\n  },\n  getSubpath: () => new URL(document.baseURI).pathname.replace(/\\/$/, \"\"),\n  toApp: url => {\n    if (!url || typeof url != \"string\") {\n      return \"\";\n    }\n    if (router.isValidUrl(url)) {\n      return url;\n    }\n    return location.origin + router.getSubpath() + url;\n  },\n  removeSubpath: path =>\n    path ? path.replace(new RegExp(`^${  router.getSubpath()}`), \"\") : \"\",\n  getParam: (param, searchParams = window.location.search.substring(1)) => {\n    let res = searchParams.split(\"&\").find(e => e.split(\"=\")[0] === param);\n    return res ? decodeURIComponent(res.split(\"=\")[1]) : \"\";\n  },\n  getSegments: () =>\n    window.location.pathname\n      .slice(1)\n      .split(\"?\")[0]\n      .split(\"/\"),\n  // check if route is \"outside\": accessible to non connected user\n  isOutside: () =>\n    [\n      \"login\",\n      \"password-reset\",\n      \"signup\",\n      \"invitation\",\n      \"stop-notification-emails\",\n      \"public\"\n    ].includes(router.route || router.getSegments()[0]),\n  isEntity: name =>\n    [\"messages\", \"groups\", \"users\", \"links\", \"files\"].includes(name),\n  getUrlComponents: url => {\n    let components = {};\n    if (url) {\n      components.url = new URL(url);\n      components.path = components.url.pathname;\n      components.search = components.url.search.slice(1);\n      [components.route, components.id, components.action] = router\n        .removeSubpath(components.path)\n        .slice(1)\n        .split(\"/\");\n    }\n    components.entityUrl = \"\";\n    components.entityType = \"\";\n    components.backUrl = \"\";\n    components.backUrlPrompt = \"\";\n    return components;\n  },\n  navigate: async (url = \"/\", options = {}) => {\n    if (!url.match(/^http/) && !options[\"raw_url\"]) {\n      url = router.toApp(url);\n    }\n    let components = router.getUrlComponents(url);\n    // do not allow to renavigate to the same url. This is done to avoid accidental navigate locks\n    if (router.url && router.url.href == components.url.href) {\n      console.warn(\"navigate lock !\");\n      return;\n    }\n    Object.assign(router, components);\n\n    // set url, backUrl and entityUrl\n    if (router.route && router.id && router.isEntity(router.route)) {\n      router.entityUrl = `/api/${  router.route  }/${  router.id}`;\n      router.entityType = router.route;\n\n      await http\n        .get(router.entityUrl)\n        .then(res => {\n          if (!res) {\n            console.warn(\"Unknown entity\");\n            router.navigate();\n            return;\n          }\n          router.entity = res;\n          switch (router.route) {\n            case \"groups\":\n              if (router.action == \"write\") {\n                router.backUrl = `/${  router.route  }/${  router.id}`;\n                router.backUrlPrompt = lang.t(\"cancel_write\");\n              }\n              if (router.search) {\n                router.backUrl = `/${  router.route  }/${  router.id}`;\n              }\n              break;\n            case \"messages\":\n              if (res[\"parent\"] && !res[\"isInFront\"]) {\n                router.backUrl = `/messages/${  res[\"parent\"].id}`;\n              } else {\n                router.backUrl = `/groups/${  util.getId(res.group)}`;\n              }\n              break;\n            case \"users\":\n              router.backUrl = \"/\";\n              break;\n            default:\n              if (router.action) {\n                router.backUrl = \"/\";\n              }\n          }\n        })\n        .catch(e => console.warn(e));\n    }\n\n    switch (router.route) {\n      case \"login\":\n        storage.reset();\n      case \"bookmarks\":\n      case \"create-group\":\n      case \"groups\":\n      case \"messages\":\n      case \"password-reset\":\n      case \"public\":\n      case \"share\":\n      case \"signup\":\n      case \"stop-notification-emails\":\n      case \"users\":\n        if (options.replace) {\n          history.replaceState(null, \"\", url);\n        } else {\n          history.pushState(null, \"\", url);\n        }\n        window.dispatchEvent(new CustomEvent(\"routerStateChange\"));\n        break;\n      case \"logout\":\n        storage.reset();\n        window.location.href = window.location.origin;\n        break;\n      case \"invitation\":\n        storage.get(\"apiKey\").then(apiKey => {\n          if (apiKey) {\n            http.post(`/api/groups/invitation/${  router.id}`, {}).then(() => {\n              window.location.href = window.location.origin;\n            });\n          } else {\n            router.navigate(`/signup?inviteKey=${  router.id}`);\n          }\n        });\n        break;\n      default:\n        me.get().then(user => {\n          if (!user) {\n            router.navigate(\"/login\");\n            return;\n          }\n          if (user.data[\"default_group\"]) {\n            router.navigate(`/groups/${  user.data[\"default_group\"]}`);\n          } else if (user.groups[0]) {\n              router.navigate(`/groups/${  user.groups[0].id}`);\n            } else {\n              window.location = \"/create-group\";\n            }\n        });\n    }\n  },\n  sync: () => {\n    router.navigate(location.pathname + location.search + location.hash, {\n      replace: true\n    });\n  },\n  onClick: (e, newTab = false, url = null) => {\n    // stop propagation\n    e.preventDefault();\n    e.stopPropagation();\n\n    // if url is not given, try to guess it\n    if (!url) {\n      const t = e.target.closest(\"a\");\n      if (t) {\n        if (t.target == \"_blank\") {\n          newTab = true;\n        }\n        url = t.getAttribute(\"href\");\n      }\n    }\n\n    if (!url) {\n      return;\n    }\n\n    // check if it's an external url\n    if (url.startsWith(\"http\")) {\n      let targetUrl = new URL(url);\n      if (targetUrl.host != location.host) {\n        if (e.ctrlKey || newTab) {\n          open(url, \"_blank\");\n        } else {\n          location.href = url;\n        }\n        return;\n      }\n    }\n\n    // disable active stances (dropdowns...)\n    for (let e of document.getElementsByClassName(\"active\")) {\n      e.classList.remove(\"active\");\n    }\n\n    // go to target url\n    if (e.ctrlKey || newTab) {\n      open(url, \"_blank\");\n    } else {\n      router.navigate(url);\n    }\n  }\n};\nexport default router;\n","import alert from \"./alert.js\";\nimport storage from \"./storage.js\";\nimport router from \"./router.js\";\n\nconst http = {\n  sendFile: (formData, loadFn, progressFn = null, errorFn = null) => {\n    return storage\n      .get(\"apiKey\")\n      .then(apiKey => {\n        let xhr = new XMLHttpRequest();\n        xhr.open(\"POST\", `${document.baseURI  }api/files`, true);\n        xhr.setRequestHeader(\"X-AUTH-TOKEN\", apiKey);\n        xhr.addEventListener(\"load\", e => {\n          if (e.target.status > 199 && e.target.status < 300) {\n            loadFn(JSON.parse(e.target.response));\n          } else if (errorFn) {\n              errorFn(e.target.statusText);\n            } else {\n              console.error(e.target.statusText);\n            }\n        });\n        if (progressFn) {\n          xhr.upload.onprogress = e =>\n            progressFn({ loaded: e.loaded, total: e.total });\n        }\n        if (errorFn) {\n          xhr.addEventListener(\"error\", e => errorFn(e));\n        }\n        xhr.send(formData);\n      })\n      .catch(error => alert.add(error, \"alert-danger\"));\n  },\n  get: (url, nocache = false) => {\n    return storage\n      .get(\"apiKey\")\n      .then(apiKey => {\n        url = router.toApp(url);\n        if (!url) {\n          return;\n        }\n        let h = {};\n        if (apiKey) {\n          h[\"X-AUTH-TOKEN\"] = apiKey;\n        }\n        if (nocache) {\n          h[\"X-NOCACHE\"] = \"nocache\";\n        }\n        return fetch(url, {\n          method: \"GET\",\n          headers: new Headers(h)\n        })\n          .then(res => res.ok && res.json())\n          .catch(err => console.warn(`ERROR for ${  url}`, err));\n      })\n      .catch(error => alert.add(error, \"alert-danger\"));\n  },\n  post: (url, data, contentType = \"application/json\") =>\n    http.request(url, data, \"POST\", contentType),\n  put: (url, data, contentType = \"application/json\") =>\n    http.request(url, data, \"PUT\", contentType),\n  delete: (url, data, contentType = \"application/json\") =>\n    http.request(url, null, \"DELETE\", contentType),\n  request: (url, data, method, contentType = \"application/json\") => {\n    return storage\n      .get(\"apiKey\")\n      .then(apiKey => {\n        url = router.toApp(url);\n        if (!url) {\n          return;\n        }\n        let h = {};\n        if (apiKey) {\n          h[\"X-AUTH-TOKEN\"] = apiKey;\n        }\n        if (contentType) {\n          h[\"Content-type\"] = contentType;\n        }\n        let fetchOptions = {\n          method,\n          headers: new Headers(h)\n        };\n        if (data) {\n          fetchOptions.body =\n            typeof data == \"object\" && data.constructor.name == \"Object\"\n              ? JSON.stringify(data)\n              : data;\n        }\n        return fetch(url, fetchOptions)\n          .then(res => {\n            if (method == \"DELETE\") {\n              return res;\n            }\n            try {\n              return res.json();\n            } catch (exception) {\n              console.warn(exception.message);\n              return Promise.reject(exception.message);\n            }\n          })\n          .catch(err => console.warn(`ERROR for ${  url}`, err));\n      })\n      .catch(error => alert.add(error, \"alert-danger\"));\n  }\n};\nexport default http;\n","import _param from \"./param.js\";\nimport _alert from \"./alert.js\";\nimport _cache from \"./cache.js\";\nimport _storage from \"./storage.js\";\nimport _http from \"./http.js\";\nimport _me from \"./me.js\";\nimport _router from \"./router.js\";\nimport _util from \"./util.js\";\nimport _lang from \"./lang.js\";\n\nexport const param = _param;\nexport const alert = _alert;\nexport const cache = _cache;\nexport const storage = _storage;\nexport const http = _http;\nexport const me = _me;\nexport const router = _router;\nexport const util = _util;\nexport const lang = _lang;\n","import { Store, set, get } from \"idb-keyval\";\nimport param from \"/core\";\n\nconst cache_store = new Store(param.CACHE_STORE, param.CACHE);\nconst cached_routes = [\n  {\n    route: new RegExp(\"/api/users/[^/]+/?$\"),\n    duration: 1000 * 60 * 60 * 24, // 24h\n  },\n  {\n    route: new RegExp(\"/api/images/crop/\"),\n    duration: 1000 * 60 * 60 * 24 * 365, // 1 year\n  },\n  {\n    route: new RegExp(\"/api/images/thumbnail/\"),\n    duration: 1000 * 60 * 60 * 24 * 365, // 1 year\n  },\n  {\n    route: new RegExp(\"/api/links/by_url\\?\"),\n    duration: 1000 * 60 * 60 * 24 * 365, // 1 year\n  }\n];\n\n// On fetch, use cache but update the entry with the latest contents\n// from the server.\nself.addEventListener(\"fetch\", (evt) => {\n  if (evt.request.method == \"GET\") {\n    // cache-update routes: retrieve from cache and update in background\n    if (cached_routes.some(r => evt.request.url.match(r.route))) {\n      // You can use `respondWith()` to answer immediately, without waiting for the\n      // network response to reach the service worker...\n      evt.respondWith(fromCache(evt.request));\n\n      // ...and `waitUntil()` to prevent the worker from being killed until the function is finished.\n      evt.waitUntil(() => {\n        get(evt.request.url, cache_store)\n          .then(r => {\n            if (r && Object.protoype.hasOwnProperty.call(r, \"lastUsed\") && r.lastUsed != null) {\n              const timeout = r.lastUsed + cached_routes.find(r => evt.request.url.match(r.route))[\"duration\"];\n              // update the cache only if the timeout is reached\n              if (timeout < Date.now()) {\n                update(evt.request);\n              }\n            }\n          })\n          .catch(() => update(evt.request));\n      });\n    }\n  }\n});\n\n// Add response to cache and store the lastUsed timestamp at the same time\nfunction addToCache(cache, request, response) {\n  return set(\n    request.url,\n    {\n      lastUsed: Date.now()\n    },\n    cache_store\n  ).then(() => cache.put(request, response));\n}\n\n// Make a network request, return the result and add it to cache if asked\nfunction fromNetwork(request, toCache) {\n  return fetch(request).then(response => {\n    if (toCache) {\n      // response may be used only once\n      // we need to save clone to put one copy in cache\n      // and serve second one\n      let responseClone = response.clone();\n      caches.open(param.CACHE).then(cache => addToCache(cache, request, responseClone));\n    }\n    return response;\n  });\n}\n\n// Open the cache where the assets were stored and search for the requested\n// resource. Notice that in case of no matching, the promise still resolves\n// but it does with `undefined` as value.\nfunction fromCache(request) {\n  return caches.open(param.CACHE).then(cache => {\n    return cache.match(request).then(matching => {\n      if (matching) {\n        // reset lastUsed\n        return set(\n          request.url,\n          {\n            lastUsed: Date.now()\n          },\n          cache_store\n        ).then(() => matching);\n      }\n        // if nothing matches, return response from network\n        return fromNetwork(request, true);\n    });\n  });\n}\n\n// Update consists in opening the cache, performing a network request and\n// storing the new response data.\nfunction update(request) {\n  return caches.open(param.CACHE).then(cache => {\n    return fetch(request).then(response => {\n      return addToCache(cache, request, response);\n    });\n  });\n}\n"]}