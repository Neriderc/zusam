!function(t,s){function n(e){$(e).off()}function r(e){var t=$(e)[0],s=$(e);s.off(),o.filter_out_all(t),s.on("paste",function(s){s.preventDefault(),s.stopPropagation();var n="",i=$(this);return s.clipboardData?n=s.clipboardData.getData("text/plain"):window.clipboardData?n=window.clipboardData.getData("Text"):s.originalEvent.clipboardData&&(n=$("<div></div>").text(s.originalEvent.clipboardData.getData("text"))),document.queryCommandSupported("insertText")?(document.execCommand("insertHTML",!1,$(n).html()),t=$(e)[0],o.filter_out_all(t),!1):(i.find("*").each(function(){$(this).addClass("within")}),setTimeout(function(){i.find("*").each(function(){$(this).not(".within").contents().unwrap()})},1),!1)}),s.on("keyup",function(s){if((s.ctrlKey||17==s.keyCode||window.ctrl)&&86!=s.keyCode);else if($(":focus").parent().is(e)){if(8==s.keyCode&&""==$(":focus").html())return s.preventDefault(),s.stopPropagation(),!1;(null==window.typed||window.typed!=$(e).html())&&(t=$(e)[0],cpos=o.getCpos(document.activeElement),13==s.keyCode?o.filter_out_ending(t):o.filter_out_search(t),0!=cpos&&(13==s.keyCode?bias=1:bias=0,o.setCpos(document.activeElement,parseInt(cpos+bias))),window.typed=$(e).html())}}),$(e).on("click",function(e){o.niceFocus(e.target)})}function a(){$(".post .dynamicBox").each(function(){o.filter_out_all(this,!0),$(this).find("*[contenteditable=true]").remove()})}s.typebox=t;var o={mergeEditableNodes:function(e){for(i=0;i<e.childNodes.length;i++)"DIV"==e.childNodes[i].tagName&&null!=e.childNodes[i-1]&&"DIV"==e.childNodes[i-1].tagName&&(e.childNodes[i-1].innerHTML+="<br>"+e.childNodes[i].innerHTML,e.removeChild(e.childNodes[i]))},searchFilter:function(e,t,s){for(o.mergeEditableNodes(e),toProcess=[],i=0;i<e.childNodes.length;i++)node=e.childNodes[i],"DIV"==node.tagName&&toProcess.push(node);for(i=0;i<toProcess.length;i++){var n=[];if(n[0]="",node=toProcess[i],inner=node.innerHTML.trim(),n=t(inner),n.length>1||n[0]!=node.innerHTML?hasChanged=!0:hasChanged=!1,n.length>1)for(j=n.length-1;j>0;j--)$(node).after(n[j]);""==n[0]?$(node).remove():node.innerHTML=n[0]}(null==s||0==s)&&hasChanged&&refocus(e),o.refreshContent(s,e)},getCpos:function(e){var t,s=0,n=e.ownerDocument||e.document,i=n.defaultView||n.parentWindow;if("undefined"!=typeof i.getSelection){if(t=i.getSelection(),t.rangeCount>0){var r=i.getSelection().getRangeAt(0),a=r.cloneRange();a.selectNodeContents(e),a.setEnd(r.endContainer,r.endOffset),s=a.toString().length}}else if((t=n.selection)&&"Control"!=t.type){var o=t.createRange(),l=n.body.createTextRange();l.moveToElementText(e),l.setEndPoint("EndToEnd",o),s=l.text.length}return s},setCpos:function(e,t){for(t=parseInt(t),0>t&&(t=0),count=0,i=0;i<e.childNodes.length;i++){var s=e.childNodes[i];if(null==s.tagName){if(s.length>=t-count){var n=document.createRange();n.setStart(s,t-count),n.setEnd(s,t-count);var r=window.getSelection();r.removeAllRanges(),r.addRange(n);break}count=parseInt(count)+parseInt(s.length)}else if(t-count<=1){$(s).after(document.createTextNode(" "));var n=document.createRange();n.setStartAfter(s),n.setEndAfter(s);var r=window.getSelection();r.removeAllRanges(),r.addRange(n);break}}},refreshContent:function(e,t){t=$(t),(null==e||0==e)&&(t.find("*[contenteditable]").on("dragover drop",function(e){return e.preventDefault(),!1}),t.find(".deletable").off(),t.find(".deletable").on("mouseenter",function(e){$(e.currentTarget).append('<div onclick="$(this).parent().remove();" class="delete-btn"><i class="fa fa-times"></i></div>')}),t.find(".deletable").on("mouseleave",function(e){$(e.currentTarget).children(".delete-btn").remove()})),t.find("iframe:not([src])").remove()},niceFocus:function(e){$(e).is("[contenteditable]")?""==$(e).html()&&(e=e.parentNode,o.refocus(e)):o.refocus(e)},refocus:function(t){t=$(t),t.children().last().is("div")||(t.append('<div contenteditable="true"> </div>'),refreshContent(t)),e=t.children().last()[0],e.focus();var s=document.createRange();s.selectNodeContents(e),s.collapse(!1);var n=window.getSelection();n.removeAllRanges(),n.addRange(s)},filter_out_ending:function(e,t){o.searchFilter(e,l.endingYoutube,t),o.searchFilter(e,l.endingYoutube2,t),o.searchFilter(e,l.endingVimeo,t),o.searchFilter(e,l.endingDailymotion,t),o.searchFilter(e,l.endingVine,t),o.searchFilter(e,l.endingDeezer,t),o.searchFilter(e,l.endingSoundcloud,t),o.searchFilter(e,l.endingImage,t),o.searchFilter(e,l.endingVideo,t),o.searchFilter(e,l.endingLink,t)},filter_out_search:function(e,t){o.searchFilter(e,l.searchYoutube,t),o.searchFilter(e,l.searchYoutube2,t),o.searchFilter(e,l.searchVimeo,t),o.searchFilter(e,l.searchDailymotion,t),o.searchFilter(e,l.searchVine,t),o.searchFilter(e,l.searchDeezer,t),o.searchFilter(e,l.searchSoundcloud,t),o.searchFilter(e,l.searchImage,t),o.searchFilter(e,l.searchVideo,t),o.searchFilter(e,l.searchLink,t)},filter_out_all:function(e,t){o.filter_out_ending(e,t),o.filter_out_search(e,t)},decode:function(e){return br2nl(html_entity_decode(e,"ENT_NOQUOTES"))},encode:function(e){return nl2br(htmlentities(e,"ENT_NOQUOTES"))},searchMatch:function(e){var t=(e.callerName,e.inner),s=e.regex,n=e.substitution,i=e.callback,r=e.fail,a=e.ajax_url;t=o.decode(t);var l=[],u=t.match(s);if(m=[],xhrs=[],null!=u)for(j=0;j<u.length;j++)m.push(u[j].replace(/[\s]*/gi,""));if(m.length>0&&(console.log(e),console.log("from inner:'"+t+"'")),0!=m.length){var c=t;for(j=0;j<m.length;j++){var d=c.indexOf(m[j]),p=c.slice(0,d);p.match(/^\s+$/)&&(p=""),0==j?l.push(encode(p)):l.push('<div contenteditable="true">'+encode(p)+"</div>"),l.push(n(m[j])),c=c.slice(d+m[j].length)}for(c.match(/^\s*$/)||l.push('<div contenteditable="true">'+encode(c)+"</div>"),j=0;j<m.length;j++)settings=new Object,settings.url=a+"?url="+encodeURI(m[j]),null!=i?settings.success=function(e){i(e)}:settings.success=function(e){console.log(e)},null!=r&&(settings.error=function(){r(m[j])}),null!=i&&$.ajax(settings)}else l[0]=o.encode(t);return l}},l={endingDeezer:function(e){return r1=/[\s]*(https?:\/\/www.deezer.com\/)(playlist)\/(\d+)$/gi,substitution=function(e){return playlist_id=e.replace(/[\s]*(https?:\/\/www.deezer.com\/)(playlist)\/(\d+)$/,"$3"),output='<span class="deletable" data-src="'+e+'" contenteditable="false" id="'+str2md5(e)+'">',output+='<div class="embed-responsive embed-responsive-16by9"><iframe scrolling="no" frameborder="0" allowTransparency="true" src="http://www.deezer.com/plugins/player?playlist=true&type=playlist&id='+playlist_id+'"></iframe></div>',output+="</span>",output},output=o.searchMatch({callerName:"endingDeezer",inner:e,regex:r1,substitution:substitution}),output},searchDeezer:function(e){return r1=/[\s]*(https?:\/\/www.deezer.com\/)(playlist)\/(\d+)[\s]/gi,substitution=function(e){return playlist_id=e.replace(/[\s]*(https?:\/\/www.deezer.com\/)(playlist)\/(\d+)$/,"$3"),output='<span class="deletable" data-src="'+e+'" contenteditable="false" id="'+str2md5(e)+'">',output+='<div class="embed-responsive embed-responsive-16by9"><iframe scrolling="no" frameborder="0" allowTransparency="true" src="http://www.deezer.com/plugins/player?playlist=true&type=playlist&id='+playlist_id+'"></iframe></div>',output+="</span>",output},output=o.searchMatch({callerName:"searchDeezer",inner:e,regex:r1,substitution:substitution}),output},endingSoundcloud:function(e){return r1=/[\s]*(https?:\/\/soundcloud.com\/)([\w\-]+)\/([\w\-]+)(\/[\w\-]+)?$/gi,substitution=function(e){return output='<span class="deletable" data-src="'+e+'" contenteditable="false" id="'+str2md5(e)+'"><img src="Assets/ajax-loader.gif"/></span>',"undefined"!=typeof SC&&setTimeout(function(){SC.oEmbed(e,{auto_play:!0},function(t){song_url=t.html.replace(/.*src="([^"]+)".*/,"$1"),song_url=song_url.replace(/auto_play=true/,"auto_play=false"),output='<div class="embed-responsive embed-responsive-16by9"><iframe class="embed-responsive-item" scrolling="no" frameborder="0" src="'+song_url+'"></iframe></div>',$("#"+str2md5(e)).html(output)})},50),output},output=o.searchMatch({callerName:"endingSoundcloud",inner:e,regex:r1,substitution:substitution}),output},searchSoundcloud:function(e){return r1=/[\s]*(https?:\/\/soundcloud.com\/)([\w\-]+)\/([\w\-]+)(\/[\w\-]+)?[\s]/gi,substitution=function(e){return output='<span class="deletable" data-src="'+e+'" contenteditable="false" id="'+str2md5(e)+'"><img src="Assets/ajax-loader.gif"/></span>',setTimeout(function(){SC.oEmbed(e,{auto_play:!0},function(t){song_url=t.html.replace(/.*src="([^"]+)".*/,"$1"),song_url=song_url.replace(/auto_play=true/,"auto_play=false"),output='<div class="embed-responsive embed-responsive-16by9"><iframe class="embed-responsive-item" scrolling="no" frameborder="0" src="'+song_url+'"></iframe></div>',$("#"+str2md5(e)).html(output)})},50),output},output=o.searchMatch({callerName:"searchSoundcloud",inner:e,regex:r1,substitution:substitution}),output},endingVine:function(e){return r1=/[\s]*(https?:\/\/vine.co\/v\/)([\w\-]+)$/gi,substitution=function(e){var t='<span class="deletable" data-src="'+e+'" contenteditable="false" id="'+str2md5(e)+'">',s=e.replace(/(https?:\/\/vine.co\/v\/)([\w\-]+)/,'<div class="embed-responsive embed-responsive-square"><iframe seamless class="embed-responsive-item" src="$1$2/embed/simple" frameborder="0"></iframe></div><script async src="//platform.vine.co/static/scripts/embed.js" charset="utf-8"></script>'),n="</span>";return t+s+n},output=o.searchMatch({callerName:"endingVine",inner:e,regex:r1,substitution:substitution}),output},searchVine:function(e){return r1=/[\s]*(https?:\/\/vine.co\/v\/)([\w\-]+)[\s]/gi,substitution=function(e){var t='<span class="deletable" data-src="'+e+'" contenteditable="false" id="'+str2md5(e)+'">',s=e.replace(/(https?:\/\/vine.co\/v\/)([\w\-]+)/,'<div class="embed-responsive embed-responsive-square"><iframe seamless class="embed-responsive-item" src="$1$2/embed/simple" frameborder="0"></iframe></div><script async src="//platform.vine.co/static/scripts/embed.js" charset="utf-8"></script>'),n="</span>";return t+s+n},output=o.searchMatch({callerName:"searchVine",inner:e,regex:r1,substitution:substitution}),output},endingDailymotion:function(e){return r1=/[\s]*(https?:\/\/www.dailymotion.com\/video\/)([\w\-]+)$/gi,substitution=function(e){var t='<span class="deletable" data-src="'+e+'" contenteditable="false" id="'+str2md5(e)+'">',s=e.replace(/(http:\/\/www.dailymotion.com\/video\/)([\w\-]+)/,'<div class="embed-responsive embed-responsive-16by9"><iframe seamless frameborder="0" class="embed-responsive-item" src="http://www.dailymotion.com/embed/video/$2" allowfullscreen></iframe></div>'),n="</span>";return t+s+n},output=o.searchMatch({callerName:"endingDailymotion",inner:e,regex:r1,substitution:substitution}),output},searchDailymotion:function(e){return r1=/[\s]*(https?:\/\/www.dailymotion.com\/video\/)([\w\-]+)[\s]/gi,substitution=function(e){var t='<span class="deletable" data-src="'+e+'" contenteditable="false" id="'+str2md5(e)+'">',s=e.replace(/(https?:\/\/www.dailymotion.com\/video\/)([\w\-]+)/,'<div class="embed-responsive embed-responsive-16by9"><iframe seamless frameborder="0" class="embed-responsive-item" src="http://www.dailymotion.com/embed/video/$2" allowfullscreen></iframe></div>'),n="</span>";return t+s+n},output=o.searchMatch({callerName:"searchDailymotion",inner:e,regex:r1,substitution:substitution}),output},endingVimeo:function(e){return r1=/[\s]*(https?:\/\/vimeo.com\/)(channels\/staffpicks\/)?([0-9]+)$/gi,substitution=function(e){var t='<span class="deletable" data-src="'+e+'" contenteditable="false" id="'+str2md5(e)+'">',s=e.replace(/(https?:\/\/vimeo.com\/)(channels\/staffpicks\/)?([0-9]+)/,'<div class="embed-responsive embed-responsive-16by9"><iframe seamless frameborder="0" class="embed-responsive-item" src="http://player.vimeo.com/video/$3" allowfullscreen></iframe></div>'),n="</span>";return t+s+n},output=o.searchMatch({callerName:"endingVimeo",inner:e,regex:r1,substitution:substitution}),output},searchVimeo:function(e){return r1=/[\s]*(https?:\/\/vimeo.com\/)(channels\/staffpicks\/)?([0-9]+)[\s]/gi,substitution=function(e){var t='<span class="deletable" data-src="'+e+'" contenteditable="false" id="'+str2md5(e)+'">',s=e.replace(/(https?:\/\/vimeo.com\/)(channels\/staffpicks\/)?([0-9]+)/,'<div class="embed-responsive embed-responsive-16by9"><iframe seamless frameborder="0" class="embed-responsive-item" src="http://player.vimeo.com/video/$3" allowfullscreen></iframe></div>'),n="</span>";return t+s+n},output=o.searchMatch({callerName:"searchVimeo",inner:e,regex:r1,substitution:substitution}),output},endingYoutube2:function(e){return r1=/[\s]*https?:\/\/youtu\.be\/[\w\/=?~.%&+\-#]+$/gi,substitution=function(e){var t=e.replace(/(https?:\/\/youtu\.be\/)([\w\-]+)([^\s]*)/,"$2"),s="http://www.youtube.com/embed/"+t,n='<span class="deletable" data-src="'+e+'" contenteditable="false" id="'+str2md5(e)+'"><div class="embed-responsive embed-responsive-16by9"><iframe class="embed-responsive-item" seamless src="'+s+'"/><iframe></div></span>';return n},output=o.searchMatch({callerName:"endingYoutube2",inner:e,regex:r1,substitution:substitution}),output},searchYoutube2:function(e){return r1=/[\s]*https?:\/\/youtu\.be\/[\w\/=?~.%&+\-#]+[\s]/gi,substitution=function(e){var t=e.replace(/(https?:\/\/youtu\.be\/)([\w\-]+)([^\s]*)/,"$2"),s="http://www.youtube.com/embed/"+t+"?wmode=opaque",n='<span class="deletable" data-src="'+e+'" contenteditable="false" id="'+str2md5(e)+'"><div class="embed-responsive embed-responsive-16by9"><iframe class="embed-responsive-item" seamless src="'+s+'"/><iframe></div></span>';return n},output=o.searchMatch({callerName:"searchYoutube2",inner:e,regex:r1,substitution:substitution}),output},endingYoutube:function(e){return r1=/[\s]*https?:\/\/(www|m)\.youtube\.com\/watch[\w\/=?~.%&+\-#]+$/gi,substitution=function(e){var t=e.replace(/(https?:\/\/(www|m).youtube.com\/watch\?)([^\s]*)v=([\w\-]+)([^\s]*)/,"$4"),s="http://www.youtube.com/embed/"+t,n='<span class="deletable" data-src="'+e+'" contenteditable="false" id="'+str2md5(e)+'"><div class="embed-responsive embed-responsive-16by9"><iframe class="embed-responsive-item" seamless  src="'+s+'"/><iframe></div></span>';return n},output=o.searchMatch({callerName:"endingYoutube",inner:e,regex:r1,substitution:substitution}),output},searchYoutube:function(e){return r1=/[\s]*https?:\/\/(www|m)\.youtube\.com\/watch[\w\/=?~.%&+\-#]+[\s]/gi,substitution=function(e){var t=e.replace(/(https?:\/\/(www|m).youtube.com\/watch\?)([^\s]*)v=([\w\-]+)([^\s]*)/,"$4"),s="http://www.youtube.com/embed/"+t+"?wmode=opaque",n='<span class="deletable" data-src="'+e+'" contenteditable="false" id="'+str2md5(e)+'"><div class="embed-responsive embed-responsive-16by9"><iframe class="embed-responsive-item" seamless  src="'+s+'"/><iframe></div></span>';return n},output=o.searchMatch({callerName:"searchYoutube",inner:e,regex:r1,substitution:substitution}),output},endingVideo:function(e){return r1=/[\s]*https?:\/\/[\w\/=?~.%&+\-#]+(\.mp4|\.webm)(\?\w*)?$/gi,substitution=function(e){return'<span class="deletable" data-src="'+e+'" contenteditable="false" id="'+str2md5(e)+'"><video autoplay loop><source src="'+e+'"></video></span>'},output=o.searchMatch({callerName:"endingVideo",inner:e,regex:r1,substitution:substitution}),output},searchVideo:function(e){return r1=/[\s]*https?:\/\/[\w\/=?~.%&+\-#]+(\.mp4|\.webm)(\?\w*)?[\s]/gi,substitution=function(e){return'<span class="deletable" data-src="'+e+'" contenteditable="false" id="'+str2md5(e)+'"><video autoplay loop><source src="'+e+'"></video></span>'},output=o.searchMatch({callerName:"searchVideo",inner:e,regex:r1,substitution:substitution}),output},endingImage:function(e){return r1=/[\s]*https?:\/\/[\w\/=?~.%&+\-#]+(\.png|\.bmp|\.jpg|\.jpeg|\.gif)(\?\w*)?$/gi,substitution=function(e){return'<span class="deletable" data-src="'+e+'" contenteditable="false" id="'+str2md5(e)+'"><img onerror="this.src=\'http://www.nibou.eu/zusam/web/assets/no_image.png\'" src="'+e+'"/></span>'},output=o.searchMatch({callerName:"endingImage",inner:e,regex:r1,substitution:substitution}),output},searchImage:function(e){return r1=/[\s]*https?:\/\/[\w\/=?~.%&+\-#\!]+(\.png|\.bmp|\.jpg|\.jpeg|\.gif)(\?\w*)?[\s]/gi,substitution=function(e){return'<span class="deletable" data-src="'+e+'" contenteditable="false" id="'+str2md5(e)+'"><img onerror="this.src=\'http://www.nibou.eu/zusam/web/assets/no_image.png\'" src="'+e+'"/></span>'},output=o.searchMatch({callerName:"searchImage",inner:e,regex:r1,substitution:substitution}),output},fail_request:function(t){for(base_url=decodeURI(t).replace(/https?:\/\/(www\.)?([^\/\?\#]+).*/i,"$1$2"),e=$('<a class="b-link" href="'+decodeURI(t).replace(/\s/," ")+'" target="_blank"></a>'),container=$("<div>"),total_width=0,i=0;i<100&&!(total_width>100);i++)c=parseInt(100*Math.random()+30),w=10*Math.random(),total_width+=w,h="80px",d=$("<div>").css({margin:"0px",display:"inline-block",width:w+"%","padding-bottom":h,background:"rgba("+c+","+c+","+c+",1)"}),container.append(d);return e.append(container),e.append('<span><i class="fa fa-external-link-square"></i> '+base_url+"</span>"),e},open_graph_build:function(t){return base_url=t.base_url,console.log(t.image.url),t.image.url.match(/https?:\/\/.+(\.png|\.bmp|\.jpg|\.jpeg|\.gif)/i)?preview='<div class="preview"><img src="'+t.image.url+'"/></div>':(console.log("nope"),preview=""),null!=t.title&&""!=t.title?title='<div class="title">'+html_entity_decode(t.title)+"</div>":title="",null!=t.description&&""!=t.description?description='<div class="description">'+html_entity_decode(t.description)+"</div>":description="",""!=preview||""!=title&&""!=description?""!=t.image.url&&null!=t.w&&null!=t.h&&parseInt(t.w)<380?e=$('<a class="article_small" href="'+decodeURI(t.url)+'" target="_blank">'+preview+title+description+'<div class="base_url">'+base_url+"</div></a>"):e=$('<a class="article_big" href="'+decodeURI(t.url)+'" target="_blank">'+preview+title+description+'<div class="base_url">'+base_url+"</div></a>"):e=fail_request(t.url),e},endingLink:function(t){return r1=/[\s]*https?:\/\/[\w\/=?~,.%&+\-#\!]+$/gi,substitution=function(e){return output='<span class="deletable" data-src="'+e+'" contenteditable="false" id="'+str2md5(e.replace(/#.+$/,""))+'"><img src="Assets/ajax-loader.gif"/></span>',output},ajax_url="Ajax/gen_preview.php",callback=function(t){e=open_graph_build(t),balise=$("#"+str2md5(decodeURI(t.url))),balise.html(e)},fail=function(t){e=fail_request(t),balise=$("#"+str2md5(t)),balise.html(e)},output=o.searchMatch({callerName:"endinglink",inner:t,regex:r1,substitution:substitution,ajax_url:ajax_url,callback:callback,fail:fail}),output},searchLink:function(t){return r1=/[\s]*https?:\/\/[\w\/=?~,.%&+\-#]+[\s]/gi,substitution=function(e){return output='<span class="deletable" data-src="'+e+'" contenteditable="false" id="'+str2md5(e.replace(/#.+$/,""))+'"><img src="Assets/ajax-loader.gif"/></span>',output},ajax_url="Ajax/gen_preview.php",callback=function(t){e=open_graph_build(t),balise=$("#"+str2md5(decodeURI(t.url))),balise.html(e)},fail=function(t){e=fail_request(t),balise=$("#"+str2md5(t)),balise.html(e)},output=o.searchMatch({callerName:"searchLink",inner:t,regex:r1,substitution:substitution,ajax_url:ajax_url,callback:callback,fail:fail}),output}};t.Control=o,t.Filter=l,t.stop=n,t.start=r,t.view=a}({},function(){return this}());
